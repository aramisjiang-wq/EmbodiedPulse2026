# 检查服务器代码同步状态

## 方法一：在服务器上运行检查脚本（推荐）

1. **SSH连接到服务器**：
```bash
ssh root@115.190.77.57
# 密码: ash@2025
```

2. **上传并运行检查脚本**：
```bash
# 方法A: 直接创建脚本
cat > /tmp/check_sync.sh << 'EOF'
#!/bin/bash
PROJECT_DIR="/opt/EmbodiedPulse"
cd ${PROJECT_DIR} || { echo "项目目录不存在"; exit 1; }

echo "=== Git状态 ==="
git remote -v
echo ""
echo "=== 当前版本 ==="
git log --oneline -1
echo ""
echo "=== 远程版本 ==="
git fetch origin main
git log origin/main --oneline -1
echo ""
echo "=== 同步状态 ==="
CURRENT=$(git rev-parse HEAD)
REMOTE=$(git rev-parse origin/main)
if [ "$CURRENT" = "$REMOTE" ]; then
    echo "✅ 代码已同步"
else
    echo "⚠️  代码未同步，需要更新"
fi
echo ""
echo "=== Docker状态 ==="
docker-compose ps
EOF

chmod +x /tmp/check_sync.sh
bash /tmp/check_sync.sh
```

## 方法二：手动检查命令

在服务器上依次执行：

```bash
ssh root@115.190.77.57
cd /opt/EmbodiedPulse

# 1. 检查Git状态
git remote -v
git log --oneline -5

# 2. 检查远程最新版本
git fetch origin main
git log origin/main --oneline -1

# 3. 比较版本
CURRENT=$(git rev-parse HEAD)
REMOTE=$(git rev-parse origin/main)
if [ "$CURRENT" = "$REMOTE" ]; then
    echo "✅ 代码已同步"
else
    echo "⚠️  代码未同步"
    echo "当前: $CURRENT"
    echo "远程: $REMOTE"
fi

# 4. 检查Docker服务
docker-compose ps

# 5. 检查服务访问
curl -I http://localhost:5001
```

## 方法三：查看GitHub Actions部署状态

1. **打开GitHub仓库**：
   https://github.com/aramisjiang-wq/EmbodiedPulse2026

2. **查看Actions**：
   - 点击 **Actions** 标签
   - 查看 "Auto Deploy to Server" 工作流
   - 检查最新的运行记录

3. **查看部署日志**：
   - 点击最新的运行记录
   - 查看 "Deploy to server via SSH" 步骤的日志
   - 确认部署是否成功

## 方法四：检查服务访问

直接访问服务查看是否更新：

- **服务地址**: http://115.190.77.57:5001
- **检查点**：
  - 页面是否能正常加载
  - 是否显示最新功能（如：岗位机会挂件已隐藏）

## 如果代码未同步

### 手动同步代码

```bash
ssh root@115.190.77.57
cd /opt/EmbodiedPulse

# 拉取最新代码
git pull origin main

# 重启服务
docker-compose down
docker-compose up -d --build

# 检查状态
docker-compose ps
```

### 或者触发GitHub Actions部署

1. 在GitHub仓库的Actions标签
2. 选择 "Auto Deploy to Server" 工作流
3. 点击 "Run workflow" 手动触发

## 验证最新代码

检查服务器上的代码是否包含最新修复：

```bash
ssh root@115.190.77.57
cd /opt/EmbodiedPulse

# 检查是否有run_app.py（最新添加的文件）
ls -la run_app.py

# 检查app.py是否包含模板路径修复
grep -A 5 "TEMPLATE_DIR" app.py

# 检查是否有GitHub Actions工作流
ls -la .github/workflows/auto-deploy.yml
```

如果这些文件都存在，说明代码已同步。

