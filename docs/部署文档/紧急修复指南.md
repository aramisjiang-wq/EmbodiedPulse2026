# ç´§æ€¥ä¿®å¤æœåŠ¡æŒ‡å—

## ğŸš¨ é—®é¢˜è¯Šæ–­

å¦‚æœé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š
- HTTP 502é”™è¯¯
- æœåŠ¡æ— æ³•è®¿é—®
- curlé”™è¯¯ï¼šHTTP/2 stream 1 was not closed cleanly
- Segmentation fault

## ğŸ”§ å¿«é€Ÿä¿®å¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
ssh root@115.190.77.57

# ä¸‹è½½å¹¶æ‰§è¡Œä¿®å¤è„šæœ¬
cd /opt/EmbodiedPulse
git pull origin main
bash scripts/ç´§æ€¥ä¿®å¤æœåŠ¡.sh
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ä¿®å¤æ­¥éª¤

```bash
ssh root@115.190.77.57
cd /opt/EmbodiedPulse

# 1. åœæ­¢æ‰€æœ‰å®¹å™¨
docker-compose down -v

# 2. æ¸…ç†èµ„æº
docker system prune -f

# 3. æ›´æ–°ä»£ç 
git pull origin main

# 4. é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose build --no-cache

# 5. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 6. ç­‰å¾…å¯åŠ¨ï¼ˆè‡³å°‘60ç§’ï¼‰
sleep 60

# 7. æ£€æŸ¥çŠ¶æ€
docker-compose ps
docker-compose logs web
```

## ğŸ” è¯¦ç»†è¯Šæ–­

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
docker-compose ps
```

åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œï¼š
- `embodied-pulse-postgres` - çŠ¶æ€ä¸º `Up`
- `embodied-pulse-web` - çŠ¶æ€ä¸º `Up`

### 2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# Webå®¹å™¨æ—¥å¿—
docker-compose logs --tail=100 web

# Postgreså®¹å™¨æ—¥å¿—
docker-compose logs --tail=50 postgres

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f web
```

### 3. æ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥5001ç«¯å£
netstat -tulpn | grep 5001
lsof -i:5001

# æ£€æŸ¥5432ç«¯å£ï¼ˆPostgreSQLï¼‰
netstat -tulpn | grep 5432
```

### 4. æ£€æŸ¥å®¹å™¨èµ„æº

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats --no-stream

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect embodied-pulse-web
```

### 5. æ£€æŸ¥ç½‘ç»œè¿æ¥

```bash
# æµ‹è¯•å®¹å™¨å†…éƒ¨è¿æ¥
docker-compose exec web curl http://localhost:5001

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker-compose exec web python3 -c "from models import get_session; s = get_session(); print('æ•°æ®åº“è¿æ¥æˆåŠŸ')"
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜ä¿®å¤

### é—®é¢˜1ï¼šå®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**åŸå› **ï¼šåº”ç”¨å¯åŠ¨å¤±è´¥

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs web

# æ£€æŸ¥åº”ç”¨é…ç½®
docker-compose exec web env

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
docker-compose run --rm web python3 app.py
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› **ï¼šPostgreSQLæœªå¯åŠ¨æˆ–è¿æ¥é…ç½®é”™è¯¯

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥PostgreSQLå®¹å™¨
docker-compose ps postgres
docker-compose logs postgres

# é‡å¯PostgreSQL
docker-compose restart postgres

# ç­‰å¾…æ•°æ®åº“å¯åŠ¨
sleep 10

# æµ‹è¯•è¿æ¥
docker-compose exec web python3 -c "from models import get_session; s = get_session(); print('OK')"
```

### é—®é¢˜3ï¼šç«¯å£è¢«å ç”¨

**åŸå› **ï¼š5001ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨

**è§£å†³**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:5001
netstat -tulpn | grep 5001

# åœæ­¢å ç”¨è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
```

### é—®é¢˜4ï¼šå†…å­˜ä¸è¶³

**åŸå› **ï¼šæœåŠ¡å™¨å†…å­˜ä¸è¶³

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
docker stats --no-stream

# æ¸…ç†Dockerèµ„æº
docker system prune -a -f

# é™åˆ¶å®¹å™¨å†…å­˜ï¼ˆåœ¨docker-compose.ymlä¸­ï¼‰
# services:
#   web:
#     mem_limit: 512m
```

### é—®é¢˜5ï¼šSegmentation fault

**åŸå› **ï¼šåº”ç”¨å´©æºƒï¼Œå¯èƒ½æ˜¯ä¾èµ–é—®é¢˜æˆ–èµ„æºä¸è¶³

**è§£å†³**ï¼š
```bash
# 1. å®Œå…¨é‡å»º
docker-compose down -v
docker-compose build --no-cache
docker-compose up -d

# 2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
dmesg | tail -20
journalctl -xe | tail -50

# 3. æ£€æŸ¥Pythonç¯å¢ƒ
docker-compose exec web python3 --version
docker-compose exec web pip list
```

## ğŸ”„ å®Œå…¨é‡å»º

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½ä¸è¡Œï¼Œå®Œå…¨é‡å»ºï¼š

```bash
cd /opt/EmbodiedPulse

# 1. åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨å’Œå·
docker-compose down -v

# 2. åˆ é™¤é•œåƒ
docker rmi embodied-pulse-web embodied-pulse-postgres 2>/dev/null || true

# 3. æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a -f

# 4. æ›´æ–°ä»£ç 
git fetch origin main
git reset --hard origin/main
git clean -fd

# 5. é‡æ–°æ„å»º
docker-compose build --no-cache

# 6. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 7. ç­‰å¾…å¹¶æ£€æŸ¥
sleep 60
docker-compose ps
docker-compose logs web
```

## ğŸ“Š éªŒè¯ä¿®å¤

ä¿®å¤åéªŒè¯ï¼š

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps
# åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œ

# 2. æµ‹è¯•HTTPè¿æ¥
curl -I http://localhost:5001
# åº”è¯¥è¿”å› HTTP/1.1 200 OK

# 3. è®¿é—®ç½‘ç«™
# æµè§ˆå™¨è®¿é—®: http://115.190.77.57:5001
```

## ğŸ†˜ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­ï¼š

1. **å®¹å™¨çŠ¶æ€**ï¼š
   ```bash
   docker-compose ps
   ```

2. **æœåŠ¡æ—¥å¿—**ï¼š
   ```bash
   docker-compose logs --tail=200 web > /tmp/web.log
   cat /tmp/web.log
   ```

3. **ç³»ç»Ÿèµ„æº**ï¼š
   ```bash
   free -h
   df -h
   docker stats --no-stream
   ```

4. **ç½‘ç»œçŠ¶æ€**ï¼š
   ```bash
   netstat -tulpn | grep -E "5001|5432"
   firewall-cmd --list-ports  # CentOS
   # æˆ–
   ufw status  # Ubuntu
   ```

