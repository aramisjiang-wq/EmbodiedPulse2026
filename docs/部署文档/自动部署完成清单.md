# ✅ 自动部署完成清单

## 📋 当前状态

### ✅ 已完成

1. **代码修复**
   - ✅ Flask模板路径问题已修复
   - ✅ 本地测试通过，应用正常运行
   - ✅ 创建了run_app.py启动脚本

2. **Git配置**
   - ✅ 代码已推送到GitHub
   - ✅ `docs/项目文档/`文件夹已在.gitignore中，不会同步到GitHub
   - ✅ GitHub Actions自动部署工作流已配置

3. **自动部署配置**
   - ✅ `.github/workflows/auto-deploy.yml`已创建
   - ✅ 工作流会在push到main分支时自动触发
   - ✅ 已排除项目文档文件夹触发部署

## ⚠️ 需要完成的最后一步

### 在GitHub仓库设置Secrets（重要！）

**这是自动部署的关键步骤，必须完成！**

1. **打开GitHub仓库**：
   https://github.com/aramisjiang-wq/EmbodiedPulse2026

2. **进入设置**：
   - 点击仓库页面的 **Settings**（设置）
   - 左侧菜单找到 **Secrets and variables** → **Actions**

3. **添加Secrets**：
   点击 **New repository secret**，依次添加：

   | Secret名称 | 值 | 说明 |
   |-----------|-----|------|
   | `SERVER_HOST` | `115.190.77.57` | 服务器IP地址 |
   | `SERVER_USER` | `root` | SSH用户名 |
   | `SERVER_PASSWORD` | `ash@2025` | SSH密码 |

4. **验证**：
   添加完成后，应该能看到3个Secrets

## 🎯 自动部署流程（设置Secrets后）

### 完整流程

1. **本地修改代码**
   ```bash
   # 修改代码后
   git add .
   git commit -m "更新说明"
   git push origin main
   ```

2. **GitHub Actions自动触发**
   - 推送后，GitHub Actions会自动检测到push事件
   - 工作流会自动执行部署

3. **服务器自动部署**
   - SSH连接到服务器
   - 拉取最新代码
   - 停止旧容器
   - 构建新镜像
   - 启动新容器
   - 初始化数据库（如果需要）

4. **服务更新完成**
   - 访问 http://115.190.77.57:5001 查看更新

### 部署时间

- **触发时间**：push到GitHub后立即触发
- **部署耗时**：约2-5分钟（取决于代码变更和构建时间）

## 🔍 验证自动部署

### 方法1：查看GitHub Actions

1. 进入仓库：https://github.com/aramisjiang-wq/EmbodiedPulse2026
2. 点击 **Actions** 标签
3. 查看 "Auto Deploy to Server" 工作流
4. 点击最新的运行记录查看详细日志

### 方法2：查看服务器日志

```bash
ssh root@115.190.77.57
cd /opt/EmbodiedPulse
docker-compose logs -f web
```

### 方法3：访问服务

- 访问：http://115.190.77.57:5001
- 确认服务正常运行

## 📝 重要说明

### 项目文档不同步

✅ **`docs/项目文档/`文件夹不会同步到GitHub**

- 已在`.gitignore`中配置
- 本地文档保留，不会上传到GitHub
- 不影响自动部署

### 自动部署触发条件

✅ **以下情况会触发自动部署**：
- Push到main分支
- 代码文件变更（.py, .html, .js, .css等）
- 配置文件变更（.yaml, .yml, docker-compose.yml等）

❌ **以下情况不会触发自动部署**：
- 仅文档文件变更（.md文件）
- `docs/项目文档/`文件夹变更
- `.gitignore`变更

### 首次部署

如果服务器上还没有项目，GitHub Actions会自动：
1. 创建项目目录 `/opt/EmbodiedPulse`
2. 克隆代码
3. 启动Docker服务

## 🛠️ 故障排查

### 部署失败

1. **检查GitHub Secrets**：
   - 确认3个Secrets都已正确设置
   - 检查值是否正确（特别是密码）

2. **查看Actions日志**：
   - 进入Actions标签
   - 查看失败的运行记录
   - 检查错误信息

3. **检查服务器连接**：
   ```bash
   ssh root@115.190.77.57
   # 测试SSH连接是否正常
   ```

### 服务无法访问

1. **检查容器状态**：
   ```bash
   ssh root@115.190.77.57
   cd /opt/EmbodiedPulse
   docker-compose ps
   ```

2. **查看容器日志**：
   ```bash
   docker-compose logs web
   ```

3. **检查防火墙**：
   ```bash
   # CentOS/RHEL
   firewall-cmd --list-ports
   
   # Ubuntu/Debian
   ufw status
   ```

## ✅ 完成检查清单

- [x] 代码已推送到GitHub
- [x] 项目文档文件夹已正确忽略
- [x] GitHub Actions工作流已配置
- [ ] **GitHub Secrets已设置**（需要手动完成）
- [ ] 测试自动部署（设置Secrets后）

## 🚀 下一步

1. **立即执行**：在GitHub设置Secrets（见上方说明）
2. **测试部署**：推送一个小改动，验证自动部署是否工作
3. **监控部署**：在Actions标签查看部署状态

设置完Secrets后，你的自动部署流程就完全配置好了！🎉

