# æ–°è®ºæ–‡çº¢ç‚¹è®¡æ•°è§„åˆ™è¯´æ˜

**åˆ›å»ºæ—¶é—´**ï¼š2025å¹´12æœˆ11æ—¥  
**åŠŸèƒ½ç‰ˆæœ¬**ï¼šv1.2.2ï¼ˆä¼˜åŒ–ç‰ˆï¼‰

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

"å…¨é‡"æ ‡ç­¾æ—è¾¹çš„çº¢ç‚¹æ•°å­—ç”¨äºæ˜¾ç¤º**çœŸæ­£æ–°å¢çš„è®ºæ–‡æ•°é‡**ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£æœ‰å¤šå°‘æ–°è®ºæ–‡éœ€è¦æŸ¥çœ‹ã€‚

---

## ğŸ”¢ è®¡æ•°è§„åˆ™

### æ ¸å¿ƒè§„åˆ™

**åˆ¤æ–­æ ‡å‡†**ï¼šä½¿ç”¨ `Paper.created_at > last_viewed_dt`

**å…³é”®ç‚¹**ï¼š
- âœ… **åªè®¡ç®—çœŸæ­£æ–°å¢çš„è®ºæ–‡**ï¼ˆ`created_at`ï¼‰
- âŒ **ä¸åŒ…æ‹¬å·²æœ‰è®ºæ–‡çš„æ›´æ–°**ï¼ˆ`updated_at`ï¼‰

### ä¸ºä»€ä¹ˆä½¿ç”¨ `created_at` è€Œä¸æ˜¯ `updated_at`ï¼Ÿ

**é—®é¢˜åœºæ™¯**ï¼š
- Semantic Scholaræ•°æ®æ›´æ–°ä¼šæ›´æ–° `updated_at`
- è®ºæ–‡ä¿¡æ¯æ›´æ–°ä¼šæ›´æ–° `updated_at`
- å¦‚æœä½¿ç”¨ `updated_at`ï¼Œä¼šå¯¼è‡´ä¸æ˜¯çœŸæ­£çš„æ–°è®ºæ–‡ä¹Ÿè¢«è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `created_at` åˆ¤æ–­ï¼Œåªè®¡ç®—é¦–æ¬¡åˆ›å»ºçš„è®ºæ–‡
- ç¡®ä¿çº¢ç‚¹æ•°é‡ä¸å®é™…æ–°å¢è®ºæ–‡æ•°é‡ä¸€è‡´

---

## ğŸ”„ è·å–æµç¨‹

### 1. å‰ç«¯è·å–ä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´

**ä½ç½®**ï¼š`static/js/app.js` - `loadPapers()` å‡½æ•°

**ä»£ç **ï¼š
```javascript
// è·å–ä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´ï¼ˆä»localStorageï¼‰
const lastViewed = localStorage.getItem('papersLastViewed');
let url = '/api/papers';
if (lastViewed && showNewBadge) {
    url += `?last_viewed=${encodeURIComponent(lastViewed)}`;
}
```

**è¯´æ˜**ï¼š
- ä» `localStorage` è¯»å– `papersLastViewed`ï¼ˆä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´ï¼‰
- å¦‚æœå­˜åœ¨ä¸”éœ€è¦æ˜¾ç¤ºçº¢ç‚¹ï¼Œåˆ™ä½œä¸ºå‚æ•°ä¼ é€’ç»™åç«¯API

---

### 2. åç«¯è®¡ç®—æ–°è®ºæ–‡æ•°é‡

**ä½ç½®**ï¼š`app.py` - `/api/papers` æ¥å£

**ä»£ç **ï¼š
```python
# è·å–æŸ¥è¯¢å‚æ•°ï¼šä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´
last_viewed = request.args.get('last_viewed', type=str, default=None)

# è®¡ç®—æ–°è®ºæ–‡æ•°é‡ï¼ˆå¦‚æœæä¾›äº†last_viewedå‚æ•°ï¼‰
new_papers_count = 0
if last_viewed:
    # è§£ælast_viewedæ—¶é—´æˆ³ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
    last_viewed_dt = datetime.fromisoformat(last_viewed)
    
    # æŸ¥è¯¢åœ¨æ­¤æ—¶é—´ä¹‹åçœŸæ­£æ–°å¢çš„è®ºæ–‡ï¼ˆä½¿ç”¨created_atï¼Œè€Œä¸æ˜¯updated_atï¼‰
    new_papers = session.query(Paper).filter(
        Paper.created_at > last_viewed_dt
    ).count()
    
    new_papers_count = new_papers
```

**è¯´æ˜**ï¼š
1. æ¥æ”¶å‰ç«¯ä¼ é€’çš„ `last_viewed` å‚æ•°
2. è§£ææ—¶é—´æˆ³ï¼ˆæ”¯æŒISOæ ¼å¼ã€UTCæ ¼å¼ç­‰ï¼‰
3. æŸ¥è¯¢ `Paper.created_at > last_viewed_dt` çš„è®ºæ–‡æ•°é‡
4. è¿”å› `new_papers_count`

---

### 3. å‰ç«¯æ˜¾ç¤ºçº¢ç‚¹

**ä½ç½®**ï¼š`static/js/app.js` - `updateNewPapersBadge()` å‡½æ•°

**ä»£ç **ï¼š
```javascript
// æ›´æ–°æ–°è®ºæ–‡çº¢ç‚¹æç¤º
function updateNewPapersBadge(count) {
    const badge = document.getElementById('newPapersBadge');
    const countElement = document.getElementById('newPapersCount');
    
    if (count > 0) {
        countElement.textContent = count > 99 ? '99+' : count.toString();
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }
}
```

**è¯´æ˜**ï¼š
- å¦‚æœ `count > 0`ï¼Œæ˜¾ç¤ºçº¢ç‚¹å¹¶æ˜¾ç¤ºæ•°å­—
- å¦‚æœæ•°å­— > 99ï¼Œæ˜¾ç¤º "99+"
- å¦‚æœ `count = 0`ï¼Œéšè—çº¢ç‚¹

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### Paperæ¨¡å‹å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `created_at` | DateTime | è®ºæ–‡é¦–æ¬¡åˆ›å»ºæ—¶é—´ï¼ˆçœŸæ­£çš„æ–°è®ºæ–‡ï¼‰ |
| `updated_at` | DateTime | è®ºæ–‡æœ€åæ›´æ–°æ—¶é—´ï¼ˆåŒ…æ‹¬æ•°æ®æ›´æ–°ï¼‰ |

### åˆ¤æ–­é€»è¾‘

**æ–°è®ºæ–‡åˆ¤æ–­**ï¼š
```python
Paper.created_at > last_viewed_dt  # âœ… æ˜¯æ–°è®ºæ–‡
```

**æ—§è®ºæ–‡åˆ¤æ–­**ï¼š
```python
Paper.created_at <= last_viewed_dt  # âŒ ä¸æ˜¯æ–°è®ºæ–‡ï¼ˆå³ä½¿ updated_at > last_viewed_dtï¼‰
```

---

## ğŸ—„ï¸ å­˜å‚¨æœºåˆ¶

### localStorageå­˜å‚¨

**é”®å**ï¼š`papersLastViewed`

**æ ¼å¼**ï¼šISO 8601 æ—¶é—´æˆ³ï¼ˆä¾‹å¦‚ï¼š`2025-12-11T10:35:44.020977`ï¼‰

**åˆå§‹åŒ–**ï¼š
```javascript
// å¦‚æœä¸å­˜åœ¨ï¼Œè®¾ç½®ä¸ºå½“å‰æ—¶é—´
if (!localStorage.getItem('papersLastViewed')) {
    localStorage.setItem('papersLastViewed', new Date().toISOString());
}
```

**æ›´æ–°æ—¶æœº**ï¼š
- ç‚¹å‡»çº¢ç‚¹æ—¶æ›´æ–°ä¸ºå½“å‰æ—¶é—´
- æ¸…é™¤çº¢ç‚¹æç¤ºæ—¶æ›´æ–°

---

## ğŸ”§ æ¸…é™¤æœºåˆ¶

### ç‚¹å‡»çº¢ç‚¹æ¸…é™¤

**ä½ç½®**ï¼š`static/js/app.js` - `clearNewPapersBadge()` å‡½æ•°

**ä»£ç **ï¼š
```javascript
function clearNewPapersBadge() {
    const badge = document.getElementById('newPapersBadge');
    if (badge) {
        badge.classList.add('hidden');
    }
    // æ›´æ–°ä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´ä¸ºå½“å‰æ—¶é—´
    const now = new Date().toISOString();
    localStorage.setItem('papersLastViewed', now);
}
```

**è¯´æ˜**ï¼š
- ç‚¹å‡»çº¢ç‚¹æ—¶ï¼Œéšè—çº¢ç‚¹
- æ›´æ–° `papersLastViewed` ä¸ºå½“å‰æ—¶é—´
- ä¸‹æ¬¡åŠ è½½æ—¶ï¼Œåªè®¡ç®—æ­¤æ—¶é—´ä¹‹åçš„æ–°è®ºæ–‡

---

## ğŸ“ˆ å®Œæ•´æµç¨‹ç¤ºä¾‹

### åœºæ™¯1ï¼šé¦–æ¬¡è®¿é—®

1. **é¡µé¢åŠ è½½**
   - `localStorage` ä¸­æ²¡æœ‰ `papersLastViewed`
   - è®¾ç½®ä¸ºå½“å‰æ—¶é—´ï¼š`2025-12-11 10:00:00`

2. **åŠ è½½è®ºæ–‡**
   - è°ƒç”¨ `/api/papers?last_viewed=2025-12-11T10:00:00`
   - åç«¯æŸ¥è¯¢ï¼š`Paper.created_at > 2025-12-11 10:00:00`
   - å‡è®¾æœ‰5ç¯‡æ–°è®ºæ–‡ï¼Œè¿”å› `new_papers_count = 5`

3. **æ˜¾ç¤ºçº¢ç‚¹**
   - çº¢ç‚¹æ˜¾ç¤ºæ•°å­— "5"

---

### åœºæ™¯2ï¼šå†æ¬¡è®¿é—®ï¼ˆæœ‰æ–°è®ºæ–‡ï¼‰

1. **é¡µé¢åŠ è½½**
   - `localStorage` ä¸­æœ‰ `papersLastViewed = 2025-12-11 10:00:00`
   - è°ƒç”¨ `/api/papers?last_viewed=2025-12-11T10:00:00`

2. **åç«¯è®¡ç®—**
   - æŸ¥è¯¢ `Paper.created_at > 2025-12-11 10:00:00`
   - å‡è®¾åˆæœ‰3ç¯‡æ–°è®ºæ–‡ï¼Œè¿”å› `new_papers_count = 3`

3. **æ˜¾ç¤ºçº¢ç‚¹**
   - çº¢ç‚¹æ˜¾ç¤ºæ•°å­— "3"

---

### åœºæ™¯3ï¼šç‚¹å‡»çº¢ç‚¹æ¸…é™¤

1. **ç‚¹å‡»çº¢ç‚¹**
   - è°ƒç”¨ `clearNewPapersBadge()`
   - æ›´æ–° `papersLastViewed = 2025-12-11 10:30:00`ï¼ˆå½“å‰æ—¶é—´ï¼‰
   - éšè—çº¢ç‚¹

2. **ä¸‹æ¬¡åŠ è½½**
   - è°ƒç”¨ `/api/papers?last_viewed=2025-12-11T10:30:00`
   - åªè®¡ç®— `created_at > 2025-12-11 10:30:00` çš„è®ºæ–‡
   - å¦‚æœ10:30ä¹‹åæ²¡æœ‰æ–°è®ºæ–‡ï¼Œè¿”å› `new_papers_count = 0`
   - çº¢ç‚¹ä¸æ˜¾ç¤º

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ—¶é—´æ ¼å¼

**æ”¯æŒæ ¼å¼**ï¼š
- ISOæ ¼å¼ï¼š`2025-12-11T10:35:44.020977`
- UTCæ ¼å¼ï¼š`2025-12-11T10:35:44Z`
- å…¶ä»–æ ‡å‡†æ ¼å¼

**è§£æé€»è¾‘**ï¼š
- ä¼˜å…ˆä½¿ç”¨ `datetime.fromisoformat()`
- å¦‚æœå¤±è´¥ï¼Œå°è¯•å»æ‰å¾®ç§’åè§£æ
- æœ€åä½¿ç”¨ `dateutil.parser.isoparse()`

---

### 2. æ—¶åŒºå¤„ç†

**æ•°æ®åº“æ—¶é—´**ï¼šä½¿ç”¨æœ¬åœ°æ—¶é—´ï¼ˆnaive datetimeï¼‰

**å‰ç«¯æ—¶é—´**ï¼šä½¿ç”¨ISOæ ¼å¼ï¼Œå¯èƒ½åŒ…å«æ—¶åŒºä¿¡æ¯

**å¤„ç†æ–¹å¼**ï¼š
```python
# ç¡®ä¿æ˜¯naive datetimeï¼ˆæ•°æ®åº“ä¸­çš„æ—¶é—´ä¹Ÿæ˜¯naiveï¼‰
if last_viewed_dt.tzinfo is not None:
    last_viewed_dt = last_viewed_dt.astimezone().replace(tzinfo=None)
```

---

### 3. æ•°æ®æ›´æ–°ä¸å½±å“è®¡æ•°

**åœºæ™¯**ï¼š
- Semantic Scholaræ•°æ®æ›´æ–°ä¼šæ›´æ–° `updated_at`
- ä½†ä¸ä¼šæ›´æ–° `created_at`
- å› æ­¤ä¸ä¼šå½±å“æ–°è®ºæ–‡è®¡æ•°

**ç¤ºä¾‹**ï¼š
```
è®ºæ–‡Aï¼š
  created_at: 2025-12-10 10:00:00
  updated_at: 2025-12-10 10:00:00  (åˆå§‹åˆ›å»º)
  
Semantic Scholaræ›´æ–°åï¼š
  created_at: 2025-12-10 10:00:00  (ä¸å˜)
  updated_at: 2025-12-11 15:00:00  (å·²æ›´æ–°)
  
å¦‚æœ last_viewed = 2025-12-11 12:00:00ï¼š
  created_at (2025-12-10) <= last_viewed (2025-12-11)  âŒ ä¸ç®—æ–°è®ºæ–‡
  å³ä½¿ updated_at (2025-12-11) > last_viewed (2025-12-11) âœ…
```

---

## ğŸ¯ æ€»ç»“

### è®¡æ•°è§„åˆ™

1. **åˆ¤æ–­æ ‡å‡†**ï¼š`Paper.created_at > last_viewed_dt`
2. **åªè®¡ç®—çœŸæ­£æ–°å¢çš„è®ºæ–‡**ï¼ˆä¸åŒ…æ‹¬æ›´æ–°ï¼‰
3. **ä½¿ç”¨ `localStorage` å­˜å‚¨ä¸Šæ¬¡æŸ¥çœ‹æ—¶é—´**
4. **ç‚¹å‡»çº¢ç‚¹æ¸…é™¤æ—¶æ›´æ–°æŸ¥çœ‹æ—¶é—´**

### å…³é”®ç‚¹

- âœ… ä½¿ç”¨ `created_at` ç¡®ä¿å‡†ç¡®æ€§
- âœ… æ”¯æŒå¤šç§æ—¶é—´æ ¼å¼è§£æ
- âœ… è‡ªåŠ¨å¤„ç†æ—¶åŒºè½¬æ¢
- âœ… æ•°æ®æ›´æ–°ä¸å½±å“è®¡æ•°

---

**æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ11æ—¥  
**ç»´æŠ¤è€…**ï¼šAIå¼€å‘åŠ©æ‰‹





