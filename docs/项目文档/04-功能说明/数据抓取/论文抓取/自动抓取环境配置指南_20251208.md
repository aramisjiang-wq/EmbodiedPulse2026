# 自动抓取配置指南

## 🚀 启用自动定时抓取

### 方法 1: 环境变量配置（推荐）

在启动服务器前设置环境变量：

```bash
# 启用自动抓取
export AUTO_FETCH_ENABLED=true

# 设置抓取时间（cron格式，默认每天凌晨2点）
export AUTO_FETCH_SCHEDULE="0 2 * * *"

# 设置每次抓取数量（默认10）
export AUTO_FETCH_MAX_RESULTS=10

# 启动服务器
python3 app.py
```

### 方法 2: 启动脚本

创建 `start_with_auto_fetch.sh`:

```bash
#!/bin/bash
export AUTO_FETCH_ENABLED=true
export AUTO_FETCH_SCHEDULE="0 2 * * *"
export AUTO_FETCH_MAX_RESULTS=10
python3 app.py
```

### Cron 表达式说明

格式: `分钟 小时 日 月 星期`

示例:
- `0 2 * * *` - 每天凌晨2点
- `0 */12 * * *` - 每12小时（每天0点和12点）
- `0 2 * * 1` - 每周一凌晨2点
- `0 0,12 * * *` - 每天0点和12点

## 📋 配置选项

| 环境变量 | 说明 | 默认值 |
|---------|------|--------|
| `AUTO_FETCH_ENABLED` | 是否启用自动抓取 | `false` |
| `AUTO_FETCH_SCHEDULE` | Cron 表达式 | `0 2 * * *` |
| `AUTO_FETCH_MAX_RESULTS` | 每次抓取数量 | `10` |

## 🔍 检查定时任务状态

### 查看日志
定时任务执行时会记录日志：
```
[INFO] 开始执行定时抓取任务...
[INFO] 定时抓取任务完成
```

### 通过 API 检查
```bash
curl http://localhost:5001/api/fetch-status
```

## ⚠️ 注意事项

1. **安装依赖**
   ```bash
   pip install apscheduler
   ```

2. **速率限制**
   - 建议 `AUTO_FETCH_MAX_RESULTS` 设置为 5-10
   - 避免触发 ArXiv API 速率限制

3. **时区设置**
   - Cron 表达式使用 UTC 时间
   - 需要根据服务器时区调整

4. **错误处理**
   - 定时任务失败会记录到日志
   - 不会影响 Web 服务运行

## 🧪 测试定时任务

### 手动触发测试
```bash
# 通过 API 触发
curl -X POST http://localhost:5001/api/fetch \
  -H "Content-Type: application/json" \
  -d '{"max_results": 5}'
```

### 测试定时任务（修改为每分钟执行）
```bash
export AUTO_FETCH_ENABLED=true
export AUTO_FETCH_SCHEDULE="* * * * *"  # 每分钟
python3 app.py
```

## 📊 监控和日志

定时任务执行情况会记录在：
- 控制台输出
- Flask 日志系统
- 可以通过 `/api/fetch-status` 查看状态

