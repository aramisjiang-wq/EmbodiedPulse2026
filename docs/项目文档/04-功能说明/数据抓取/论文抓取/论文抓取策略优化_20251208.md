# 论文抓取策略优化

**更新时间**: 2025-12-08 20:35  
**更新类型**: 功能优化

---

## 📋 优化内容

### 1. 清除搜索按钮样式优化 ✅

**优化前**：
- 深灰色背景
- 白色文字
- 简单的悬停效果

**优化后**：
- 浅灰色背景 (#f1f5f9)
- 灰色文字 (#64748b)
- 带边框设计 (2px solid #e2e8f0)
- 波纹动画效果（悬停时）
- 3D提升效果
- 按下反馈动画

### 2. 论文抓取策略优化 ✅

**新策略**：
1. **优先抓取最新论文**：按提交日期倒序排序
2. **智能补齐历史论文**：如果类别论文数 < 1000篇，自动增加抓取量

---

## 🎨 清除搜索按钮样式详情

### CSS 实现

```css
.btn-secondary {
    background-color: #f1f5f9;        /* 浅灰色背景 */
    color: #64748b;                   /* 灰色文字 */
    border: 2px solid #e2e8f0;        /* 边框 */
    position: relative;
    overflow: hidden;
}

/* 波纹动画效果 */
.btn-secondary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(100, 116, 139, 0.1);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

/* 悬停效果 */
.btn-secondary:hover {
    background-color: #e2e8f0;        /* 更深的灰色 */
    color: #475569;                   /* 更深的文字 */
    border-color: #cbd5e1;            /* 更深的边框 */
    transform: translateY(-1px);      /* 3D提升 */
    box-shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
}

.btn-secondary:hover::before {
    width: 300px;
    height: 300px;                    /* 波纹扩散 */
}

/* 按下效果 */
.btn-secondary:active {
    transform: translateY(0);         /* 按下回弹 */
    box-shadow: 0 2px 4px rgba(100, 116, 139, 0.1);
}
```

### 视觉效果

| 状态 | 背景色 | 文字色 | 边框色 | 特效 |
|------|--------|--------|--------|------|
| 默认 | #f1f5f9 | #64748b | #e2e8f0 | - |
| 悬停 | #e2e8f0 | #475569 | #cbd5e1 | 波纹 + 提升 |
| 按下 | #e2e8f0 | #475569 | #cbd5e1 | 回弹 |

---

## 🔄 论文抓取策略详情

### 策略逻辑

```python
def get_daily_papers(topic, query="slam", max_results=2):
    """
    抓取策略：
    1. 优先抓取最新日期的论文（按提交日期倒序）
    2. 如果该类别论文总数少于1000篇，则允许补齐历史论文
    """
    
    # 1. 检查当前类别的论文数量
    current_count = 查询数据库中该类别的论文总数
    
    # 2. 如果少于1000篇，增加抓取数量
    if current_count < 1000:
        shortage = 1000 - current_count
        # 增加抓取量，但不超过原max_results的3倍
        adjusted_max_results = min(max_results + shortage, max_results * 3)
        max_results = adjusted_max_results
    
    # 3. 按提交日期倒序排序（最新的在前）
    search = arxiv.Search(
        query = query,
        max_results = max_results,
        sort_by = arxiv.SortCriterion.SubmittedDate,
        sort_order = arxiv.SortOrder.Descending  # 倒序
    )
```

### 策略说明

#### 1. 优先抓取最新论文

**实现方式**：
- 使用 `sort_by = arxiv.SortCriterion.SubmittedDate`
- 使用 `sort_order = arxiv.SortOrder.Descending`（倒序）

**效果**：
- 最新提交的论文排在前面
- 确保用户看到最新的研究成果
- 避免抓取过时的论文

#### 2. 智能补齐历史论文

**触发条件**：
- 当前类别论文数 < 1000篇

**补齐策略**：
```python
shortage = 1000 - current_count
adjusted_max_results = min(max_results + shortage, max_results * 3)
```

**示例**：
| 当前数量 | 原抓取量 | 缺口 | 调整后抓取量 | 说明 |
|---------|---------|------|-------------|------|
| 950 | 10 | 50 | 60 | 10 + 50 = 60 |
| 800 | 10 | 200 | 30 | 10 + 200 = 210，但限制为10*3=30 |
| 500 | 20 | 500 | 60 | 20 + 500 = 520，但限制为20*3=60 |
| 1000+ | 10 | 0 | 10 | 已达标，保持原量 |

**限制说明**：
- 最多增加到原抓取量的3倍
- 避免单次抓取过多触发API限制
- 可以通过多次抓取逐步补齐

---

## 📊 优化效果

### 清除按钮优化

**视觉效果**：
- ✅ 更现代的设计风格
- ✅ 清晰的视觉层次
- ✅ 流畅的交互动画
- ✅ 更好的用户反馈

**用户体验**：
- ✅ 按钮更醒目但不突兀
- ✅ 悬停时有明显反馈
- ✅ 点击时有按下感
- ✅ 整体更加精致

### 抓取策略优化

**优势**：
1. **保证时效性**
   - 优先抓取最新论文
   - 用户总能看到最新研究

2. **数据完整性**
   - 自动补齐历史论文
   - 确保每个类别有足够数据

3. **智能调节**
   - 根据现有数量动态调整
   - 避免重复抓取

4. **API友好**
   - 限制单次抓取量上限
   - 避免触发速率限制

---

## 🎯 使用场景

### 场景1：新类别首次抓取

**情况**：
- Perception 类别：当前 0 篇
- 设置抓取量：10 篇/次

**执行**：
```
检查: 0 < 1000 ✓
缺口: 1000 - 0 = 1000
调整: min(10 + 1000, 10 * 3) = 30 篇
结果: 本次抓取 30 篇最新论文
```

### 场景2：类别接近目标

**情况**：
- Manipulation 类别：当前 980 篇
- 设置抓取量：10 篇/次

**执行**：
```
检查: 980 < 1000 ✓
缺口: 1000 - 980 = 20
调整: min(10 + 20, 10 * 3) = 30 篇
结果: 本次抓取 30 篇，补齐到 1010 篇
```

### 场景3：类别已达标

**情况**：
- VLM 类别：当前 2174 篇
- 设置抓取量：10 篇/次

**执行**：
```
检查: 2174 < 1000 ✗
调整: 保持 10 篇
结果: 本次抓取 10 篇最新论文
```

---

## ⚙️ 配置说明

### 目标数量阈值

当前设置为 **1000篇**，可以在代码中修改：

```python
# daily_arxiv.py 第 110 行附近
if current_count < 1000:  # 修改这个数字
    shortage = 1000 - current_count  # 同时修改这里
```

### 抓取量倍数限制

当前设置为 **3倍**，可以修改：

```python
# daily_arxiv.py 第 114 行附近
adjusted_max_results = min(max_results + shortage, max_results * 3)  # 修改倍数
```

---

## 📝 日志输出

### 补齐历史论文时

```
[INFO] Manipulation: 当前950篇，少于1000篇，增加抓取量至60篇
[INFO] Keyword: Manipulation (1/9)
[INFO] Time = 2025-12-08 title = ... author = ...
```

### 已达标时

```
[INFO] Keyword: VLM (2/9)
[INFO] Time = 2025-12-08 title = ... author = ...
```

---

## ⚠️ 注意事项

### 1. API速率限制

**问题**：增加抓取量可能触发ArXiv API限制

**解决**：
- 已设置3秒延迟（`delay_seconds=3.0`）
- 限制最大抓取量为原量的3倍
- 支持自动重试（`num_retries=3`）

### 2. 抓取时间

**影响**：补齐历史论文会增加抓取时间

**建议**：
- 定时任务使用较小的 `max_results`（5-10）
- 手动抓取可以使用较大值（20-30）
- 分多次抓取逐步补齐

### 3. 数据库查询

**性能**：每次抓取前会查询数据库

**优化**：
- 已添加索引（`idx_category`）
- 查询速度很快（< 10ms）
- 对整体性能影响可忽略

---

## 🔮 未来改进

### 1. 可配置阈值

在 `config.yaml` 中添加配置：
```yaml
backfill:
  enabled: true
  target_count: 1000
  max_multiplier: 3
```

### 2. 分批补齐

对于缺口很大的类别，分多批次补齐：
```python
if shortage > 100:
    # 分5批补齐
    adjusted_max_results = min(max_results + shortage // 5, max_results * 2)
```

### 3. 优先级队列

根据类别重要性和缺口大小，智能调度抓取顺序。

---

## 📚 相关文档

- [论文抓取核心流程说明](./论文抓取核心流程说明_20251208.md)
- [论文抓取性能优化记录](./论文抓取性能优化记录_20251208.md)
- [论文抓取功能详解](./论文抓取功能详解（手动和自动）_20251208.md)
- [搜索交互优化](../优化记录/搜索交互优化_20251208.md)

---

**更新人员**: AI助手  
**更新日期**: 2025-12-08  
**更新状态**: ✅ 已完成  
**服务器**: http://localhost:5001

