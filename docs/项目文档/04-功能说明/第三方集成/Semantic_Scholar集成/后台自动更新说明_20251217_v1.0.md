# Semantic Scholar数据后台自动更新说明

**文档创建时间**: 2025-12-09  
**功能状态**: ✅ 已启用

---

## 📋 功能概述

后台自动更新任务会持续通过Semantic Scholar API拉取数据，补齐数据库中所有论文的Semantic Scholar补充数据，包括：
- 被引用数量 (`citation_count`)
- 高影响力引用数 (`influential_citation_count`)
- 作者机构信息 (`author_affiliations`)
- 发表场所 (`venue`)
- 发表年份 (`publication_year`)

---

## 🚀 快速开始

### 启动后台更新任务

```bash
./run_semantic_update_background.sh
```

**功能说明**：
- 自动检测需要更新的论文
- 每批更新200篇论文
- 批次之间自动等待5分钟（避免API速率限制）
- 持续运行直到所有论文数据补齐
- 自动记录日志到 `/tmp/semantic_scholar_update.log`

### 查看更新进度

```bash
./check_semantic_progress.sh
```

**显示信息**：
- 任务运行状态
- 论文总数和已更新数量
- 更新进度百分比
- 最近日志

### 停止更新任务

```bash
./stop_semantic_update.sh
```

### 查看实时日志

```bash
tail -f /tmp/semantic_scholar_update.log
```

---

## 📊 当前状态

**最新统计**（运行 `./check_semantic_progress.sh` 查看）：
- 论文总数：5433篇
- 已有Semantic Scholar数据：2885篇（53.1%）
- 缺少Semantic Scholar数据：2548篇（46.9%）
- 预计剩余：约12批次（按200篇/批计算）

---

## ⚙️ 配置说明

### 批次大小

默认每批更新200篇论文，可在 `run_semantic_update_background.sh` 中修改：

```bash
BATCH_SIZE=200  # 每批更新的数量
```

### 批次间隔

默认批次之间等待5分钟，可在 `run_semantic_update_background.sh` 中修改：

```bash
DELAY_BETWEEN_BATCHES=300  # 批次之间的延迟（秒）
```

### API速率限制

Semantic Scholar API限制：
- 免费版：100 requests/5min
- 脚本已内置延迟保护（150ms/请求）
- 遇到速率限制会自动重试（最多3次）

---

## 🔄 工作流程

1. **启动任务**
   - 检查是否有运行中的任务
   - 启动第一批更新（200篇）
   - 启动持续更新循环

2. **持续更新循环**
   - 等待当前批次完成
   - 检查是否还有需要更新的论文
   - 如果有，等待5分钟后启动下一批
   - 如果没有，自动停止

3. **自动停止**
   - 所有论文数据补齐后自动停止
   - 清理PID文件

---

## 📝 日志说明

### 日志位置

```
/tmp/semantic_scholar_update.log
```

### 日志内容

- 每篇论文的更新状态
- 成功/失败信息
- API速率限制警告
- 重试信息
- 批次完成信息

### 日志示例

```
INFO:__main__:[1/200] 更新论文: 2504.02069 - RoboAct-CLIP...
INFO:__main__:  ✅ 成功: 引用数=0, 机构数=0
WARNING:semantic_scholar_client:速率限制，等待 1.0 秒后重试...
ERROR:semantic_scholar_client:论文 2504.01554 达到最大重试次数，跳过
```

---

## 🛠️ 故障处理

### 任务意外停止

如果任务意外停止，可以重新启动：

```bash
./run_semantic_update_background.sh
```

脚本会自动检测并清理旧的PID文件。

### API速率限制

如果频繁遇到速率限制：
1. 增加批次间隔时间（`DELAY_BETWEEN_BATCHES`）
2. 减少批次大小（`BATCH_SIZE`）
3. 检查是否有其他程序在使用API

### 查看错误信息

```bash
# 查看完整日志
cat /tmp/semantic_scholar_update.log

# 查看错误信息
grep ERROR /tmp/semantic_scholar_update.log

# 查看警告信息
grep WARNING /tmp/semantic_scholar_update.log
```

---

## 📈 性能估算

### 更新速度

- **单篇论文**：约150ms（包含API延迟）
- **200篇论文**：约30秒（不含重试）
- **考虑重试和速率限制**：约5-10分钟/批

### 总时间估算

- **2548篇论文**：约12-13批次
- **总时间**：约1-2小时（考虑批次间隔和API限制）

---

## 🔍 监控建议

### 定期检查进度

建议每小时检查一次进度：

```bash
./check_semantic_progress.sh
```

### 监控日志

如果发现大量错误或速率限制，可以：

```bash
# 实时监控
tail -f /tmp/semantic_scholar_update.log

# 查看错误统计
grep -c ERROR /tmp/semantic_scholar_update.log
```

---

## 💡 最佳实践

1. **在服务器空闲时运行**：避免影响其他任务
2. **保持网络稳定**：确保API请求能正常完成
3. **定期检查进度**：确保任务正常运行
4. **不要手动停止**：除非必要，让任务自动完成

---

## 🔗 相关文档

- [Semantic Scholar API集成](./Semantic_Scholar_API集成_20251209.md)
- [批量更新Semantic Scholar数据](./批量更新Semantic_Scholar数据_20251209.md)

---

## 📞 问题反馈

如果遇到问题，请检查：
1. 日志文件中的错误信息
2. 网络连接是否正常
3. API是否可用
4. 数据库连接是否正常

---

**文档版本**: v1.0  
**最后更新**: 2025-12-09


