# 新论文红点提示功能设计

**创建时间**：2025年12月10日  
**功能版本**：v1.1（优化版）

---

## 📋 功能概述

新论文红点提示功能用于提醒用户有新的论文更新，帮助用户快速了解论文更新情况。

---

## 🎯 设计目标

1. **准确性**：红点提示数量必须与实际新增论文数量一致
2. **用户体验**：位置合理，符合用户心理模型
3. **交互性**：提供清除机制，避免干扰

---

## 🔍 当前实现分析

### 1. 后端实现

**位置**：`app.py` - `/api/papers` 接口

**当前逻辑**：
```python
# 查询在此时间之后新增或更新的论文
new_papers = session.query(Paper).filter(
    Paper.updated_at > last_viewed_dt
).count()
```

**问题分析**：
- ❌ 使用 `updated_at` 判断新论文
- ❌ `updated_at` 会在论文更新时（如Semantic Scholar数据更新）也更新
- ❌ 导致不是真正的新论文也被计算在内
- ❌ 红点数量不准确

**优化方案**：
- ✅ 使用 `created_at` 判断真正新增的论文
- ✅ 只计算 `created_at > last_viewed` 的论文
- ✅ 确保红点数量与实际新增论文数量一致

### 2. 前端实现

**位置**：`static/js/app.js`

**当前逻辑**：
- 使用 `localStorage` 存储 `papersLastViewed`（上次查看时间）
- 每次加载论文时，传递 `last_viewed` 参数
- 根据返回的 `new_papers_count` 显示红点

**红点位置**：
- 当前：在"具身论文清单"标题旁边
- 问题：与刷新操作关联性不强

---

## 💡 优化方案

### 1. 准确性优化

#### 问题
当前使用 `Paper.updated_at > last_viewed_dt` 判断新论文，但：
- Semantic Scholar数据更新会更新 `updated_at`
- 论文信息更新会更新 `updated_at`
- 导致不是真正的新论文也被计算

#### 解决方案
**使用 `created_at` 判断真正新增的论文**：

```python
# 查询在此时间之后真正新增的论文（使用created_at，而不是updated_at）
# 这样只计算真正新增的论文，不包括已有论文的更新（如Semantic Scholar数据更新）
new_papers = session.query(Paper).filter(
    Paper.created_at > last_viewed_dt
).count()
```

**优势**：
- ✅ 只计算真正新增的论文
- ✅ 红点数量与实际新增论文数量一致
- ✅ 不会因为数据更新而误报

### 2. 位置优化

#### 当前位置
- 在"具身论文清单"标题旁边
- 问题：与刷新操作关联性不强

#### 优化位置
**放在"刷新全局数据"按钮旁边**

**优势**：
- ✅ 符合用户心理模型：点击刷新 → 看到新论文数量 → 查看新论文
- ✅ 更直观：刷新按钮和红点提示在一起，逻辑清晰
- ✅ 更醒目：刷新按钮区域是用户关注的重点

**实现方式**：
1. 将红点从"具身论文清单"标题移到"刷新全局数据"按钮旁边
2. 保持清除机制：点击刷新按钮后，自动清除红点（或提供清除按钮）

---

## 🔧 技术实现

### 后端优化

**文件**：`app.py`

**修改**：
```python
# 查询在此时间之后真正新增的论文（使用created_at，而不是updated_at）
new_papers = session.query(Paper).filter(
    Paper.created_at > last_viewed_dt
).count()
```

### 前端优化

**文件**：`templates/index.html`、`static/js/app.js`

**修改**：
1. 将红点从"具身论文清单"标题移到"刷新全局数据"按钮旁边
2. 更新清除逻辑：点击刷新按钮后，自动清除红点
3. 保持红点样式和动画效果

---

## 📊 数据字段说明

### Paper模型字段

- **`created_at`**：论文首次创建时间（真正的新论文）
- **`updated_at`**：论文最后更新时间（包括数据更新）

### 判断逻辑

- **新论文判断**：`created_at > last_viewed` ✅
- **旧论文判断**：`created_at <= last_viewed` ❌（即使 `updated_at > last_viewed`）

---

## 🎨 UI设计

### 红点样式
- 红色渐变背景
- 脉冲动画效果
- 数字显示（超过99显示"99+"）
- 位置：刷新按钮旁边

### 交互设计
- **显示时机**：有新论文时显示
- **清除时机**：
  - 点击刷新按钮后自动清除（推荐）
  - 或提供独立的清除按钮
- **更新时机**：每次加载论文时更新

---

## ✅ 优化效果

### 优化前
- ❌ 红点数量不准确（包含更新的论文）
- ❌ 位置不合理（在标题旁边）
- ❌ 与刷新操作关联性不强

### 优化后
- ✅ 红点数量准确（只计算真正新增的论文）
- ✅ 位置合理（在刷新按钮旁边）
- ✅ 符合用户心理模型

---

## 📝 后续优化建议

1. **按类别显示新论文数量**：显示每个类别的新论文数量
2. **新论文高亮**：在论文列表中高亮显示新论文
3. **新论文筛选**：提供"只看新论文"的筛选选项
4. **新论文通知**：浏览器通知（需要用户授权）

---

**最后更新**：2025年12月10日  
**维护者**：AI开发助手





