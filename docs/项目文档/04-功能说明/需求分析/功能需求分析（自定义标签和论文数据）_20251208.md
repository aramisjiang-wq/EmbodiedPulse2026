# 功能需求分析

## 需求1：自定义标签功能

### 可行性评估
✅ **好做** - 难度：中等

### 功能描述
除了固定的研究方向标签（如Perception, VLM等），用户可以：
1. **创建自定义标签**：配置标签名称和搜索关键词
2. **用自定义标签抓取新论文**：使用自定义标签的搜索关键词从ArXiv抓取论文
3. **给论文打标签**：为已有论文添加自定义标签
4. **按标签筛选论文**：在论文列表中按自定义标签筛选

### 使用场景
- 用户想关注"Sim-to-Real"相关论文，创建标签"Sim2Real"，配置关键词["Sim-to-Real", "Sim2Real", "Simulation to Reality"]
- 使用"Sim2Real"标签抓取新论文
- 给已有论文添加"Sim2Real"标签
- 在论文列表中筛选所有带"Sim2Real"标签的论文

### 实现方案

#### 1. 数据库设计
需要添加两个新表：

**自定义标签表 (custom_tags)**
- `id`: 主键（自增）
- `name`: 标签名称（唯一，用户自定义）
- `search_keywords`: 搜索关键词（JSON格式，用于抓取论文）
  - 示例：`["Sim-to-Real", "Sim2Real", "Simulation to Reality"]`
- `color`: 标签颜色（可选，用于UI显示）
- `description`: 标签描述（可选）
- `is_active`: 是否启用（Boolean，默认True）
- `created_at`: 创建时间
- `updated_at`: 更新时间

**论文标签关联表 (paper_custom_tags)**
- `id`: 主键（自增）
- `paper_id`: 论文ID（外键，关联papers.id）
- `tag_id`: 标签ID（外键，关联custom_tags.id）
- `created_at`: 关联时间
- 唯一约束：`(paper_id, tag_id)` - 防止重复关联

#### 2. 功能点

**标签管理**：
- ✅ 创建自定义标签：配置标签名称和搜索关键词
- ✅ 编辑标签：修改标签名称、搜索关键词
- ✅ 删除标签：删除标签（可选择是否同时删除论文关联）
- ✅ 标签列表：显示所有自定义标签及其统计信息

**论文抓取**：
- ✅ 用自定义标签抓取：选择自定义标签，使用其搜索关键词抓取新论文
- ✅ 批量抓取：可以同时选择多个自定义标签进行抓取

**论文标签**：
- ✅ 添加标签：为已有论文添加自定义标签
- ✅ 删除标签：移除论文的自定义标签
- ✅ 批量操作：为多篇论文批量添加/删除标签

**论文筛选**：
- ✅ 按标签筛选：在论文列表中按自定义标签筛选
- ✅ 多标签筛选：支持同时选择多个标签（AND/OR逻辑）
- ✅ 标签统计：显示每个标签下的论文数量

#### 3. 技术实现

**后端API**：

标签管理：
- `GET /api/custom-tags` - 获取所有自定义标签
- `POST /api/custom-tags` - 创建自定义标签
  ```json
  {
    "name": "Sim2Real",
    "search_keywords": ["Sim-to-Real", "Sim2Real", "Simulation to Reality"],
    "color": "#FF5733",
    "description": "仿真到现实迁移相关论文"
  }
  ```
- `PUT /api/custom-tags/{tag_id}` - 更新标签
- `DELETE /api/custom-tags/{tag_id}` - 删除标签

论文标签关联：
- `POST /api/papers/{paper_id}/tags` - 为论文添加标签
  ```json
  { "tag_id": 1 }
  ```
- `DELETE /api/papers/{paper_id}/tags/{tag_id}` - 移除论文标签
- `GET /api/papers/{paper_id}/tags` - 获取论文的所有标签

论文抓取：
- `POST /api/fetch` - 支持使用自定义标签抓取
  ```json
  {
    "custom_tag_ids": [1, 2, 3],  // 使用自定义标签抓取
    "max_results": 20
  }
  ```

论文筛选：
- `GET /api/papers?custom_tag_ids=1,2,3` - 按自定义标签筛选论文

**前端UI**：

标签管理界面：
- 标签列表页面：显示所有自定义标签
- 创建/编辑标签表单：
  - 标签名称输入
  - 搜索关键词输入（支持多个，逗号分隔或每行一个）
  - 颜色选择器
  - 描述输入
- 标签操作：编辑、删除、启用/禁用

论文抓取界面：
- 在"抓取新论文"弹窗中：
  - 选择固定研究方向（现有功能）
  - 选择自定义标签（新功能）
  - 可以同时选择固定方向和自定义标签

论文列表界面：
- 论文卡片上显示自定义标签（不同颜色区分）
- 标签筛选器：在搜索栏旁边，显示所有自定义标签，支持多选
- 点击标签：筛选该标签下的所有论文

论文详情界面：
- 显示论文的所有标签（固定类别 + 自定义标签）
- 添加/删除标签按钮

#### 4. 实现细节

**数据库迁移**：
- 创建`custom_tags`表
- 创建`paper_custom_tags`关联表
- 添加索引优化查询性能

**抓取逻辑扩展**：
- 修改`daily_arxiv.py`的`demo()`函数，支持自定义标签
- 当使用自定义标签抓取时，使用标签的`search_keywords`作为搜索关键词
- 抓取到的论文自动关联到对应的自定义标签

**API实现**：
- 标签CRUD操作
- 论文标签关联管理
- 抓取接口扩展（支持自定义标签）
- 筛选接口扩展（支持自定义标签筛选）

**前端实现**：
- 标签管理页面（新建、编辑、删除）
- 抓取界面扩展（选择自定义标签）
- 论文列表扩展（显示和筛选自定义标签）
- 论文详情扩展（添加/删除标签）

#### 5. 工作量估算
- 数据库设计和迁移：2-3小时
- 后端API开发（标签管理、关联、抓取、筛选）：4-5小时
- 前端UI开发（标签管理、抓取扩展、列表扩展）：5-6小时
- 测试和优化：2-3小时
- **总计：13-17小时**

---

## 需求2：更多论文数据（被引用数量、机构信息、摘要）

### 可行性评估
⚠️ **部分可行** - 难度：较高

### 当前ArXiv API提供的数据

✅ **已有数据**：
- 标题 (title)
- 作者 (authors) - 但格式不统一，可能包含机构信息
- 摘要 (abstract) - ✅ 已有
- 发布日期 (published)
- 更新日期 (updated)
- 主要类别 (primary_category)
- PDF链接
- 代码链接（从comments提取）

❌ **ArXiv API不提供**：
- **被引用数量** - ArXiv本身不提供
- **机构信息** - 不直接提供（但可以从作者信息中解析）

### 解决方案

#### 方案1：使用Semantic Scholar API（推荐）

**优点**：
- ✅ 免费，无需API Key（有速率限制）
- ✅ 提供被引用数量
- ✅ 提供机构信息
- ✅ 提供作者信息（包括机构）

**API示例**：
```python
# 通过ArXiv ID获取论文信息
GET https://api.semanticscholar.org/graph/v1/paper/arXiv:2504.13120
?fields=title,authors,citationCount,influentialCitationCount,venue,year,abstract

# 返回数据示例：
{
  "paperId": "arXiv:2504.13120",
  "title": "...",
  "citationCount": 42,
  "influentialCitationCount": 5,
  "authors": [
    {
      "authorId": "...",
      "name": "John Doe",
      "affiliations": ["MIT", "Stanford"]
    }
  ]
}
```

**实现步骤**：
1. 抓取ArXiv论文后，使用ArXiv ID查询Semantic Scholar API
2. 获取被引用数量和机构信息
3. 保存到数据库新字段

#### 方案2：使用OpenAlex API

**优点**：
- ✅ 完全开放，免费
- ✅ 提供被引用数量
- ✅ 提供机构信息

**缺点**：
- ⚠️ 数据更新可能有延迟

#### 方案3：解析作者信息中的机构

**优点**：
- ✅ 无需额外API调用
- ✅ 实时可用

**缺点**：
- ⚠️ 格式不统一，解析困难
- ⚠️ 可能不完整

### 数据库扩展

需要在`Paper`模型中添加字段：
- `citation_count`: 被引用数量（Integer）
- `influential_citation_count`: 高影响力引用数（Integer）
- `author_affiliations`: 作者机构信息（JSON/Text）
- `venue`: 发表期刊/会议（String）

### 实现方案

#### 1. 集成Semantic Scholar API

**新增文件**：`semantic_scholar_client.py`
```python
import requests
import time

def get_paper_metadata(arxiv_id):
    """通过ArXiv ID获取Semantic Scholar数据"""
    url = f"https://api.semanticscholar.org/graph/v1/paper/arXiv:{arxiv_id}"
    params = {
        'fields': 'title,authors,citationCount,influentialCitationCount,venue,year,abstract'
    }
    
    try:
        response = requests.get(url, params=params)
        if response.status_code == 200:
            return response.json()
        return None
    except Exception as e:
        print(f"获取Semantic Scholar数据失败: {e}")
        return None
```

#### 2. 更新抓取流程

在`daily_arxiv.py`中，抓取论文后：
1. 保存ArXiv数据到数据库
2. 异步调用Semantic Scholar API获取补充数据
3. 更新数据库记录

#### 3. 前端显示

在论文卡片中显示：
- 被引用数量（带图标）
- 高影响力引用数（特殊标记）
- 作者机构（展开显示）

### 工作量估算

- Semantic Scholar API集成：3-4小时
- 数据库迁移：1小时
- 抓取流程更新：2-3小时
- 前端显示优化：2-3小时
- 错误处理和重试机制：1-2小时
- **总计：9-13小时**

### 注意事项

1. **API速率限制**：
   - Semantic Scholar：免费版 100 requests/5min
   - 需要添加延迟和重试机制
   - 考虑批量处理或异步队列

2. **数据一致性**：
   - ArXiv和Semantic Scholar的论文ID可能不完全对应
   - 需要处理匹配失败的情况

3. **机构信息判断**：
   - 需要维护一个"知名机构"列表
   - 或者使用机构排名数据（如QS排名）

---

## 推荐实施顺序

### 第一阶段：自定义标签（优先级高）
- ✅ 功能明确，实现相对简单
- ✅ 立即提升用户体验
- ✅ 为后续功能打好基础

### 第二阶段：补充论文数据（优先级中）
- ⚠️ 需要集成第三方API
- ⚠️ 需要考虑速率限制和错误处理
- ✅ 但能显著提升论文质量判断能力

---

## 总结

| 功能 | 可行性 | 难度 | 工作量 | 推荐度 |
|------|--------|------|--------|--------|
| 自定义标签 | ✅ 好做 | 中等 | 7-11小时 | ⭐⭐⭐⭐⭐ |
| 被引用数量 | ⚠️ 需第三方API | 较高 | 9-13小时 | ⭐⭐⭐⭐ |
| 机构信息 | ⚠️ 需解析或API | 较高 | 包含在上 | ⭐⭐⭐ |
| 摘要 | ✅ 已有 | - | - | ✅ |

**建议**：先实现自定义标签功能，再逐步集成Semantic Scholar API获取被引用数量和机构信息。

