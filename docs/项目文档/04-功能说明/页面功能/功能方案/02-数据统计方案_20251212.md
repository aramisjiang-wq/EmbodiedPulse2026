# æ•°æ®ç»Ÿè®¡æ–¹æ¡ˆè®¾è®¡

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æä¾›å…¨é¢çš„æ•°æ®ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å¹³å°æ•°æ®è¶‹åŠ¿ã€ç ”ç©¶æ–¹å‘æ´»è·ƒåº¦ç­‰ä¿¡æ¯ã€‚

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

1. **å®æ—¶æ•°æ®æ¦‚è§ˆ**ï¼šæ€»è®ºæ–‡æ•°ã€ä»Šæ—¥æ–°å¢ã€å„ç±»åˆ«ç»Ÿè®¡
2. **è¶‹åŠ¿åˆ†æ**ï¼šæ—¶é—´åºåˆ—æ•°æ®ï¼Œ7å¤©/30å¤©è¶‹åŠ¿
3. **ç ”ç©¶æ–¹å‘æ´»è·ƒåº¦**ï¼šå„ç ”ç©¶æ–¹å‘è®ºæ–‡æ•°é‡å˜åŒ–
4. **ä½œè€…ç»Ÿè®¡**ï¼šæ´»è·ƒä½œè€…ã€é«˜äº§æœºæ„
5. **å¼•ç”¨åˆ†æ**ï¼šé«˜å¼•ç”¨è®ºæ–‡ã€å¼•ç”¨è¶‹åŠ¿
6. **æ•°æ®å¯è§†åŒ–**ï¼šå›¾è¡¨å±•ç¤ºç»Ÿè®¡æ•°æ®

## ğŸ—ï¸ æŠ€æœ¯æ–¹æ¡ˆ

### 1. æ•°æ®åº“è®¾è®¡

#### ç»Ÿè®¡è¡¨è®¾è®¡

```sql
-- æ¯æ—¥ç»Ÿè®¡è¡¨
CREATE TABLE daily_statistics (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL UNIQUE,
    total_papers INTEGER DEFAULT 0,
    new_papers INTEGER DEFAULT 0,
    updated_papers INTEGER DEFAULT 0,
    category_stats JSONB,  -- å„ç±»åˆ«è®ºæ–‡æ•°é‡
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç±»åˆ«ç»Ÿè®¡è¡¨
CREATE TABLE category_statistics (
    id SERIAL PRIMARY KEY,
    category VARCHAR(50) NOT NULL,
    date DATE NOT NULL,
    paper_count INTEGER DEFAULT 0,
    new_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(category, date)
);

-- ä½œè€…ç»Ÿè®¡è¡¨
CREATE TABLE author_statistics (
    id SERIAL PRIMARY KEY,
    author_name VARCHAR(200) NOT NULL,
    paper_count INTEGER DEFAULT 0,
    total_citations INTEGER DEFAULT 0,
    last_paper_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æœºæ„ç»Ÿè®¡è¡¨
CREATE TABLE institution_statistics (
    id SERIAL PRIMARY KEY,
    institution_name VARCHAR(200) NOT NULL,
    paper_count INTEGER DEFAULT 0,
    total_citations INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ç»Ÿè®¡è®¡ç®—ç­–ç•¥

#### æ–¹æ¡ˆAï¼šå®æ—¶è®¡ç®—ï¼ˆé€‚åˆæ•°æ®é‡å°ï¼‰

**ä¼˜ç‚¹**ï¼š
- æ•°æ®å®æ—¶å‡†ç¡®
- æ— éœ€ç»´æŠ¤ç»Ÿè®¡è¡¨

**ç¼ºç‚¹**ï¼š
- æŸ¥è¯¢æ€§èƒ½éšæ•°æ®é‡å¢é•¿ä¸‹é™
- é«˜å¹¶å‘æ—¶å‹åŠ›å¤§

#### æ–¹æ¡ˆBï¼šå®šæ—¶é¢„è®¡ç®—ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- æŸ¥è¯¢æ€§èƒ½å¥½
- å‡å°‘æ•°æ®åº“å‹åŠ›
- æ”¯æŒå¤æ‚ç»Ÿè®¡

**ç¼ºç‚¹**ï¼š
- éœ€è¦å®šæ—¶ä»»åŠ¡
- æ•°æ®æœ‰å»¶è¿Ÿï¼ˆå¯æ¥å—ï¼‰

**å®ç°**ï¼š
```python
# å®šæ—¶ä»»åŠ¡ï¼šæ¯å°æ—¶æ›´æ–°ç»Ÿè®¡
@scheduler.task('cron', hour='*', minute=0)
def update_statistics():
    """æ›´æ–°ç»Ÿè®¡æ•°æ®"""
    update_daily_statistics()
    update_category_statistics()
    update_author_statistics()
    update_institution_statistics()
```

### 3. ç»Ÿè®¡æŒ‡æ ‡è®¾è®¡

#### åŸºç¡€æŒ‡æ ‡

1. **è®ºæ–‡æ€»æ•°**ï¼šå¹³å°æ‰€æœ‰è®ºæ–‡æ•°é‡
2. **ä»Šæ—¥æ–°å¢**ï¼šä»Šå¤©æ–°å¢çš„è®ºæ–‡æ•°
3. **æœ¬å‘¨æ–°å¢**ï¼šæœ€è¿‘7å¤©æ–°å¢è®ºæ–‡æ•°
4. **æœ¬æœˆæ–°å¢**ï¼šæœ€è¿‘30å¤©æ–°å¢è®ºæ–‡æ•°

#### ç±»åˆ«æŒ‡æ ‡

1. **å„ç±»åˆ«è®ºæ–‡æ•°**ï¼š9ä¸ªç ”ç©¶æ–¹å‘çš„è®ºæ–‡æ•°é‡
2. **ç±»åˆ«å æ¯”**ï¼šå„ç±»åˆ«å æ€»æ•°çš„ç™¾åˆ†æ¯”
3. **ç±»åˆ«å¢é•¿è¶‹åŠ¿**ï¼šå„ç±»åˆ«7å¤©/30å¤©å¢é•¿æƒ…å†µ
4. **ç±»åˆ«æ´»è·ƒåº¦æ’å**ï¼šæŒ‰æ–°å¢è®ºæ–‡æ•°æ’åº

#### æ—¶é—´è¶‹åŠ¿

1. **7å¤©è¶‹åŠ¿**ï¼šæœ€è¿‘7å¤©æ¯æ—¥æ–°å¢è®ºæ–‡æ•°
2. **30å¤©è¶‹åŠ¿**ï¼šæœ€è¿‘30å¤©æ¯æ—¥æ–°å¢è®ºæ–‡æ•°
3. **æœˆåº¦å¯¹æ¯”**ï¼šæœ¬æœˆ vs ä¸Šæœˆå¯¹æ¯”
4. **å¹´åº¦è¶‹åŠ¿**ï¼šå…¨å¹´æ•°æ®è¶‹åŠ¿

#### é«˜çº§æŒ‡æ ‡

1. **å¹³å‡å¼•ç”¨æ•°**ï¼šå¹³å°è®ºæ–‡å¹³å‡å¼•ç”¨æ•°
2. **é«˜å¼•ç”¨è®ºæ–‡**ï¼šå¼•ç”¨æ•°Top 10/50/100
3. **æ´»è·ƒä½œè€…**ï¼šå‘è¡¨è®ºæ–‡æ•°Topä½œè€…
4. **é«˜äº§æœºæ„**ï¼šè®ºæ–‡æ•°Topæœºæ„
5. **ä»£ç å¼€æºç‡**ï¼šæœ‰ä»£ç é“¾æ¥çš„è®ºæ–‡å æ¯”

## ğŸ’» å®ç°æ–¹æ¡ˆ

### 1. åç«¯APIè®¾è®¡

```python
# models.py
class DailyStatistics(Base):
    __tablename__ = 'daily_statistics'
    id = Column(Integer, primary_key=True)
    date = Column(Date, unique=True, nullable=False)
    total_papers = Column(Integer, default=0)
    new_papers = Column(Integer, default=0)
    updated_papers = Column(Integer, default=0)
    category_stats = Column(JSONB)  # {category: count}
    created_at = Column(DateTime, default=datetime.now)
    updated_at = Column(DateTime, default=datetime.now, onupdate=datetime.now)

class CategoryStatistics(Base):
    __tablename__ = 'category_statistics'
    id = Column(Integer, primary_key=True)
    category = Column(String(50), nullable=False)
    date = Column(Date, nullable=False)
    paper_count = Column(Integer, default=0)
    new_count = Column(Integer, default=0)
    created_at = Column(DateTime, default=datetime.now)
    __table_args__ = (UniqueConstraint('category', 'date'),)

# app.py
@app.route('/api/statistics/overview')
def get_statistics_overview():
    """è·å–ç»Ÿè®¡æ¦‚è§ˆ"""
    session = get_session()
    try:
        # æ€»è®ºæ–‡æ•°
        total_papers = session.query(Paper).count()
        
        # ä»Šæ—¥æ–°å¢
        today = datetime.now().date()
        today_new = session.query(Paper).filter(
            func.date(Paper.created_at) == today
        ).count()
        
        # æœ¬å‘¨æ–°å¢
        week_ago = today - timedelta(days=7)
        week_new = session.query(Paper).filter(
            Paper.created_at >= week_ago
        ).count()
        
        # å„ç±»åˆ«ç»Ÿè®¡
        category_stats = {}
        categories = ['Perception', 'VLM', 'Planning', 'RL/IL', 'Manipulation', 
                     'Locomotion', 'Dexterous', 'VLA', 'Humanoid']
        for category in categories:
            count = session.query(Paper).filter(
                Paper.categories.contains(category)
            ).count()
            category_stats[category] = count
        
        return jsonify({
            'total_papers': total_papers,
            'today_new': today_new,
            'week_new': week_new,
            'category_stats': category_stats
        })
    finally:
        session.close()

@app.route('/api/statistics/trend')
def get_statistics_trend():
    """è·å–è¶‹åŠ¿æ•°æ®"""
    days = int(request.args.get('days', 7))
    session = get_session()
    try:
        start_date = datetime.now().date() - timedelta(days=days)
        
        # æŸ¥è¯¢æ¯æ—¥ç»Ÿè®¡
        daily_stats = session.query(DailyStatistics).filter(
            DailyStatistics.date >= start_date
        ).order_by(DailyStatistics.date).all()
        
        result = {
            'dates': [stat.date.isoformat() for stat in daily_stats],
            'new_papers': [stat.new_papers for stat in daily_stats],
            'total_papers': [stat.total_papers for stat in daily_stats]
        }
        
        return jsonify(result)
    finally:
        session.close()

@app.route('/api/statistics/category-trend')
def get_category_trend():
    """è·å–ç±»åˆ«è¶‹åŠ¿"""
    category = request.args.get('category')
    days = int(request.args.get('days', 30))
    session = get_session()
    try:
        start_date = datetime.now().date() - timedelta(days=days)
        
        category_stats = session.query(CategoryStatistics).filter(
            CategoryStatistics.category == category,
            CategoryStatistics.date >= start_date
        ).order_by(CategoryStatistics.date).all()
        
        result = {
            'dates': [stat.date.isoformat() for stat in category_stats],
            'paper_count': [stat.paper_count for stat in category_stats],
            'new_count': [stat.new_count for stat in category_stats]
        }
        
        return jsonify(result)
    finally:
        session.close()

@app.route('/api/statistics/top-papers')
def get_top_papers():
    """è·å–é«˜å¼•ç”¨è®ºæ–‡"""
    limit = int(request.args.get('limit', 10))
    sort_by = request.args.get('sort_by', 'citations')  # citations, date
    
    session = get_session()
    try:
        if sort_by == 'citations':
            papers = session.query(Paper).filter(
                Paper.citation_count.isnot(None)
            ).order_by(Paper.citation_count.desc()).limit(limit).all()
        else:
            papers = session.query(Paper).order_by(
                Paper.published_date.desc()
            ).limit(limit).all()
        
        result = []
        for paper in papers:
            result.append({
                'arxiv_id': paper.arxiv_id,
                'title': paper.title,
                'authors': paper.authors,
                'citation_count': paper.citation_count,
                'published_date': paper.published_date.isoformat() if paper.published_date else None
            })
        
        return jsonify({'papers': result})
    finally:
        session.close()

# ç»Ÿè®¡æ›´æ–°å‡½æ•°
def update_daily_statistics():
    """æ›´æ–°æ¯æ—¥ç»Ÿè®¡"""
    session = get_session()
    try:
        today = datetime.now().date()
        
        # æ€»è®ºæ–‡æ•°
        total = session.query(Paper).count()
        
        # ä»Šæ—¥æ–°å¢
        today_new = session.query(Paper).filter(
            func.date(Paper.created_at) == today
        ).count()
        
        # å„ç±»åˆ«ç»Ÿè®¡
        category_stats = {}
        categories = ['Perception', 'VLM', 'Planning', 'RL/IL', 'Manipulation', 
                     'Locomotion', 'Dexterous', 'VLA', 'Humanoid']
        for category in categories:
            count = session.query(Paper).filter(
                Paper.categories.contains(category)
            ).count()
            category_stats[category] = count
        
        # æ›´æ–°æˆ–åˆ›å»ºè®°å½•
        daily_stat = session.query(DailyStatistics).filter_by(date=today).first()
        if daily_stat:
            daily_stat.total_papers = total
            daily_stat.new_papers = today_new
            daily_stat.category_stats = category_stats
        else:
            daily_stat = DailyStatistics(
                date=today,
                total_papers=total,
                new_papers=today_new,
                category_stats=category_stats
            )
            session.add(daily_stat)
        
        session.commit()
    except Exception as e:
        session.rollback()
        logger.error(f"æ›´æ–°æ¯æ—¥ç»Ÿè®¡å¤±è´¥: {e}")
    finally:
        session.close()
```

### 2. å‰ç«¯å¯è§†åŒ–

```javascript
// static/js/statistics.js
class StatisticsDashboard {
    constructor() {
        this.charts = {};
        this.init();
    }
    
    async init() {
        await this.loadOverview();
        await this.loadTrend();
        await this.loadCategoryStats();
    }
    
    async loadOverview() {
        const response = await fetch('/api/statistics/overview');
        const data = await response.json();
        
        // æ›´æ–°æ¦‚è§ˆå¡ç‰‡
        document.getElementById('total-papers').textContent = data.total_papers.toLocaleString();
        document.getElementById('today-new').textContent = data.today_new;
        document.getElementById('week-new').textContent = data.week_new;
        
        // ç»˜åˆ¶ç±»åˆ«ç»Ÿè®¡é¥¼å›¾
        this.renderCategoryChart(data.category_stats);
    }
    
    async loadTrend() {
        const response = await fetch('/api/statistics/trend?days=30');
        const data = await response.json();
        
        // ä½¿ç”¨Chart.jsç»˜åˆ¶è¶‹åŠ¿å›¾
        this.renderTrendChart(data);
    }
    
    renderCategoryChart(categoryStats) {
        const ctx = document.getElementById('category-chart').getContext('2d');
        this.charts.category = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(categoryStats),
                datasets: [{
                    data: Object.values(categoryStats),
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
    }
    
    renderTrendChart(data) {
        const ctx = document.getElementById('trend-chart').getContext('2d');
        this.charts.trend = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.dates,
                datasets: [{
                    label: 'æ–°å¢è®ºæ–‡',
                    data: data.new_papers,
                    borderColor: '#36A2EB',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.4
                }, {
                    label: 'æ€»è®ºæ–‡æ•°',
                    data: data.total_papers,
                    borderColor: '#FF6384',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
}
```

### 3. å®šæ—¶ä»»åŠ¡

```python
# scheduler.py
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()

@scheduler.scheduled_job('cron', hour=1, minute=0)  # æ¯å¤©å‡Œæ™¨1ç‚¹
def update_daily_statistics_job():
    """æ›´æ–°æ¯æ—¥ç»Ÿè®¡"""
    update_daily_statistics()
    update_category_statistics()

@scheduler.scheduled_job('cron', hour='*', minute=0)  # æ¯å°æ—¶
def update_realtime_statistics():
    """æ›´æ–°å®æ—¶ç»Ÿè®¡"""
    update_overview_statistics()

scheduler.start()
```

## ğŸ“Š ç»Ÿè®¡é¡µé¢è®¾è®¡

### 1. æ¦‚è§ˆé¡µé¢
- æ€»è®ºæ–‡æ•°å¡ç‰‡
- ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆæ–°å¢å¡ç‰‡
- ç±»åˆ«åˆ†å¸ƒé¥¼å›¾
- å¿«é€Ÿè¶‹åŠ¿å›¾

### 2. è¶‹åŠ¿åˆ†æé¡µé¢
- 7å¤©/30å¤©è¶‹åŠ¿æŠ˜çº¿å›¾
- ç±»åˆ«æ´»è·ƒåº¦å¯¹æ¯”
- æœˆåº¦å¯¹æ¯”æŸ±çŠ¶å›¾

### 3. æ’è¡Œæ¦œé¡µé¢
- é«˜å¼•ç”¨è®ºæ–‡Top 10
- æ´»è·ƒä½œè€…Top 10
- é«˜äº§æœºæ„Top 10

### 4. è¯¦ç»†ç»Ÿè®¡é¡µé¢
- å„ç±»åˆ«è¯¦ç»†æ•°æ®
- æ—¶é—´åºåˆ—è¯¦ç»†æ•°æ®
- å¯¼å‡ºç»Ÿè®¡æ•°æ®

## ğŸš€ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€ç»Ÿè®¡ï¼ˆ1-2å‘¨ï¼‰
- [ ] æ•°æ®åº“è¡¨è®¾è®¡
- [ ] åŸºç¡€ç»Ÿè®¡API
- [ ] æ¦‚è§ˆé¡µé¢
- [ ] ç®€å•å›¾è¡¨

### é˜¶æ®µ2ï¼šè¶‹åŠ¿åˆ†æï¼ˆ2-3å‘¨ï¼‰
- [ ] æ—¶é—´åºåˆ—ç»Ÿè®¡
- [ ] è¶‹åŠ¿å›¾è¡¨
- [ ] ç±»åˆ«å¯¹æ¯”

### é˜¶æ®µ3ï¼šé«˜çº§ç»Ÿè®¡ï¼ˆ3-4å‘¨ï¼‰
- [ ] ä½œè€…/æœºæ„ç»Ÿè®¡
- [ ] å¼•ç”¨åˆ†æ
- [ ] æ’è¡Œæ¦œåŠŸèƒ½

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

1. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨é¢„è®¡ç®—å‡å°‘å®æ—¶æŸ¥è¯¢
2. **ç¼“å­˜ç­–ç•¥**ï¼šç»Ÿè®¡ç»“æœç¼“å­˜1å°æ—¶
3. **æ•°æ®å¯è§†åŒ–**ï¼šä½¿ç”¨Chart.jsæˆ–ECharts
4. **å®šæ—¶ä»»åŠ¡**ï¼šä½¿ç”¨APSchedulerå®šæ—¶æ›´æ–°

