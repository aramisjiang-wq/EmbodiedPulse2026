# 飞书扫码登录系统 - 开发任务清单 v2.0

## 任务清单信息
- **创建时间**: 2025-12-16 19:00
- **版本**: v2.0（优化版）
- **预计工期**: 18-20个工作日
- **主要更新**: 新增用户个人中心功能模块

**更新说明**：
- ✨ 新增Phase 2.2：用户个人中心开发（+2天）
- ✨ 新增5个用户端API任务
- ✨ 新增个人中心前端页面任务
- 📈 总工时从16-18天增加到18-20天

---

## Phase 1: 基础认证系统（4天）

### 1.1 数据库设计 ⏱️ 1天

- [ ] **T1.1.1** 设计数据库Schema
  - [ ] 创建`auth_users`表结构
  - [ ] 创建`admin_users`表结构
  - [ ] 创建`access_logs`表结构
  - [ ] 创建`login_history`表结构
  - [ ] 设计索引策略
  - 产出：`auth_models.py`

- [ ] **T1.1.2** 创建数据库模型
  - [ ] 使用SQLAlchemy定义`AuthUser`模型
  - [ ] 使用SQLAlchemy定义`AdminUser`模型
  - [ ] 使用SQLAlchemy定义`AccessLog`模型
  - [ ] 使用SQLAlchemy定义`LoginHistory`模型
  - [ ] 添加模型关系和约束
  - [ ] 添加`to_dict()`方法用于序列化
  - 产出：完整的ORM模型

- [ ] **T1.1.3** 数据库迁移脚本
  - [ ] 创建`init_auth_db.py`初始化脚本
  - [ ] 创建超级管理员数据
  - [ ] 测试数据库创建流程
  - 产出：可执行的初始化脚本

### 1.2 飞书OAuth2.0集成 ⏱️ 2天

- [ ] **T1.2.1** 飞书认证客户端
  - [ ] 创建`feishu_auth.py`模块
  - [ ] 实现`get_app_access_token()`方法
  - [ ] 实现`get_login_url()`方法
  - [ ] 实现`get_user_access_token()`方法
  - [ ] 实现`get_user_info()`方法
  - [ ] 错误处理和日志记录
  - 产出：完整的飞书认证客户端

- [ ] **T1.2.2** 飞书配置管理
  - [ ] 在`.env`中添加飞书配置
  - [ ] 创建配置验证函数
  - [ ] 测试飞书API连接
  - 产出：配置文件和验证脚本

- [ ] **T1.2.3** 单元测试
  - [ ] 测试获取app_access_token
  - [ ] 测试生成登录URL
  - [ ] 测试用户信息获取
  - [ ] Mock飞书API响应
  - 产出：`test_feishu_auth.py`

### 1.3 JWT认证实现 ⏱️ 1天

- [ ] **T1.3.1** JWT工具函数
  - [ ] 创建`jwt_utils.py`模块
  - [ ] 实现`generate_jwt_token()`函数
  - [ ] 实现`verify_jwt_token()`函数
  - [ ] 实现`refresh_jwt_token()`函数
  - [ ] 添加token黑名单机制（可选）
  - 产出：JWT工具模块

- [ ] **T1.3.2** 权限装饰器
  - [ ] 创建`auth_decorators.py`
  - [ ] 实现`@login_required`装饰器（用户权限）
  - [ ] 实现`@admin_required`装饰器（管理员权限）
  - [ ] 实现`@super_admin_required`装饰器（超级管理员）
  - [ ] 测试装饰器功能
  - 产出：权限装饰器模块

- [ ] **T1.3.3** JWT配置和测试
  - [ ] 配置JWT密钥和过期时间
  - [ ] 测试token生成和验证
  - [ ] 测试token过期处理
  - 产出：测试用例

---

## Phase 2: 用户端实现（3天）✨

### 2.1 用户端认证API ⏱️ 0.5天

- [ ] **T2.1.1** 登录API
  - [ ] 实现`POST /api/auth/feishu/login`
  - [ ] 生成随机state参数
  - [ ] 返回飞书登录URL
  - [ ] 错误处理
  - 产出：登录API端点

- [ ] **T2.1.2** 回调API
  - [ ] 实现`GET /api/auth/feishu/callback`
  - [ ] 验证state参数
  - [ ] 使用code换取access_token
  - [ ] 获取用户信息
  - [ ] 创建/更新用户记录（标记"内部"）
  - [ ] 生成JWT token
  - [ ] 重定向到前端页面
  - 产出：回调API端点

- [ ] **T2.1.3** 用户信息API
  - [ ] 实现`GET /api/auth/user-info`
  - [ ] 添加`@login_required`装饰器
  - [ ] 返回当前用户基本信息
  - 产出：用户信息API

- [ ] **T2.1.4** 退出登录API
  - [ ] 实现`POST /api/auth/logout`
  - [ ] 添加`@login_required`装饰器
  - [ ] 记录退出日志
  - 产出：退出API

### 2.2 用户个人中心API ⏱️ 1天 ✨

- [ ] **T2.2.1** 个人详细信息API
  - [ ] 实现`GET /api/user/profile`
  - [ ] 添加`@login_required`装饰器
  - [ ] 返回当前用户详细信息
  - [ ] 包含所有个人字段
  - 产出：个人信息API

- [ ] **T2.2.2** 更新个人信息API
  - [ ] 实现`PUT /api/user/profile`
  - [ ] 添加`@login_required`装饰器
  - [ ] 验证用户只能修改自己的数据
  - [ ] 限制可修改字段（email、mobile、avatar_url）
  - [ ] 禁止修改关键字段（role、status、user_type）
  - [ ] 字段验证和错误处理
  - 产出：更新信息API

- [ ] **T2.2.3** 个人登录历史API
  - [ ] 实现`GET /api/user/login-history`
  - [ ] 添加`@login_required`装饰器
  - [ ] 查询当前用户的登录历史（WHERE user_id = 当前用户）
  - [ ] 支持分页（page、per_page）
  - [ ] 按时间倒序排列
  - 产出：登录历史API

- [ ] **T2.2.4** 个人访问日志API
  - [ ] 实现`GET /api/user/access-logs`
  - [ ] 添加`@login_required`装饰器
  - [ ] 查询当前用户的访问日志（WHERE user_id = 当前用户）
  - [ ] 支持分页和日期筛选
  - [ ] 按时间倒序排列
  - 产出：访问日志API

- [ ] **T2.2.5** 个人统计数据API
  - [ ] 实现`GET /api/user/stats`
  - [ ] 添加`@login_required`装饰器
  - [ ] 统计总登录次数
  - [ ] 统计总访问次数
  - [ ] 统计今日访问次数
  - [ ] 统计最常访问页面
  - [ ] 计算账号年龄
  - 产出：统计数据API

### 2.3 用户端前端页面 ⏱️ 1.5天

- [ ] **T2.3.1** 登录页面
  - [ ] 创建`templates/login.html`
  - [ ] 设计登录页面UI
  - [ ] 添加飞书登录按钮
  - [ ] 添加二维码展示区域（可选）
  - 产出：登录页面HTML

- [ ] **T2.3.2** 登录页面JavaScript
  - [ ] 创建`static/js/login.js`
  - [ ] 实现检查登录状态
  - [ ] 实现飞书登录按钮点击事件
  - [ ] 实现回调token处理
  - [ ] 实现错误提示
  - 产出：登录页面JS

- [ ] **T2.3.3** 主页面权限控制
  - [ ] 修改`templates/index.html`
  - [ ] 添加登录状态检查
  - [ ] 实现用户信息显示
  - [ ] 添加退出按钮
  - [ ] 添加"个人中心"入口
  - [ ] 实现未登录跳转
  - 产出：权限控制代码

- [ ] **T2.3.4** 个人中心页面HTML ✨
  - [ ] 创建`templates/profile.html`
  - [ ] 设计页面布局（侧边栏+主内容）
  - [ ] 创建用户卡片组件
  - [ ] 创建侧边栏导航菜单
  - [ ] 创建5个Tab内容区
    - Tab 1: 基本信息展示
    - Tab 2: 编辑资料表单
    - Tab 3: 登录历史表格
    - Tab 4: 访问记录表格
    - Tab 5: 数据统计卡片
  - 产出：个人中心页面

- [ ] **T2.3.5** 个人中心JavaScript ✨
  - [ ] 创建`static/js/profile.js`
  - [ ] 实现登录状态检查
  - [ ] 实现Tab切换逻辑
  - [ ] 实现加载个人信息（调用`/api/user/profile`）
  - [ ] 实现显示个人信息
  - [ ] 实现编辑表单提交（调用`PUT /api/user/profile`）
  - [ ] 实现加载登录历史（调用`/api/user/login-history`）
  - [ ] 实现加载访问记录（调用`/api/user/access-logs`）
  - [ ] 实现加载统计数据（调用`/api/user/stats`）
  - [ ] 实现分页控件
  - [ ] 实现日期筛选
  - [ ] 实现退出登录
  - 产出：个人中心JS

- [ ] **T2.3.6** 个人中心CSS ✨
  - [ ] 创建`static/css/profile.css`
  - [ ] 设计侧边栏样式
  - [ ] 设计用户卡片样式
  - [ ] 设计Tab切换样式
  - [ ] 设计表格样式
  - [ ] 设计统计卡片样式
  - [ ] 设计表单样式
  - [ ] 响应式布局
  - 产出：个人中心样式表

- [ ] **T2.3.7** 访问日志前端
  - [ ] 实现页面访问日志记录
  - [ ] 创建`POST /api/auth/log-access` API
  - [ ] 自动记录页面访问
  - 产出：访问日志功能

- [ ] **T2.3.8** 登录页面CSS
  - [ ] 创建`static/css/login.css`
  - [ ] 设计现代化登录UI
  - [ ] 响应式布局
  - [ ] 飞书品牌配色
  - 产出：登录页面样式

---

## Phase 3: 管理端后端（4天）

### 3.1 管理员认证API ⏱️ 1天

- [ ] **T3.1.1** 管理员登录API
  - [ ] 实现`POST /api/admin/login`
  - [ ] 用户名密码验证
  - [ ] 密码哈希对比
  - [ ] 生成管理员JWT token
  - [ ] 记录登录历史
  - 产出：管理员登录API

- [ ] **T3.1.2** 管理员权限中间件
  - [ ] 创建`admin_middleware.py`
  - [ ] 实现权限检查逻辑
  - [ ] 支持both auth_users和admin_users
  - [ ] 角色权限验证
  - 产出：权限中间件

- [ ] **T3.1.3** 管理员飞书登录（可选）
  - [ ] 修改飞书回调逻辑
  - [ ] 支持管理员飞书登录
  - [ ] 自动授予管理员权限
  - 产出：管理员飞书登录

### 3.2 用户管理API ⏱️ 2天

- [ ] **T3.2.1** 用户列表API
  - [ ] 实现`GET /api/admin/users`
  - [ ] 支持分页（page, per_page）
  - [ ] 支持搜索（name, email）
  - [ ] 支持筛选（role, status, user_type）
  - [ ] 支持排序（created_at, last_login_at）
  - [ ] 添加`@admin_required`装饰器
  - 产出：用户列表API

- [ ] **T3.2.2** 用户详情API
  - [ ] 实现`GET /api/admin/users/<id>`
  - [ ] 返回用户完整信息
  - [ ] 包含登录历史
  - [ ] 包含最近访问日志
  - [ ] 添加`@admin_required`装饰器
  - 产出：用户详情API

- [ ] **T3.2.3** 用户更新API
  - [ ] 实现`PUT /api/admin/users/<id>`
  - [ ] 支持更新role
  - [ ] 支持更新status
  - [ ] 支持更新部门等信息
  - [ ] 记录操作日志
  - [ ] 添加`@admin_required`装饰器
  - 产出：用户更新API

- [ ] **T3.2.4** 批量操作API
  - [ ] 实现`POST /api/admin/users/batch`
  - [ ] 支持批量启用/禁用
  - [ ] 支持批量修改角色
  - [ ] 支持批量导入（CSV/Excel）
  - [ ] 添加`@super_admin_required`装饰器
  - 产出：批量操作API

### 3.3 访问日志API ⏱️ 1天

- [ ] **T3.3.1** 访问日志列表API
  - [ ] 实现`GET /api/admin/logs`
  - [ ] 支持分页
  - [ ] 支持按用户筛选
  - [ ] 支持按时间范围筛选
  - [ ] 支持按页面URL筛选
  - [ ] 添加`@admin_required`装饰器
  - 产出：访问日志API

- [ ] **T3.3.2** 登录历史API
  - [ ] 实现`GET /api/admin/login-history`
  - [ ] 支持分页和筛选
  - [ ] 显示成功/失败登录
  - [ ] 显示IP和地理位置
  - 产出：登录历史API

- [ ] **T3.3.3** 访问日志中间件
  - [ ] 创建`log_middleware.py`
  - [ ] 实现before_request钩子
  - [ ] 实现after_request钩子
  - [ ] 自动记录所有API访问
  - [ ] 记录访问时长
  - 产出：访问日志中间件

- [ ] **T3.3.4** 日志导出API
  - [ ] 实现`GET /api/admin/logs/export`
  - [ ] 支持CSV导出
  - [ ] 支持Excel导出
  - [ ] 支持日期范围选择
  - [ ] 添加`@admin_required`装饰器
  - 产出：日志导出API

### 3.4 统计数据API ⏱️ 0.5天

- [ ] **T3.4.1** 仪表盘统计API
  - [ ] 实现`GET /api/admin/stats`
  - [ ] 统计总用户数
  - [ ] 统计活跃用户数
  - [ ] 统计今日登录数
  - [ ] 统计本周新增用户数
  - [ ] 生成登录趋势数据（近7天）
  - [ ] 生成用户分布数据
  - [ ] 添加`@admin_required`装饰器
  - 产出：统计数据API

- [ ] **T3.4.2** 最近活动API
  - [ ] 实现`GET /api/admin/recent-activity`
  - [ ] 返回最近登录记录
  - [ ] 返回最近用户操作
  - [ ] 支持实时更新（可选）
  - 产出：最近活动API

---

## Phase 4: 管理端前端（4天）

### 4.1 管理端登录页面 ⏱️ 0.5天

- [ ] **T4.1.1** 管理员登录页面
  - [ ] 创建`templates/admin_login.html`
  - [ ] 用户名密码表单
  - [ ] 添加飞书登录选项
  - [ ] 登录错误提示
  - 产出：管理登录页面

- [ ] **T4.1.2** 管理登录JavaScript
  - [ ] 创建`static/js/admin_login.js`
  - [ ] 实现表单提交
  - [ ] 实现token存储
  - [ ] 实现登录跳转
  - 产出：管理登录JS

### 4.2 管理端布局和导航 ⏱️ 0.5天

- [ ] **T4.2.1** 管理端通用布局
  - [ ] 创建`templates/admin_base.html`
  - [ ] 侧边栏导航
  - [ ] 顶部栏（用户信息、退出）
  - [ ] 面包屑导航
  - 产出：管理端基础布局

- [ ] **T4.2.2** 管理端CSS
  - [ ] 创建`static/css/admin.css`
  - [ ] 侧边栏样式
  - [ ] 响应式布局
  - [ ] 统一配色方案
  - [ ] 卡片和表格样式
  - 产出：管理端样式表

- [ ] **T4.2.3** 管理端公共JS
  - [ ] 创建`static/js/admin_common.js`
  - [ ] API请求封装
  - [ ] 权限验证
  - [ ] 公共工具函数
  - [ ] Toast提示组件
  - 产出：管理端公共JS

### 4.3 仪表盘页面 ⏱️ 1天

- [ ] **T4.3.1** 仪表盘HTML
  - [ ] 创建`templates/admin_dashboard.html`
  - [ ] 统计卡片布局
  - [ ] 图表容器
  - [ ] 最近活动列表
  - 产出：仪表盘页面

- [ ] **T4.3.2** 仪表盘JavaScript
  - [ ] 创建`static/js/admin_dashboard.js`
  - [ ] 加载统计数据
  - [ ] 渲染统计卡片
  - [ ] 集成Chart.js
  - [ ] 渲染登录趋势图
  - [ ] 渲染用户分布图
  - [ ] 加载最近活动
  - [ ] 实现数据刷新
  - 产出：仪表盘JS

### 4.4 用户管理页面 ⏱️ 1.5天

- [ ] **T4.4.1** 用户列表HTML
  - [ ] 创建`templates/admin_users.html`
  - [ ] 搜索和筛选工具栏
  - [ ] 用户列表表格
  - [ ] 分页控件
  - [ ] 用户详情模态框
  - [ ] 编辑用户模态框
  - 产出：用户管理页面

- [ ] **T4.4.2** 用户列表JavaScript
  - [ ] 创建`static/js/admin_users.js`
  - [ ] 加载用户列表
  - [ ] 实现搜索功能
  - [ ] 实现筛选功能
  - [ ] 实现排序功能
  - [ ] 实现分页功能
  - [ ] 实现用户详情查看
  - [ ] 实现用户编辑
  - [ ] 实现用户启用/禁用
  - [ ] 实现批量操作
  - 产出：用户管理JS

- [ ] **T4.4.3** 用户导入功能
  - [ ] 创建用户导入模态框
  - [ ] 支持CSV/Excel上传
  - [ ] 显示导入预览
  - [ ] 实现批量导入
  - [ ] 显示导入结果
  - 产出：用户导入功能

### 4.5 访问日志页面 ⏱️ 1天

- [ ] **T4.5.1** 访问日志HTML
  - [ ] 创建`templates/admin_logs.html`
  - [ ] 日志筛选工具栏
  - [ ] 日志列表表格
  - [ ] 日志详情展示
  - [ ] 分页控件
  - 产出：访问日志页面

- [ ] **T4.5.2** 访问日志JavaScript
  - [ ] 创建`static/js/admin_logs.js`
  - [ ] 加载访问日志
  - [ ] 实现时间范围筛选
  - [ ] 实现用户筛选
  - [ ] 实现页面URL筛选
  - [ ] 实现日志导出
  - [ ] 实现实时日志（WebSocket可选）
  - 产出：访问日志JS

- [ ] **T4.5.3** 登录历史页面
  - [ ] 创建登录历史视图
  - [ ] 显示成功/失败登录
  - [ ] 显示IP地理位置
  - [ ] 实现时间线视图
  - 产出：登录历史页面

---

## Phase 5: 测试和部署（3天）

### 5.1 单元测试 ⏱️ 1.5天

- [ ] **T5.1.1** 后端单元测试
  - [ ] 测试飞书认证模块
  - [ ] 测试JWT生成和验证
  - [ ] 测试权限装饰器
  - [ ] 测试用户模型
  - [ ] 测试所有认证API
  - [ ] 测试所有用户端API ✨
  - [ ] 测试所有管理端API
  - 产出：`tests/test_auth_system.py`

- [ ] **T5.1.2** 数据库测试
  - [ ] 测试用户创建和查询
  - [ ] 测试访问日志记录
  - [ ] 测试数据库约束
  - [ ] 测试数据库迁移
  - 产出：`tests/test_auth_db.py`

- [ ] **T5.1.3** 权限测试 ✨
  - [ ] 测试用户只能访问自己的数据
  - [ ] 测试用户不能修改关键字段
  - [ ] 测试管理员可以访问所有数据
  - [ ] 测试权限边界情况
  - 产出：`tests/test_permissions.py`

- [ ] **T5.1.4** 集成测试
  - [ ] 测试完整登录流程
  - [ ] 测试权限验证流程
  - [ ] 测试用户管理流程
  - [ ] 测试访问日志流程
  - [ ] 测试个人中心功能 ✨
  - 产出：`tests/test_auth_integration.py`

### 5.2 功能测试 ⏱️ 0.5天

- [ ] **T5.2.1** 用户端测试
  - [ ] 测试飞书扫码登录
  - [ ] 测试用户信息显示
  - [ ] 测试个人中心访问 ✨
  - [ ] 测试查看个人信息 ✨
  - [ ] 测试修改个人信息 ✨
  - [ ] 测试查看登录历史 ✨
  - [ ] 测试查看访问记录 ✨
  - [ ] 测试统计数据展示 ✨
  - [ ] 测试权限控制
  - [ ] 测试退出登录
  - [ ] 测试跨浏览器兼容性
  - 产出：测试报告

- [ ] **T5.2.2** 管理端测试
  - [ ] 测试管理员登录
  - [ ] 测试用户管理功能
  - [ ] 测试访问日志查看
  - [ ] 测试统计数据展示
  - [ ] 测试权限控制
  - 产出：测试报告

### 5.3 安全测试 ⏱️ 0.5天

- [ ] **T5.3.1** 安全扫描
  - [ ] SQL注入测试
  - [ ] XSS攻击测试
  - [ ] CSRF攻击测试
  - [ ] Token篡改测试
  - [ ] 权限绕过测试 ✨
  - [ ] 数据泄露测试 ✨
  - 产出：安全测试报告

- [ ] **T5.3.2** 性能测试
  - [ ] 并发登录测试（100用户）
  - [ ] API响应时间测试
  - [ ] 数据库查询性能测试
  - [ ] 前端加载速度测试
  - 产出：性能测试报告

### 5.4 部署和文档 ⏱️ 0.5天

- [ ] **T5.4.1** 部署准备
  - [ ] 编写部署文档
  - [ ] 配置生产环境变量
  - [ ] 配置HTTPS证书
  - [ ] 配置Nginx反向代理
  - [ ] 配置Supervisor进程管理
  - 产出：部署文档和配置文件

- [ ] **T5.4.2** 数据库迁移
  - [ ] 备份现有数据库
  - [ ] 执行数据库迁移
  - [ ] 创建超级管理员
  - [ ] 验证数据完整性
  - 产出：迁移完成

- [ ] **T5.4.3** 用户文档
  - [ ] 编写用户使用指南
  - [ ] 编写个人中心使用指南 ✨
  - [ ] 编写管理员使用指南
  - [ ] 编写FAQ文档
  - [ ] 录制演示视频（可选）
  - 产出：用户文档

---

## Phase 6: 后续优化（可选）

### 6.1 功能增强

- [ ] **T6.1.1** 多因素认证（MFA）
  - [ ] 短信验证码
  - [ ] 邮箱验证码
  - [ ] Google Authenticator

- [ ] **T6.1.2** 单点登录（SSO）
  - [ ] 支持其他OAuth2.0平台
  - [ ] 支持SAML协议
  - [ ] 支持LDAP集成

- [ ] **T6.1.3** 细粒度权限控制
  - [ ] 实现RBAC权限模型
  - [ ] 资源级权限控制
  - [ ] 权限继承和组合

- [ ] **T6.1.4** 个人中心增强 ✨
  - [ ] 头像上传功能
  - [ ] 密码修改（如果支持密码登录）
  - [ ] 邮箱验证
  - [ ] 手机号验证
  - [ ] 个性化设置

### 6.2 用户体验优化

- [ ] **T6.2.1** 移动端适配
  - [ ] 响应式优化
  - [ ] 移动端手势支持
  - [ ] PWA支持

- [ ] **T6.2.2** 国际化支持
  - [ ] 多语言切换
  - [ ] 时区处理
  - [ ] 货币和日期格式化

- [ ] **T6.2.3** 个人中心体验优化 ✨
  - [ ] 实时数据更新
  - [ ] 图表可视化
  - [ ] 导出个人数据
  - [ ] 数据对比分析

### 6.3 运维工具

- [ ] **T6.3.1** 监控告警
  - [ ] 登录失败告警
  - [ ] 异常访问告警
  - [ ] 系统异常告警

- [ ] **T6.3.2** 数据分析
  - [ ] 用户行为分析
  - [ ] 访问热图
  - [ ] 留存分析

---

## 任务优先级总览

### P0 - 核心功能（必须完成）

| 任务 | 阶段 | 工时 | 依赖 | 变化 |
|------|------|------|------|------|
| 数据库设计和创建 | Phase 1 | 1天 | 无 | - |
| 飞书OAuth2.0集成 | Phase 1 | 2天 | T1.1 | - |
| JWT认证实现 | Phase 1 | 1天 | T1.1 | - |
| 用户端认证API | Phase 2.1 | 0.5天 | Phase 1 | - |
| **用户个人中心API** ✨ | **Phase 2.2** | **1天** | **T2.1** | **新增** |
| 用户端前端（登录+主页） | Phase 2.3 | 1天 | T2.1 | - |
| **个人中心前端** ✨ | **Phase 2.3** | **1.5天** | **T2.2** | **新增** |
| 管理员认证API | Phase 3.1 | 1天 | Phase 1 | - |
| 用户管理API | Phase 3.2 | 2天 | T3.1 | - |
| 管理端前端 | Phase 4 | 4天 | Phase 3 | - |

### P1 - 重要功能（建议完成）

| 任务 | 阶段 | 工时 | 依赖 | 变化 |
|------|------|------|------|------|
| 访问日志API | Phase 3.3 | 1天 | T3.1 | - |
| 统计数据API | Phase 3.4 | 0.5天 | T3.2, T3.3 | - |
| 单元测试 | Phase 5.1 | 1.5天 | All | +0.5天 |
| 功能测试 | Phase 5.2 | 0.5天 | Phase 4 | - |
| 安全测试 | Phase 5.3 | 0.5天 | Phase 4 | - |

### P2 - 可选功能（时间允许时）

| 任务 | 阶段 | 工时 | 依赖 |
|------|------|------|------|
| 多因素认证 | Phase 6.1 | 2天 | Phase 5 |
| 单点登录 | Phase 6.1 | 3天 | Phase 5 |
| **个人中心增强** ✨ | **Phase 6.1** | **2天** | **Phase 5** |
| 移动端适配 | Phase 6.2 | 2天 | Phase 5 |
| 监控告警 | Phase 6.3 | 2天 | Phase 5 |

---

## 里程碑 Milestones（更新版）

| 里程碑 | 完成日期 | 交付物 | 验收标准 | 变化 |
|--------|----------|--------|----------|------|
| **M1**: 基础认证完成 | Day 4 | 飞书登录+JWT | 用户可以扫码登录 | - |
| **M2**: 用户端完成 ✨ | **Day 7** | **用户端页面+个人中心** | **用户可以登录、访问网站、管理个人信息** | **+2天** |
| **M3**: 管理API完成 | Day 11 | 所有管理API | API测试通过 | - |
| **M4**: 管理前端完成 | Day 15 | 管理后台 | 管理员可以管理用户 | - |
| **M5**: 测试和部署完成 | Day 18-20 | 生产环境 | 系统上线运行 | - |

---

## 资源需求

### 人员配置

- **后端开发**: 1人（Python/Flask）
- **前端开发**: 1人（HTML/JS/CSS）
- **测试工程师**: 0.5人（可兼职）
- **项目经理**: 0.5人（可兼职）

### 技术资源

- **开发环境**: Python 3.9+, PostgreSQL 14+
- **测试环境**: 独立测试服务器
- **生产环境**: HTTPS域名, SSL证书
- **第三方服务**: 飞书开放平台账号

---

## 风险和应对

| 风险 | 概率 | 影响 | 应对措施 | 负责人 | 变化 |
|------|------|------|----------|--------|------|
| 飞书API调试困难 | 中 | 高 | 提前测试，准备fallback方案 | 后端 | - |
| **个人中心功能复杂** ✨ | **中** | **中** | **分阶段实现，先核心后增强** | **前后端** | **新增** |
| 前端兼容性问题 | 低 | 中 | 使用现代浏览器标准 | 前端 | - |
| 时间估算不准 | 中 | 中 | 预留20%缓冲时间 | PM | - |
| 安全漏洞 | 低 | 高 | 严格代码审查和安全测试 | 全员 | - |
| **权限控制出错** ✨ | **中** | **高** | **严格测试用户数据隔离** | **后端** | **新增** |

---

## 每日/每周检查点

### 每日站会（15分钟）

- 昨天完成了什么？
- 今天计划做什么？
- 遇到什么问题/阻碍？

### 每周回顾（30分钟）

- 本周完成的任务
- 与计划的偏差
- 下周计划调整
- 风险更新

---

## 质量标准

### 代码质量

- [ ] 代码审查（Code Review）
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试通过
- [ ] Pylint评分 > 8.0
- [ ] 无明显性能问题

### 功能质量

- [ ] 所有P0任务完成
- [ ] 核心功能测试通过
- [ ] 用户界面友好
- [ ] 响应时间 < 500ms
- [ ] 无严重Bug
- [ ] **用户数据隔离正确** ✨
- [ ] **权限控制无漏洞** ✨

### 安全质量

- [ ] 通过安全扫描
- [ ] 无SQL注入漏洞
- [ ] 无XSS漏洞
- [ ] Token安全验证
- [ ] 权限控制正确
- [ ] **用户数据访问权限正确** ✨
- [ ] **防止越权访问** ✨

---

## 交付清单

### 代码交付

- [ ] 完整源代码（带注释）
- [ ] 数据库迁移脚本
- [ ] 单元测试代码
- [ ] 配置文件模板
- [ ] **个人中心前后端代码** ✨

### 文档交付

- [ ] 系统设计文档
- [ ] API接口文档（包含用户端API）✨
- [ ] 部署操作手册
- [ ] 用户使用手册
- [ ] **个人中心使用指南** ✨
- [ ] 数据库Schema文档

### 测试交付

- [ ] 单元测试报告
- [ ] 功能测试报告
- [ ] 安全测试报告
- [ ] 性能测试报告
- [ ] **权限测试报告** ✨

---

## v2.0 更新总结

### 新增内容

1. **5个用户端API**
   - `GET /api/user/profile` - 个人详细信息
   - `PUT /api/user/profile` - 更新个人信息
   - `GET /api/user/login-history` - 个人登录历史
   - `GET /api/user/access-logs` - 个人访问日志
   - `GET /api/user/stats` - 个人统计数据

2. **个人中心前端**
   - `profile.html` - 个人中心页面
   - `profile.js` - 个人中心逻辑
   - `profile.css` - 个人中心样式
   - 5个Tab页（基本信息、编辑资料、登录历史、访问记录、数据统计）

3. **新增任务**
   - Phase 2.2: 用户个人中心API（5个任务）
   - Phase 2.3.4-2.3.6: 个人中心前端（3个任务）
   - 权限测试任务
   - 个人中心增强（Phase 6）

### 时间调整

- **原计划**: 16-18个工作日
- **新计划**: 18-20个工作日
- **增加**: +2天（用户个人中心开发）

### 风险更新

- 新增"个人中心功能复杂"风险
- 新增"权限控制出错"风险
- 强调数据隔离和越权访问防护

---

**任务清单完成（v2.0）**

**生成时间**: 2025-12-16 19:00  
**版本**: v2.0  
**总任务数**: 120+（比v1.0增加约20个任务）  
**预计工期**: 18-20个工作日  
**主要更新**: 完整的用户个人中心功能  
**状态**: ✅ 待分配

