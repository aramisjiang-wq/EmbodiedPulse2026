# 管理端论文和视频管理页面设计方案

## 一、需求概述

在现有管理端基础上，新增两个子页面：
1. **论文管理页面** (`/admin/papers`) - 展示和管理具身论文数据库
2. **视频管理页面** (`/admin/bilibili`) - 展示和管理具身视频（B站）数据库

参考现有的用户管理页面 (`/admin/users`) 的设计和实现方式。

---

## 二、功能设计

### 2.1 论文管理页面 (`/admin/papers`)

#### 核心功能
1. **论文列表展示**
   - 分页显示（每页20条）
   - 表格展示：ID、标题、作者、发布日期、类别、引用数、操作
   - 支持排序（按日期、引用数、标题）

2. **搜索和筛选**
   - 关键词搜索（标题、作者、摘要）
   - 类别筛选（下拉选择，使用taxonomy中的类别）
   - 日期范围筛选（开始日期、结束日期）
   - 引用数筛选（最小引用数）

3. **论文详情**
   - 查看完整信息（标题、作者、摘要、PDF链接、代码链接、Semantic Scholar数据等）
   - 显示分类信息
   - 显示更新时间

4. **编辑功能**
   - 修改类别（手动重新分类）
   - 修改标题（修正错误）
   - 添加/修改代码链接
   - 标记为已读/未读（可选）

5. **批量操作**
   - 批量删除（谨慎使用）
   - 批量重新分类
   - 批量导出（CSV/JSON）

6. **数据统计**
   - 总论文数
   - 按类别统计
   - 最近7天新增论文数
   - 平均引用数

#### 页面布局
```
┌─────────────────────────────────────────────────────────┐
│  侧边栏导航                                              │
│  - 仪表盘                                                │
│  - 用户管理                                              │
│  - 论文管理 (新增) ← 当前页面                            │
│  - 视频管理 (新增)                                       │
│  - 日志监控                                              │
└─────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────┐
│  顶部栏: 论文管理                                        │
├─────────────────────────────────────────────────────────┤
│  搜索和筛选区                                            │
│  [搜索框] [类别筛选] [日期范围] [引用数] [搜索] [重置]    │
├─────────────────────────────────────────────────────────┤
│  统计卡片区                                              │
│  [总论文数] [今日新增] [平均引用] [类别数]                │
├─────────────────────────────────────────────────────────┤
│  论文表格                                                │
│  [复选框] ID | 标题 | 作者 | 日期 | 类别 | 引用 | 操作  │
│  ...                                                     │
├─────────────────────────────────────────────────────────┤
│  分页控件                                                │
└─────────────────────────────────────────────────────────┘
```

---

### 2.2 视频管理页面 (`/admin/bilibili`)

#### 核心功能
1. **UP主列表展示**
   - 分页显示（每页20条）
   - 表格展示：UID、名称、粉丝数、视频数、总播放量、最后更新、操作
   - 支持排序（按粉丝数、视频数、播放量）

2. **视频列表展示**
   - 分页显示（每页20条）
   - 表格展示：BV号、标题、UP主、发布时间、播放量、评论数、收藏数、操作
   - 支持按UP主筛选

3. **搜索和筛选**
   - 关键词搜索（UP主名称、视频标题）
   - UP主筛选（下拉选择）
   - 日期范围筛选
   - 播放量筛选（最小播放量）

4. **详情查看**
   - UP主详情：基本信息、统计数据、视频列表
   - 视频详情：完整信息、封面图、链接

5. **编辑功能**
   - 修改UP主状态（激活/停用）
   - 修改视频信息（标题、描述）
   - 标记视频为已删除（如果视频被UP主删除）

6. **批量操作**
   - 批量更新UP主数据（重新抓取）
   - 批量删除视频
   - 批量导出

7. **数据统计**
   - 总UP主数
   - 总视频数
   - 总播放量
   - 最近7天新增视频数

#### 页面布局（Tab切换）
```
┌─────────────────────────────────────────────────────────┐
│  侧边栏导航                                              │
│  - 仪表盘                                                │
│  - 用户管理                                              │
│  - 论文管理                                              │
│  - 视频管理 (新增) ← 当前页面                            │
│  - 日志监控                                              │
└─────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────┐
│  顶部栏: 视频管理                                        │
├─────────────────────────────────────────────────────────┤
│  Tab切换: [UP主列表] [视频列表]                          │
├─────────────────────────────────────────────────────────┤
│  搜索和筛选区                                            │
│  [搜索框] [UP主筛选] [日期范围] [播放量] [搜索] [重置]  │
├─────────────────────────────────────────────────────────┤
│  统计卡片区                                              │
│  [总UP主数] [总视频数] [总播放量] [今日新增]            │
├─────────────────────────────────────────────────────────┤
│  数据表格                                                │
│  (根据Tab显示UP主列表或视频列表)                         │
├─────────────────────────────────────────────────────────┤
│  分页控件                                                │
└─────────────────────────────────────────────────────────┘
```

---

## 三、技术实现

### 3.1 文件结构

```
templates/
├── admin_papers.html          # 论文管理页面（新增）
├── admin_bilibili.html        # 视频管理页面（新增）
└── ... (现有文件)

static/
├── js/
│   ├── admin_papers.js         # 论文管理页面逻辑（新增）
│   └── admin_bilibili.js       # 视频管理页面逻辑（新增）
└── css/
    └── admin.css               # 管理端样式（已存在，可能需要扩展）

app.py                          # 添加页面路由
auth_routes.py                  # 添加API路由（admin_bp蓝图）
```

---

### 3.2 API设计

#### 论文管理API (`/api/admin/papers`)

```python
# 获取论文列表（分页、搜索、筛选）
GET /api/admin/papers?page=1&per_page=20&search=&category=&date_from=&date_to=&min_citations=

# 获取论文详情
GET /api/admin/papers/{paper_id}

# 更新论文信息
PUT /api/admin/papers/{paper_id}
{
    "category": "Perception/3D Perception",
    "code_url": "https://github.com/...",
    "title": "修正后的标题"
}

# 删除论文
DELETE /api/admin/papers/{paper_id}

# 批量操作
POST /api/admin/papers/batch
{
    "paper_ids": ["1234.5678", "2345.6789"],
    "action": "delete" | "update_category" | "export",
    "value": "Perception/3D Perception" (如果action是update_category)
}

# 获取统计信息
GET /api/admin/papers/stats
```

#### 视频管理API (`/api/admin/bilibili`)

```python
# 获取UP主列表
GET /api/admin/bilibili/ups?page=1&per_page=20&search=&is_active=

# 获取UP主详情
GET /api/admin/bilibili/ups/{uid}

# 更新UP主信息
PUT /api/admin/bilibili/ups/{uid}
{
    "is_active": true,
    "name": "修正后的名称"
}

# 获取视频列表
GET /api/admin/bilibili/videos?page=1&per_page=20&search=&uid=&date_from=&date_to=&min_play=

# 获取视频详情
GET /api/admin/bilibili/videos/{bvid}

# 更新视频信息
PUT /api/admin/bilibili/videos/{bvid}
{
    "title": "修正后的标题",
    "is_deleted": false
}

# 删除视频
DELETE /api/admin/bilibili/videos/{bvid}

# 批量操作
POST /api/admin/bilibili/videos/batch
{
    "video_ids": ["BV1234567890", "BV0987654321"],
    "action": "delete" | "update_up" | "export"
}

# 获取统计信息
GET /api/admin/bilibili/stats

# 手动触发UP主数据更新
POST /api/admin/bilibili/ups/{uid}/refresh
```

---

### 3.3 数据库查询优化

#### 论文查询
- 使用索引：`category`, `publish_date`, `title`
- 分页查询：使用`LIMIT`和`OFFSET`
- 搜索：使用`LIKE`或全文搜索（如果支持）

#### 视频查询
- 使用索引：`uid`, `pubdate`, `play`
- 关联查询：UP主和视频的JOIN查询
- 分页查询：使用`LIMIT`和`OFFSET`

---

## 四、UI/UX设计

### 4.1 设计原则
1. **一致性**：与现有用户管理页面保持一致的设计风格
2. **响应式**：支持不同屏幕尺寸
3. **易用性**：操作简单直观，减少点击次数
4. **性能**：大数据量时使用分页和懒加载

### 4.2 关键组件

#### 表格组件
- 支持排序（点击表头）
- 支持多选（复选框）
- 支持行内操作（查看、编辑、删除）

#### 模态框组件
- 详情模态框（只读）
- 编辑模态框（表单）
- 确认对话框（删除确认）

#### 筛选组件
- 搜索框（实时搜索或按钮触发）
- 下拉选择（类别、状态等）
- 日期选择器（日期范围）

#### 统计卡片
- 数字展示（大号字体）
- 趋势指示（上升/下降箭头）
- 点击跳转（可选）

---

## 五、实施步骤

### 阶段一：基础功能（1-2天）
1. ✅ 创建页面模板（HTML）
2. ✅ 添加路由（app.py）
3. ✅ 创建API端点（auth_routes.py）
4. ✅ 实现基础列表展示

### 阶段二：搜索和筛选（1天）
1. ✅ 实现搜索功能
2. ✅ 实现筛选功能
3. ✅ 实现分页

### 阶段三：编辑和操作（1-2天）
1. ✅ 实现详情查看
2. ✅ 实现编辑功能
3. ✅ 实现批量操作

### 阶段四：统计和优化（1天）
1. ✅ 实现统计信息
2. ✅ 性能优化
3. ✅ UI优化

---

## 六、安全考虑

1. **权限控制**
   - 所有API使用`@admin_required`装饰器
   - 敏感操作（删除、批量操作）需要额外确认

2. **数据验证**
   - 前端和后端双重验证
   - 防止SQL注入（使用ORM）
   - 防止XSS攻击（转义用户输入）

3. **操作日志**
   - 记录所有管理操作（可选）
   - 记录操作人和操作时间

---

## 七、扩展功能（可选）

### 7.1 论文管理
- 论文质量评分
- 自动分类建议
- 重复论文检测
- 论文关联分析

### 7.2 视频管理
- 视频热度分析
- UP主活跃度分析
- 视频推荐算法
- 数据可视化图表

---

## 八、总结

本方案提供了完整的论文和视频管理页面设计，包括：
- ✅ 功能设计
- ✅ 技术实现
- ✅ UI/UX设计
- ✅ 实施步骤
- ✅ 安全考虑

所有设计都参考了现有的用户管理页面，确保一致性和可维护性。

---

## 附录：API响应格式示例

### 论文列表响应
```json
{
    "success": true,
    "papers": [
        {
            "id": "2312.12345",
            "title": "论文标题",
            "authors": "Author1, Author2",
            "publish_date": "2025-12-16",
            "category": "Perception/3D Perception",
            "citation_count": 10,
            "pdf_url": "https://arxiv.org/pdf/...",
            "code_url": "https://github.com/...",
            "created_at": "2025-12-16T10:00:00"
        }
    ],
    "pagination": {
        "current_page": 1,
        "per_page": 20,
        "total": 1000,
        "total_pages": 50
    }
}
```

### 视频列表响应
```json
{
    "success": true,
    "videos": [
        {
            "bvid": "BV1234567890",
            "title": "视频标题",
            "uid": 123456789,
            "up_name": "UP主名称",
            "pubdate": "2025-12-16T10:00:00",
            "play": 10000,
            "play_formatted": "1.0万",
            "video_review": 100,
            "favorites": 50,
            "url": "https://www.bilibili.com/video/..."
        }
    ],
    "pagination": {
        "current_page": 1,
        "per_page": 20,
        "total": 5000,
        "total_pages": 250
    }
}
```

