# 代码清理报告

**版本**: v1.0  
**日期**: 2025-12-17  
**目的**: 清理冗余文件、脚本和数据库文件

---

## 📊 清理前状态

### 数据库文件（8个）

| 文件 | 大小 | 用途 | 状态 |
|------|------|------|------|
| `papers.db` | 20MB | 论文数据库 | ✅ 保留 |
| `bilibili.db` | 432KB | B站视频数据库 | ✅ 保留 |
| `news.db` | 1.4MB | 新闻数据库 | ⚠️ 可选 |
| `jobs.db` | 316KB | 招聘数据库 | ⚠️ 可选 |
| `datasets.db` | 32KB | 数据集数据库 | ⚠️ 可选 |
| `instance/papers.db` | 68KB | 认证数据库 | ✅ 保留 |
| `hf_dataset_papers.db` | 28KB | HuggingFace数据集 | ❌ 测试/临时 |
| `humanoid_companies.db` | 204KB | 人形机器人公司 | ❌ 测试/临时 |

### 脚本文件（75个）

**部署相关脚本**: 22个
- ✅ 保留: 12个（实际使用的）
- ❌ 冗余: 10个（旧脚本、Docker脚本、中文脚本）

**测试脚本**: 3个
- ❌ 移动到备份

**临时抓取脚本**: 8个
- ❌ 移动到备份（特定日期/用途）

**临时分类脚本**: 3个
- ❌ 移动到备份（一次性使用）

**其他冗余脚本**: 8个
- ❌ 移动到备份

---

## 🗑️ 清理方案

### 1. 数据库文件清理

**保留**:
- ✅ `papers.db` - 主要数据库
- ✅ `bilibili.db` - B站数据库
- ✅ `instance/papers.db` - 认证数据库

**移动到备份**:
- ⚠️ `hf_dataset_papers.db` - 测试数据库
- ⚠️ `humanoid_companies.db` - 测试数据库

**可选保留**:
- `news.db` - 如果使用新闻功能
- `jobs.db` - 如果使用招聘功能
- `datasets.db` - 如果使用数据集功能

### 2. 脚本文件清理

**保留的核心脚本** (12个):
1. `scripts/deploy_server.sh` - GitHub Actions使用
2. `scripts/create_systemd_service.sh` - 创建服务
3. `scripts/nginx_config_fix.sh` - Nginx配置
4. `scripts/setup_https.sh` - HTTPS配置
5. `scripts/fix_port_and_service.sh` - 修复端口和服务
6. `scripts/backup_databases.sh` - 数据库备份
7. `scripts/monitor_system.sh` - 系统监控
8. `scripts/disaster_recovery.sh` - 故障恢复
9. `scripts/setup_backup_and_monitor.sh` - 设置备份和监控
10. `scripts/migrate_database_to_server.sh` - 数据库迁移
11. `scripts/check_deployment_status.sh` - 部署检查
12. `scripts/verify_deployment.sh` - 部署验证

**移动到备份的脚本** (约30个):
- 旧部署脚本（`deploy.sh`, `deploy_auto.sh`等）
- Docker部署脚本（`deploy_on_server.sh`, `quick_deploy.sh`等）
- 中文脚本名（`服务器初始化部署.sh`等）
- 测试脚本（`test_*.py`）
- 临时抓取脚本（`fetch_dec16_papers.py`等）
- 临时分类脚本（`reclassify_dec16_papers.py`等）
- 其他冗余脚本

---

## 🔍 数据库配置说明

### 当前状态

**服务器实际使用**: SQLite数据库

**原因**:
1. 服务器部署使用 **Gunicorn + systemd**（非Docker）
2. `.env` 文件中 `DATABASE_URL` 默认值为 `sqlite:///./papers.db`
3. 代码支持PostgreSQL，但需要显式配置

### PostgreSQL支持情况

**代码已支持PostgreSQL**:
- ✅ 所有模型文件都支持PostgreSQL和SQLite
- ✅ `docker-compose.yml` 配置了PostgreSQL（Docker部署）
- ⚠️ 但服务器实际部署未使用Docker，所以使用SQLite

**如需升级到PostgreSQL**:
1. 在服务器上安装PostgreSQL
2. 创建数据库和用户
3. 使用 `migrate_sqlite_to_postgresql.py` 迁移数据
4. 更新 `.env` 中的 `DATABASE_URL`
5. 重启服务

详见：[数据库配置说明](./docs/项目文档/06-安装部署/配置指南/数据库配置说明_20251217_v1.0.md)

---

## 📝 清理执行

### 使用清理脚本

```bash
cd "/Users/dong/Documents/Cursor/Embodied Pulse"
bash scripts/cleanup_redundant_files.sh
```

**脚本功能**:
- ✅ 移动冗余文件到备份目录（不直接删除）
- ✅ 保留所有核心脚本
- ✅ 显示清理统计

### 手动清理（可选）

如果确认某些文件不再需要，可以手动删除：

```bash
# 删除测试数据库
rm hf_dataset_papers.db
rm humanoid_companies.db

# 删除旧部署脚本（确认不再需要后）
rm scripts/deploy.sh
rm scripts/deploy_auto.sh
# ... 其他冗余脚本
```

---

## ✅ 清理后预期

### 数据库文件
- 保留: 3-6个（根据功能需求）
- 清理: 2个测试数据库

### 脚本文件
- 保留: 约45个核心脚本
- 清理: 约30个冗余脚本

### 项目结构
- 更清晰
- 更容易维护
- 减少混淆

---

## ⚠️ 注意事项

1. **备份优先**: 清理脚本会将文件移动到备份目录，不直接删除
2. **确认后再删除**: 备份目录可以保留一段时间，确认无误后再删除
3. **数据库文件**: 测试数据库可以删除，但主要数据库必须保留
4. **脚本文件**: 如果不确定某个脚本是否还需要，建议先移动到备份

---

## 🔗 相关文档

- [数据库配置说明](./docs/项目文档/06-安装部署/配置指南/数据库配置说明_20251217_v1.0.md)
- [代码推送规范](./docs/项目文档/11-开发规范/代码推送规范_20251217_v1.0.md)

---

**文档版本**: v1.0  
**最后更新**: 2025-12-17  
**维护者**: AI Assistant

