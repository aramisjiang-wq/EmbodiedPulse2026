# 抓取配置优化

**文档创建时间**: 2025-12-09  
**最后更新时间**: 2025-12-09

---

## 📋 优化内容

### 1. max_results 默认值调整

**修改前**：
- `config.yaml`: `max_results: 20`
- `daily_arxiv.py`: 默认值 `20`
- `app.py` (手动抓取): 默认值 `20`
- `app.py` (自动抓取): 默认值 `10`

**修改后**：
- `config.yaml`: `max_results: 100`
- `daily_arxiv.py`: 默认值 `100`
- `app.py` (手动抓取): 默认值 `100`
- `app.py` (自动抓取): 默认值 `100`

**原因**：
- 之前 `max_results=20` 导致某些日期的论文（如12月8日）没有被抓取到
- 增加默认值到100，确保抓取更多最新论文，减少遗漏

---

### 2. 自动更新频率调整

**修改前**：
- 每天执行1次
- 默认时间：凌晨2点（UTC）
- Cron表达式：`0 2 * * *`

**修改后**：
- 每天执行2次
- 默认时间：凌晨2点和下午2点（UTC）
- Cron表达式：`0 2 * * *;0 14 * * *`

**原因**：
- 提高更新频率，确保及时抓取最新论文
- ArXiv通常在每天的不同时间更新，2次更新可以覆盖更多时间段

---

## 🔧 技术实现

### 多时间点支持

修改了 `app.py` 中的 `start_scheduler()` 函数，支持多个cron表达式：

```python
# 支持用分号分隔多个cron表达式
schedule_cron = os.getenv('AUTO_FETCH_SCHEDULE', '0 2 * * *;0 14 * * *')

# 解析并添加多个任务
cron_list = schedule_cron.split(';')
for idx, cron_expr in enumerate(cron_list):
    # 为每个时间点创建独立的job
    scheduler.add_job(
        scheduled_fetch,
        trigger=CronTrigger(...),
        id=f'daily_fetch_{idx}',
        name=f'每日论文抓取_{idx+1}',
        replace_existing=True
    )
```

---

## 📝 配置说明

### 环境变量

| 变量 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `AUTO_FETCH_SCHEDULE` | Cron表达式（支持多个，用分号分隔） | `0 2 * * *;0 14 * * *` | `0 8 * * *;0 20 * * *` |
| `AUTO_FETCH_MAX_RESULTS` | 每次抓取数量 | `100` | `50`, `100`, `200` |

### Cron表达式示例

```bash
# 每天2次（默认）
0 2 * * *;0 14 * * *    # 凌晨2点和下午2点

# 每天3次
0 2 * * *;0 10 * * *;0 18 * * *    # 2点、10点、18点

# 每天1次
0 2 * * *    # 凌晨2点

# 每12小时
0 */12 * * *    # 每12小时（0点、12点）
```

---

## ✅ 修改的文件

1. **config.yaml**
   - `max_results: 20` → `max_results: 100`

2. **daily_arxiv.py**
   - `config.get('max_results', 20)` → `config.get('max_results', 100)`

3. **app.py**
   - 手动抓取：`request.json.get('max_results', 20)` → `request.json.get('max_results', 100)`
   - 自动抓取：`os.getenv('AUTO_FETCH_MAX_RESULTS', 10)` → `os.getenv('AUTO_FETCH_MAX_RESULTS', 100)`
   - 调度器：支持多个cron表达式（用分号分隔）

4. **start_with_auto_fetch.sh**
   - 更新默认调度时间：`0 2 * * *` → `0 2 * * *;0 14 * * *`
   - 更新默认抓取数量：`10` → `100`

---

## 🎯 预期效果

1. **减少遗漏**
   - 增加 `max_results` 到100，确保抓取更多论文
   - 减少因数量限制导致的遗漏（如12月8日的论文）

2. **提高更新频率**
   - 每天2次更新，覆盖更多时间段
   - 及时抓取ArXiv在不同时间更新的论文

3. **灵活性**
   - 支持通过环境变量自定义多个更新时间
   - 可以根据需要调整抓取数量

---

## ⚠️ 注意事项

1. **API速率限制**
   - ArXiv API有速率限制，建议不要设置过高的 `max_results`
   - 当前设置100篇是经过测试的安全值

2. **时区设置**
   - Cron表达式使用UTC时间
   - 需要根据服务器时区调整时间点

3. **资源消耗**
   - 增加抓取数量和频率会增加服务器资源消耗
   - 建议监控服务器性能

---

## 📚 相关文档

- [论文抓取策略优化_20251208.md](./论文抓取策略优化_20251208.md)
- [自动抓取实现方案_20251208.md](./自动抓取实现方案_20251208.md)
- [自动抓取环境配置指南_20251208.md](./自动抓取环境配置指南_20251208.md)

---

**操作时间**: 2025-12-09  
**操作人员**: AI Assistant

