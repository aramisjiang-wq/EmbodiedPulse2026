# ä»0åˆ°1å®Œæ•´éƒ¨ç½²æ•™ç¨‹ - Embodied Pulse ç½‘ç«™ä¸Šçº¿æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-17  
**é€‚ç”¨é¡¹ç›®**: EmbodiedPulse2026  
**ç›®æ ‡**: è®©å°ç™½ä¹Ÿèƒ½å®Œæˆç½‘ç«™ä»é›¶åˆ°ä¸Šçº¿çš„å®Œæ•´éƒ¨ç½²

---

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„ä¸é€»è¾‘è¯´æ˜](#ä¸€æ•´ä½“æ¶æ„ä¸é€»è¾‘è¯´æ˜)
2. [éƒ¨ç½²å‰å‡†å¤‡](#äºŒéƒ¨ç½²å‰å‡†å¤‡)
3. [æœåŠ¡å™¨åŸºç¡€ç¯å¢ƒé…ç½®](#ä¸‰æœåŠ¡å™¨åŸºç¡€ç¯å¢ƒé…ç½®)
4. [ä»£ç éƒ¨ç½²](#å››ä»£ç éƒ¨ç½²)
5. [æ•°æ®åº“è¿ç§»](#äº”æ•°æ®åº“è¿ç§»)
6. [æœåŠ¡é…ç½®](#å…­æœåŠ¡é…ç½®)
7. [Nginx é…ç½®](#ä¸ƒnginx-é…ç½®)
8. [HTTPS è¯ä¹¦é…ç½®](#å…«https-è¯ä¹¦é…ç½®)
9. [GitHub Actions è‡ªåŠ¨éƒ¨ç½²](#ä¹github-actions-è‡ªåŠ¨éƒ¨ç½²)
10. [ä¸Šçº¿å‰æ£€æŸ¥](#åä¸Šçº¿å‰æ£€æŸ¥)
11. [å¸¸è§é—®é¢˜ä¸Debug](#åä¸€å¸¸è§é—®é¢˜ä¸debug)
12. [å¿«é€Ÿå‚è€ƒ](#åäºŒå¿«é€Ÿå‚è€ƒ)

---

## ä¸€ã€æ•´ä½“æ¶æ„ä¸é€»è¾‘è¯´æ˜

### 1.1 ä»€ä¹ˆæ˜¯è¿™ä¸ªé¡¹ç›®ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ª**å…·èº«æ™ºèƒ½ç ”ç©¶å¹³å°**ï¼ŒåŒ…å«ï¼š
- **å…·èº«è®ºæ–‡é¡µé¢**ï¼šå±•ç¤ºå’Œæœç´¢å…·èº«æ™ºèƒ½é¢†åŸŸçš„å­¦æœ¯è®ºæ–‡
- **å…·èº«è§†é¢‘é¡µé¢**ï¼šå±•ç¤ºBç«™ä¸Šå…·èº«æ™ºèƒ½ç›¸å…³çš„è§†é¢‘å†…å®¹
- **ç®¡ç†ç«¯**ï¼šç®¡ç†ç”¨æˆ·ã€è®ºæ–‡ã€è§†é¢‘æ•°æ®
- **ç™»å½•ç³»ç»Ÿ**ï¼šé£ä¹¦æ‰«ç ç™»å½•

### 1.2 æ•´ä½“æ¶æ„å›¾

```
ç”¨æˆ·æµè§ˆå™¨
    â†“
DNSè§£æï¼ˆåŸŸå â†’ æœåŠ¡å™¨IPï¼‰
    â†“
Nginxï¼ˆåå‘ä»£ç†ï¼Œ80/443ç«¯å£ï¼‰
    â†“
Gunicornï¼ˆWSGIæœåŠ¡å™¨ï¼Œ5001ç«¯å£ï¼‰
    â†“
Flaskåº”ç”¨ï¼ˆPython Webæ¡†æ¶ï¼‰
    â”œâ”€â”€ é¡µé¢è·¯ç”±ï¼ˆHTMLæ¨¡æ¿ï¼‰
    â”œâ”€â”€ APIè·¯ç”±ï¼ˆJSONæ•°æ®ï¼‰
    â””â”€â”€ å®šæ—¶ä»»åŠ¡ï¼ˆAPSchedulerï¼‰
    â†“
SQLiteæ•°æ®åº“ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
    â”œâ”€â”€ papers.dbï¼ˆè®ºæ–‡æ•°æ®ï¼‰
    â””â”€â”€ bilibili.dbï¼ˆè§†é¢‘æ•°æ®ï¼‰
```

### 1.3 æ•°æ®æµè½¬é€»è¾‘

**ç”¨æˆ·è®¿é—®æµç¨‹ï¼š**
1. ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥ `essay.gradmotion.com`
2. DNS å°†åŸŸåè§£æåˆ°æœåŠ¡å™¨ IP `101.200.222.139`
3. Nginx æ”¶åˆ°è¯·æ±‚ï¼Œæ ¹æ®åŸŸåï¼ˆHostï¼‰åˆ¤æ–­ï¼š
   - `essay.gradmotion.com` â†’ ä»£ç†åˆ° Flask çš„ `/` è·¯ç”±
   - `blibli.gradmotion.com` â†’ ä»£ç†åˆ° Flask çš„ `/bilibili` è·¯ç”±
   - `login.gradmotion.com` â†’ ä»£ç†åˆ° Flask çš„ `/login` è·¯ç”±
   - `admin123.gradmotion.com` â†’ ä»£ç†åˆ° Flask çš„ `/admin` è·¯ç”±
4. Flask åº”ç”¨å¤„ç†è¯·æ±‚ï¼Œä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œè¿”å› HTML æˆ– JSON
5. æµè§ˆå™¨æ˜¾ç¤ºé¡µé¢

**æ•°æ®æ›´æ–°æµç¨‹ï¼š**
1. APScheduler å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶/æ¯6å°æ—¶ï¼‰è‡ªåŠ¨æ‰§è¡Œ
2. è°ƒç”¨ Python è„šæœ¬æŠ“å– ArXiv/Bilibili API æ•°æ®
3. æ•°æ®ä¿å­˜åˆ° SQLite æ•°æ®åº“
4. ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶çœ‹åˆ°æœ€æ–°æ•°æ®

**ä»£ç æ›´æ–°æµç¨‹ï¼š**
1. æœ¬åœ°å¼€å‘ â†’ `git push origin main`
2. GitHub Actions è‡ªåŠ¨è§¦å‘
3. SSH ç™»å½•æœåŠ¡å™¨ â†’ æ‰§è¡Œéƒ¨ç½²è„šæœ¬
4. æ‹‰å–æœ€æ–°ä»£ç  â†’ é‡å¯æœåŠ¡
5. ç½‘ç«™è‡ªåŠ¨æ›´æ–°ï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰

### 1.4 å…³é”®æ¦‚å¿µè§£é‡Šï¼ˆå°ç™½å¿…è¯»ï¼‰

**Nginx**ï¼šWeb æœåŠ¡å™¨ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆ80ç«¯å£HTTPï¼Œ443ç«¯å£HTTPSï¼‰
- æ ¹æ®åŸŸåè½¬å‘åˆ°ä¸åŒçš„ Flask è·¯ç”±
- æä¾›é™æ€æ–‡ä»¶ï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰

**Gunicorn**ï¼šPython WSGI æœåŠ¡å™¨ï¼Œè´Ÿè´£ï¼š
- è¿è¡Œ Flask åº”ç”¨
- å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚
- ç®¡ç†è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

**systemd**ï¼šLinux æœåŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£ï¼š
- å¼€æœºè‡ªåŠ¨å¯åŠ¨æœåŠ¡
- æœåŠ¡å´©æºƒè‡ªåŠ¨é‡å¯
- ç»Ÿä¸€ç®¡ç†æœåŠ¡æ—¥å¿—

**SQLite**ï¼šè½»é‡çº§æ•°æ®åº“ï¼Œç‰¹ç‚¹ï¼š
- æ•°æ®å­˜å‚¨åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼ˆ`.db`ï¼‰
- æ— éœ€å•ç‹¬å®‰è£…æ•°æ®åº“æœåŠ¡å™¨
- é€‚åˆä¸­å°å‹é¡¹ç›®

---

## äºŒã€éƒ¨ç½²å‰å‡†å¤‡

### 2.1 æœåŠ¡å™¨ä¿¡æ¯ï¼ˆæœ¬é¡¹ç›®ï¼‰

**æœåŠ¡å™¨IP**: `101.200.222.139`  
**SSHç«¯å£**: `22`ï¼ˆé»˜è®¤ï¼‰  
**ç”¨æˆ·å**: `root`  
**å¯†ç **: `XLj4kUnh`  
**æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04.6 LTS

**âš ï¸ é‡è¦æç¤º**ï¼š
- è¿™äº›ä¿¡æ¯æ˜¯**æ•æ„Ÿä¿¡æ¯**ï¼Œä¸è¦æ³„éœ²
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ SSH å¯†é’¥ç™»å½•ï¼Œä¸ä½¿ç”¨å¯†ç 
- æœ¬æ•™ç¨‹ä¸ºæ¼”ç¤ºç›®çš„ï¼Œå®é™…éƒ¨ç½²æ—¶è¯·ä¿®æ”¹å¯†ç 

### 2.2 åŸŸåä¿¡æ¯ï¼ˆæœ¬é¡¹ç›®ï¼‰

| åŸŸå | ç”¨é€” | è§£æåˆ° |
|------|------|--------|
| `login.gradmotion.com` | ç™»å½•é¡µé¢ | `101.200.222.139` |
| `essay.gradmotion.com` | å…·èº«è®ºæ–‡é¡µé¢ | `101.200.222.139` |
| `blibli.gradmotion.com` | å…·èº«è§†é¢‘é¡µé¢ | `101.200.222.139` |
| `admin123.gradmotion.com` | ç®¡ç†ç«¯ | `101.200.222.139` |

**DNSé…ç½®è¦æ±‚**ï¼š
- åœ¨åŸŸåç®¡ç†å¹³å°ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰æ·»åŠ  A è®°å½•
- å°†ä»¥ä¸Š4ä¸ªåŸŸåéƒ½æŒ‡å‘ `101.200.222.139`
- ç­‰å¾…DNSç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰

### 2.3 GitHub ä»“åº“ä¿¡æ¯

**ä»“åº“åœ°å€**: `https://github.com/aramisjiang-wq/EmbodiedPulse2026`  
**é»˜è®¤åˆ†æ”¯**: `main`

### 2.4 æœ¬åœ°å‡†å¤‡

**éœ€è¦å‡†å¤‡çš„æ–‡ä»¶**ï¼š
1. æ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœæœ‰å†å²æ•°æ®ï¼‰ï¼š
   - `instance/papers.db` - è®ºæ–‡æ•°æ®åº“
   - `bilibili.db` - Bç«™è§†é¢‘æ•°æ®åº“

**éœ€è¦å‡†å¤‡çš„å·¥å…·**ï¼š
1. SSH å®¢æˆ·ç«¯ï¼ˆMac/Linux è‡ªå¸¦ï¼ŒWindows å¯ç”¨ PuTTY æˆ– WSLï¼‰
2. æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆç”¨äºç¼–è¾‘é…ç½®æ–‡ä»¶ï¼‰

---

## ä¸‰ã€æœåŠ¡å™¨åŸºç¡€ç¯å¢ƒé…ç½®

### 3.1 ç™»å½•æœåŠ¡å™¨

**åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š**

```bash
ssh root@101.200.222.139
```

**è¾“å…¥å¯†ç **ï¼š`XLj4kUnh`

**æˆåŠŸæ ‡å¿—**ï¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æç¤ºç¬¦ï¼š
```
root@iZ2zeb3oa5878sn6lgjey2Z:~#
```

### 3.2 æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€å·¥å…·

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å‡çº§ç³»ç»Ÿï¼ˆå¯é€‰ï¼Œä½†å»ºè®®ï¼‰
apt upgrade -y

# å®‰è£…å¿…è¦å·¥å…·
apt install -y git python3 python3-venv python3-pip nginx curl lsof

# éªŒè¯å®‰è£…
python3 --version  # åº”è¯¥æ˜¾ç¤º Python 3.x
git --version      # åº”è¯¥æ˜¾ç¤º git version
nginx -v           # åº”è¯¥æ˜¾ç¤º nginx version
```

**é¢„æœŸè¾“å‡º**ï¼š
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Git 2.x æˆ–æ›´é«˜ç‰ˆæœ¬
- Nginx 1.x æˆ–æ›´é«˜ç‰ˆæœ¬

**å¦‚æœå®‰è£…å¤±è´¥**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼š`ping 8.8.8.8`
- æ£€æŸ¥ apt æºï¼š`cat /etc/apt/sources.list`
- å°è¯•æ›´æ¢ apt æºï¼ˆé˜¿é‡Œäº‘é•œåƒç­‰ï¼‰

---

## å››ã€ä»£ç éƒ¨ç½²

### 4.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºç›®å½•
mkdir -p /srv
cd /srv

# å…‹éš†ä»£ç 
git clone https://github.com/aramisjiang-wq/EmbodiedPulse2026.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd EmbodiedPulse2026

# éªŒè¯ä»£ç å·²å…‹éš†
ls -la
# åº”è¯¥èƒ½çœ‹åˆ° app.py, requirements.txt ç­‰æ–‡ä»¶
```

### 4.2 åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ

**ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒï¼Ÿ**
- éš”ç¦»é¡¹ç›®ä¾èµ–ï¼Œé¿å…ä¸åŒé¡¹ç›®ä¹‹é—´çš„åŒ…å†²çª
- ä¿æŒç³»ç»Ÿ Python ç¯å¢ƒå¹²å‡€

**æ‰§è¡Œæ­¥éª¤ï¼š**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰
source venv/bin/activate

# çœ‹åˆ°æç¤ºç¬¦å‰é¢æœ‰ (venv) è¡¨ç¤ºæˆåŠŸ
# ä¾‹å¦‚ï¼š(venv) root@iZ2zeb3oa5878sn6lgjey2Z:/srv/EmbodiedPulse2026#

# å‡çº§ pip
pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…
```

**éªŒè¯å®‰è£…ï¼š**

```bash
# æ£€æŸ¥å…³é”®åŒ…æ˜¯å¦å®‰è£…
pip list | grep -i flask
pip list | grep -i gunicorn
pip list | grep -i sqlalchemy

# åº”è¯¥èƒ½çœ‹åˆ°è¿™äº›åŒ…
```

**å¸¸è§é—®é¢˜**ï¼š
- **é—®é¢˜1**: `pip install` å¾ˆæ…¢
  - **è§£å†³**: ä½¿ç”¨å›½å†…é•œåƒæº
  ```bash
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
  ```

- **é—®é¢˜2**: æŸäº›åŒ…å®‰è£…å¤±è´¥
  - **è§£å†³**: å®‰è£…ç¼–è¯‘å·¥å…·
  ```bash
  apt install -y build-essential python3-dev
  ```

### 4.3 åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶

**åˆ›å»º `.env` æ–‡ä»¶ï¼š**

```bash
cd /srv/EmbodiedPulse2026

# åˆ›å»º .env æ–‡ä»¶
cat > .env << 'EOF'
# Flask ç¯å¢ƒ
FLASK_ENV=production

# å®šæ—¶ä»»åŠ¡å¼€å…³ï¼ˆå¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½å¯ç”¨å®šæ—¶ä»»åŠ¡ï¼‰
AUTO_FETCH_ENABLED=true

# å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆCRON æ ¼å¼ï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨ï¼‰
# æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œè®ºæ–‡æŠ“å–
AUTO_FETCH_SCHEDULE=0 * * * *

# æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡Bç«™æ•°æ®æŠ“å–ï¼ˆé¿å…è§¦å‘é£æ§ï¼‰
AUTO_FETCH_BILIBILI_SCHEDULE=0 */6 * * *

# æ¯å°æ—¶æ‰§è¡Œæ–°é—»æŠ“å–
AUTO_FETCH_NEWS_SCHEDULE=0 * * * *

# æ¯å°æ—¶æ‰§è¡Œæ‹›è˜ä¿¡æ¯æŠ“å–
AUTO_FETCH_JOBS_SCHEDULE=0 * * * *

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå…¨é‡è®ºæ–‡æŠ“å–
AUTO_FETCH_FULL_SCHEDULE=0 2 * * *

# Semantic Scholar æ›´æ–°é™åˆ¶ï¼ˆæ¯å¤©æœ€å¤šæ›´æ–°å¤šå°‘ç¯‡ï¼‰
SEMANTIC_UPDATE_LIMIT=200

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info
EOF

# éªŒè¯æ–‡ä»¶åˆ›å»ºæˆåŠŸ
cat .env
```

**CRON æ ¼å¼è¯´æ˜**ï¼ˆ5ä¸ªå­—æ®µï¼‰ï¼š
```
åˆ† æ—¶ æ—¥ æœˆ å‘¨
* * * * *
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ æ˜ŸæœŸå‡  (0-7, 0å’Œ7éƒ½è¡¨ç¤ºå‘¨æ—¥)
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€ æœˆä»½ (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0-59)
```

**ç¤ºä¾‹**ï¼š
- `0 * * * *` = æ¯å°æ—¶æ•´ç‚¹ï¼ˆ0åˆ†ï¼‰
- `0 */6 * * *` = æ¯6å°æ—¶æ•´ç‚¹
- `0 2 * * *` = æ¯å¤©å‡Œæ™¨2ç‚¹
- `*/30 * * * *` = æ¯30åˆ†é’Ÿ

---

## äº”ã€æ•°æ®åº“è¿ç§»

### 5.1 æ–¹æ¡ˆé€‰æ‹©

**æ–¹æ¡ˆAï¼šä»æœ¬åœ°å¤åˆ¶æ•°æ®åº“ï¼ˆæœ‰å†å²æ•°æ®ï¼‰**
- é€‚åˆï¼šå·²æœ‰æ•°æ®ï¼Œéœ€è¦ä¿ç•™
- æ­¥éª¤ï¼šè§ä¸‹æ–¹

**æ–¹æ¡ˆBï¼šè®©æœåŠ¡å™¨è‡ªåŠ¨åˆ›å»ºï¼ˆæ–°éƒ¨ç½²ï¼‰**
- é€‚åˆï¼šå…¨æ–°éƒ¨ç½²ï¼Œæ— å†å²æ•°æ®
- æ­¥éª¤ï¼šè·³è¿‡æœ¬èŠ‚ï¼Œç›´æ¥åˆ°"æœåŠ¡é…ç½®"

### 5.2 ä»æœ¬åœ°å¤åˆ¶æ•°æ®åº“ï¼ˆæ–¹æ¡ˆAï¼‰

#### æ­¥éª¤1ï¼šåœ¨æœ¬åœ°å¤‡ä»½æ•°æ®åº“

**åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•æ‰§è¡Œï¼š**

```bash
cd "/Users/dong/Documents/Cursor/Embodied Pulse"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups

# å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
cp instance/papers.db backups/papers_backup_$(date +%Y%m%d).db
cp bilibili.db backups/bilibili_backup_$(date +%Y%m%d).db

# éªŒè¯å¤‡ä»½
ls -lh backups/
```

#### æ­¥éª¤2ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

**æ–¹æ³•1ï¼šä½¿ç”¨ scp å‘½ä»¤ï¼ˆæ¨èï¼‰**

**åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼ˆä¸æ˜¯æœåŠ¡å™¨ï¼‰ï¼š**

```bash
# ä¸Šä¼ è®ºæ–‡æ•°æ®åº“
scp instance/papers.db root@101.200.222.139:/srv/EmbodiedPulse2026/instance/

# ä¸Šä¼ Bç«™æ•°æ®åº“
scp bilibili.db root@101.200.222.139:/srv/EmbodiedPulse2026/

# è¾“å…¥å¯†ç ï¼šXLj4kUnh
```

**æ–¹æ³•2ï¼šä½¿ç”¨ SFTP å·¥å…·**

1. ä¸‹è½½ FileZillaï¼ˆMac/Windowsï¼‰æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ `sftp`
2. è¿æ¥åˆ°æœåŠ¡å™¨ï¼š
   - ä¸»æœºï¼š`sftp://101.200.222.139`
   - ç”¨æˆ·åï¼š`root`
   - å¯†ç ï¼š`XLj4kUnh`
3. ä¸Šä¼ æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•

#### æ­¥éª¤3ï¼šåœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®æƒé™

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
cd /srv/EmbodiedPulse2026

# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p instance

# è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆç¡®ä¿åº”ç”¨å¯ä»¥è¯»å†™ï¼‰
chmod 644 instance/papers.db
chmod 644 bilibili.db

# è®¾ç½®æ‰€æœ‰è€…
chown root:root instance/papers.db
chown root:root bilibili.db

# éªŒè¯æ–‡ä»¶
ls -lh instance/papers.db
ls -lh bilibili.db

# åº”è¯¥èƒ½çœ‹åˆ°æ–‡ä»¶å¤§å°ï¼ˆä¸æ˜¯0å­—èŠ‚ï¼‰
```

#### æ­¥éª¤4ï¼šéªŒè¯æ•°æ®åº“å†…å®¹

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
cd /srv/EmbodiedPulse2026
source venv/bin/activate

# æ£€æŸ¥è®ºæ–‡æ•°æ®åº“
python3 << EOF
import sqlite3
conn = sqlite3.connect('instance/papers.db')
cursor = conn.cursor()
cursor.execute("SELECT COUNT(*) FROM papers")
count = cursor.fetchone()[0]
print(f"è®ºæ–‡æ•°é‡: {count}")
conn.close()
EOF

# æ£€æŸ¥Bç«™æ•°æ®åº“
python3 << EOF
import sqlite3
conn = sqlite3.connect('bilibili.db')
cursor = conn.cursor()
cursor.execute("SELECT COUNT(*) FROM bilibili_up")
up_count = cursor.fetchone()[0]
cursor.execute("SELECT COUNT(*) FROM bilibili_video")
video_count = cursor.fetchone()[0]
print(f"UPä¸»æ•°é‡: {up_count}")
print(f"è§†é¢‘æ•°é‡: {video_count}")
conn.close()
EOF
```

**é¢„æœŸè¾“å‡º**ï¼š
- è®ºæ–‡æ•°é‡ > 0
- UPä¸»æ•°é‡ > 0
- è§†é¢‘æ•°é‡ > 0

**å¦‚æœæ•°é‡ä¸º0**ï¼š
- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ 
- æ£€æŸ¥æ–‡ä»¶æƒé™
- å¯èƒ½éœ€è¦é‡æ–°ä¸Šä¼ 

---

## å…­ã€æœåŠ¡é…ç½®

### 6.1 åˆ›å»º systemd æœåŠ¡

**systemd æ˜¯ä»€ä¹ˆï¼Ÿ**
- Linux ç³»ç»Ÿçš„æœåŠ¡ç®¡ç†å™¨
- å¯ä»¥è®©åº”ç”¨åœ¨åå°è¿è¡Œ
- å¼€æœºè‡ªåŠ¨å¯åŠ¨
- å´©æºƒè‡ªåŠ¨é‡å¯

**æ‰§è¡Œæ­¥éª¤ï¼š**

```bash
cd /srv/EmbodiedPulse2026

# ä½¿ç”¨è„šæœ¬åˆ›å»ºæœåŠ¡ï¼ˆæ¨èï¼‰
chmod +x scripts/create_systemd_service.sh
bash scripts/create_systemd_service.sh
```

**æˆ–è€…æ‰‹åŠ¨åˆ›å»ºï¼š**

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
cat > /etc/systemd/system/embodiedpulse.service << 'EOF'
[Unit]
Description=Embodied Pulse Flask Application (Gunicorn)
After=network.target

[Service]
User=root
Group=root
WorkingDirectory=/srv/EmbodiedPulse2026
Environment="PATH=/srv/EmbodiedPulse2026/venv/bin"
Environment="FLASK_ENV=production"
EnvironmentFile=/srv/EmbodiedPulse2026/.env
ExecStart=/srv/EmbodiedPulse2026/venv/bin/gunicorn -c /srv/EmbodiedPulse2026/gunicorn_config.py app:app
ExecReload=/bin/kill -s HUP $MAINPID
Restart=always
RestartSec=3
StandardOutput=journal
StandardError=journal
SyslogIdentifier=embodiedpulse

[Install]
WantedBy=multi-user.target
EOF

# é‡æ–°åŠ è½½ systemd
systemctl daemon-reload

# å¯ç”¨æœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
systemctl enable embodiedpulse
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š
- `EnvironmentFile=/srv/EmbodiedPulse2026/.env` - **éå¸¸é‡è¦**ï¼Œç”¨äºåŠ è½½ç¯å¢ƒå˜é‡
- `WorkingDirectory` - åº”ç”¨å·¥ä½œç›®å½•
- `ExecStart` - å¯åŠ¨å‘½ä»¤ï¼ˆä½¿ç”¨ Gunicornï¼‰
- `Restart=always` - å´©æºƒè‡ªåŠ¨é‡å¯

### 6.2 å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
systemctl start embodiedpulse

# æŸ¥çœ‹çŠ¶æ€
systemctl status embodiedpulse

# åº”è¯¥çœ‹åˆ° "active (running)"
```

**å¦‚æœå¯åŠ¨å¤±è´¥**ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u embodiedpulse -n 50

# å¸¸è§é—®é¢˜ï¼š
# 1. ç«¯å£è¢«å ç”¨ â†’ è§"å¸¸è§é—®é¢˜"ç« èŠ‚
# 2. ç¯å¢ƒå˜é‡æœªåŠ è½½ â†’ æ£€æŸ¥ EnvironmentFile é…ç½®
# 3. ä¾èµ–ç¼ºå¤± â†’ æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
```

### 6.3 éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
lsof -i:5001
# æˆ–
netstat -tuln | grep 5001

# æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://127.0.0.1:5001/
# åº”è¯¥è¿”å› HTML å†…å®¹ï¼ˆä¸æ˜¯é”™è¯¯ï¼‰

# æŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
journalctl -u embodiedpulse -f
# æŒ‰ Ctrl+C é€€å‡º
```

**é¢„æœŸç»“æœ**ï¼š
- ç«¯å£ 5001 æ­£åœ¨ç›‘å¬
- `curl` è¿”å› HTML å†…å®¹
- æ—¥å¿—ä¸­çœ‹åˆ° "GunicornæœåŠ¡å™¨å·²å°±ç»ª"
- å¦‚æœ `AUTO_FETCH_ENABLED=true`ï¼Œåº”è¯¥çœ‹åˆ° "å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨"

---

## ä¸ƒã€Nginx é…ç½®

### 7.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

**ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š**

```bash
cd /srv/EmbodiedPulse2026
chmod +x scripts/nginx_config_fix.sh
bash scripts/nginx_config_fix.sh
```

**æˆ–è€…æ‰‹åŠ¨åˆ›å»ºï¼š**

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/nginx/sites-available/embodiedpulse.conf << 'EOF'
# ç™»å½•é¡µ
server {
    listen 80;
    server_name login.gradmotion.com;

    location /static/ {
        proxy_pass http://127.0.0.1:5001/static/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        proxy_pass http://127.0.0.1:5001/login;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# å…·èº«è®ºæ–‡é¡µ
server {
    listen 80;
    server_name essay.gradmotion.com;

    location /static/ {
        proxy_pass http://127.0.0.1:5001/static/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        proxy_pass http://127.0.0.1:5001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# å…·èº«è§†é¢‘é¡µ
server {
    listen 80;
    server_name blibli.gradmotion.com;

    location /static/ {
        proxy_pass http://127.0.0.1:5001/static/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location = /login {
        proxy_pass http://127.0.0.1:5001/login;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        proxy_pass http://127.0.0.1:5001/bilibili;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# ç®¡ç†ç«¯
server {
    listen 80;
    server_name admin123.gradmotion.com;

    location /static/ {
        proxy_pass http://127.0.0.1:5001/static/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location = / {
        return 301 /admin/dashboard;
    }

    location /admin/ {
        proxy_pass http://127.0.0.1:5001/admin/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

# å¯ç”¨ç«™ç‚¹ï¼ˆåˆ›å»ºç¬¦å·é“¾æ¥ï¼‰
ln -s /etc/nginx/sites-available/embodiedpulse.conf /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®è¯­æ³•
nginx -t

# å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‡è½½ Nginx
systemctl reload nginx
```

### 7.2 é…ç½®è¯´æ˜

**å…³é”®ç‚¹**ï¼š
1. **`location /static/`** - é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰ç›´æ¥ä»£ç†
2. **`location /api/`** - API è¯·æ±‚ä»£ç†åˆ° Flask
3. **`location /`** - å…¶ä»–è¯·æ±‚æ ¹æ®åŸŸåä»£ç†åˆ°ä¸åŒè·¯ç”±
4. **`proxy_set_header`** - ä¼ é€’åŸå§‹è¯·æ±‚ä¿¡æ¯ç»™ Flask

**ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›é…ç½®ï¼Ÿ**
- Flask åº”ç”¨éœ€è¦çŸ¥é“åŸå§‹åŸŸåï¼ˆHostï¼‰
- é™æ€èµ„æºéœ€è¦æ­£ç¡®åŠ è½½
- API è¯·æ±‚éœ€è¦æ­£ç¡®è·¯ç”±

### 7.3 éªŒè¯ Nginx é…ç½®

```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
nginx -t

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tuln | grep -E "80|443"

# æµ‹è¯•æœ¬åœ°è®¿é—®ï¼ˆæ¨¡æ‹ŸåŸŸåï¼‰
curl -H "Host: essay.gradmotion.com" http://127.0.0.1/
# åº”è¯¥è¿”å› HTML å†…å®¹
```

---

## å…«ã€HTTPS è¯ä¹¦é…ç½®

### 8.1 å®‰è£… Certbot

**Certbot æ˜¯ä»€ä¹ˆï¼Ÿ**
- Let's Encrypt çš„å®˜æ–¹å®¢æˆ·ç«¯
- å…è´¹ SSL è¯ä¹¦
- è‡ªåŠ¨ç»­æœŸ

**å®‰è£…æ­¥éª¤ï¼š**

```bash
# å®‰è£… Certbot
apt update
apt install -y certbot python3-certbot-nginx

# éªŒè¯å®‰è£…
certbot --version
```

### 8.2 ç”³è¯· SSL è¯ä¹¦

**é‡è¦å‰æ**ï¼š
- DNS è§£æå¿…é¡»å·²ç”Ÿæ•ˆï¼ˆåŸŸåèƒ½è§£æåˆ°æœåŠ¡å™¨IPï¼‰
- 80ç«¯å£å¿…é¡»å¼€æ”¾ï¼ˆLet's Encrypt éœ€è¦éªŒè¯ï¼‰

**æ‰§è¡Œæ­¥éª¤ï¼š**

```bash
# ä½¿ç”¨è„šæœ¬è‡ªåŠ¨ç”³è¯·ï¼ˆæ¨èï¼‰
cd /srv/EmbodiedPulse2026
chmod +x scripts/setup_https.sh
bash scripts/setup_https.sh
```

**æˆ–è€…æ‰‹åŠ¨ç”³è¯·ï¼ˆæ¯ä¸ªåŸŸåï¼‰ï¼š**

```bash
# ä¸º login.gradmotion.com ç”³è¯·è¯ä¹¦
certbot --nginx -d login.gradmotion.com --non-interactive --agree-tos --email admin@gradmotion.com --redirect

# ä¸º essay.gradmotion.com ç”³è¯·è¯ä¹¦
certbot --nginx -d essay.gradmotion.com --non-interactive --agree-tos --email admin@gradmotion.com --redirect

# ä¸º blibli.gradmotion.com ç”³è¯·è¯ä¹¦
certbot --nginx -d blibli.gradmotion.com --non-interactive --agree-tos --email admin@gradmotion.com --redirect

# ä¸º admin123.gradmotion.com ç”³è¯·è¯ä¹¦
certbot --nginx -d admin123.gradmotion.com --non-interactive --agree-tos --email admin@gradmotion.com --redirect
```

**å‚æ•°è¯´æ˜**ï¼š
- `--nginx` - ä½¿ç”¨ Nginx æ’ä»¶è‡ªåŠ¨é…ç½®
- `-d` - åŸŸå
- `--non-interactive` - éäº¤äº’æ¨¡å¼
- `--agree-tos` - åŒæ„æœåŠ¡æ¡æ¬¾
- `--email` - é‚®ç®±ï¼ˆç”¨äºè¯ä¹¦åˆ°æœŸæé†’ï¼‰
- `--redirect` - è‡ªåŠ¨å°† HTTP é‡å®šå‘åˆ° HTTPS

### 8.3 è®¾ç½®è‡ªåŠ¨ç»­æœŸ

```bash
# å¯ç”¨è‡ªåŠ¨ç»­æœŸå®šæ—¶ä»»åŠ¡
systemctl enable certbot.timer
systemctl start certbot.timer

# éªŒè¯å®šæ—¶ä»»åŠ¡
systemctl status certbot.timer

# æŸ¥çœ‹è¯ä¹¦åˆ—è¡¨
certbot certificates
```

**è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼š90å¤©  
**è‡ªåŠ¨ç»­æœŸ**ï¼šCertbot ä¼šåœ¨åˆ°æœŸå‰è‡ªåŠ¨ç»­æœŸ

### 8.4 éªŒè¯ HTTPS

```bash
# æµ‹è¯• HTTPS è®¿é—®
curl -I https://essay.gradmotion.com
# åº”è¯¥è¿”å› 200 OK

# æµ‹è¯• HTTP è‡ªåŠ¨è·³è½¬
curl -I http://essay.gradmotion.com
# åº”è¯¥è¿”å› 301 è·³è½¬åˆ° HTTPS
```

---

## ä¹ã€GitHub Actions è‡ªåŠ¨éƒ¨ç½²

### 9.1 ç”Ÿæˆ SSH å¯†é’¥å¯¹

**ä¸ºä»€ä¹ˆéœ€è¦ SSH å¯†é’¥ï¼Ÿ**
- GitHub Actions éœ€è¦é€šè¿‡ SSH ç™»å½•æœåŠ¡å™¨
- å¯†é’¥æ¯”å¯†ç æ›´å®‰å…¨
- å¯ä»¥è®¾ç½®æƒé™æ§åˆ¶

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
# ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆä¸“é—¨ç”¨äº GitHub Actionsï¼‰
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions

# æŒ‰æç¤ºæ“ä½œï¼š
# - æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œç›´æ¥æŒ‰ Enterï¼ˆä¸è®¾å¯†ç ï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–ï¼‰
# - å†æ¬¡ç¡®è®¤å¯†ç æ—¶ï¼Œç›´æ¥æŒ‰ Enter

# å°†å…¬é’¥æ·»åŠ åˆ° authorized_keysï¼ˆå…è®¸è¿™ä¸ªå¯†é’¥ç™»å½•ï¼‰
cat ~/.ssh/github_actions.pub >> ~/.ssh/authorized_keys

# è®¾ç½®æ­£ç¡®çš„æƒé™ï¼ˆå®‰å…¨è¦æ±‚ï¼‰
chmod 600 ~/.ssh/github_actions
chmod 644 ~/.ssh/authorized_keys

# æŸ¥çœ‹ç§é’¥å†…å®¹ï¼ˆå¤åˆ¶è¿™ä¸ªï¼Œç¨åè¦ç”¨ï¼‰
cat ~/.ssh/github_actions
```

**é‡è¦**ï¼šå¤åˆ¶ä¸Šé¢å‘½ä»¤è¾“å‡ºçš„**å®Œæ•´ç§é’¥å†…å®¹**ï¼ˆä» `-----BEGIN OPENSSH PRIVATE KEY-----` å¼€å§‹ï¼Œåˆ° `-----END OPENSSH PRIVATE KEY-----` ç»“æŸï¼‰ï¼Œä¿å­˜åˆ°æ–‡æœ¬æ–‡ä»¶å¤‡ç”¨ã€‚

### 9.2 åœ¨ GitHub ä¸Šé…ç½® Secrets

**æ­¥éª¤1ï¼šæ‰“å¼€ GitHub ä»“åº“è®¾ç½®**

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š`https://github.com/aramisjiang-wq/EmbodiedPulse2026`
2. ç‚¹å‡»ä»“åº“é¡¶éƒ¨çš„ **`Settings`** æ ‡ç­¾
3. åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° **`Secrets and variables`** â†’ ç‚¹å‡» **`Actions`**

**æ­¥éª¤2ï¼šæ·»åŠ ç¬¬ä¸€ä¸ª Secretï¼šSERVER_HOST**

1. ç‚¹å‡»å³ä¸Šè§’çš„ **`New repository secret`** æŒ‰é’®
2. å¡«å†™ä¿¡æ¯ï¼š
   - **Nameï¼ˆåç§°ï¼‰**ï¼š`SERVER_HOST`
   - **Secretï¼ˆå€¼ï¼‰**ï¼š`101.200.222.139`
3. ç‚¹å‡» **`Add secret`**

**æ­¥éª¤3ï¼šæ·»åŠ ç¬¬äºŒä¸ª Secretï¼šSERVER_USER**

1. å†æ¬¡ç‚¹å‡» **`New repository secret`**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **Nameï¼ˆåç§°ï¼‰**ï¼š`SERVER_USER`
   - **Secretï¼ˆå€¼ï¼‰**ï¼š`root`
3. ç‚¹å‡» **`Add secret`**

**æ­¥éª¤4ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ª Secretï¼šSERVER_SSH_PORT**

1. å†æ¬¡ç‚¹å‡» **`New repository secret`**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **Nameï¼ˆåç§°ï¼‰**ï¼š`SERVER_SSH_PORT`
   - **Secretï¼ˆå€¼ï¼‰**ï¼š`22`
3. ç‚¹å‡» **`Add secret`**

**æ­¥éª¤5ï¼šæ·»åŠ ç¬¬å››ä¸ª Secretï¼šSERVER_SSH_KEYï¼ˆæœ€é‡è¦ï¼‰**

1. å†æ¬¡ç‚¹å‡» **`New repository secret`**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **Nameï¼ˆåç§°ï¼‰**ï¼š`SERVER_SSH_KEY`
   - **Secretï¼ˆå€¼ï¼‰**ï¼šç²˜è´´ä¹‹å‰å¤åˆ¶çš„**å®Œæ•´ç§é’¥å†…å®¹**ï¼ˆåŒ…æ‹¬ `-----BEGIN` å’Œ `-----END` è¿™ä¸¤è¡Œï¼‰
3. ç‚¹å‡» **`Add secret`**

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- ç§é’¥å†…å®¹å¾ˆé•¿ï¼Œç¡®ä¿å®Œæ•´å¤åˆ¶ï¼ˆåŒ…æ‹¬å¼€å¤´å’Œç»“å°¾çš„æ ‡è®°è¡Œï¼‰
- ä¸è¦æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œ
- è¿™æ˜¯æœ€æ•æ„Ÿçš„ä¿¡æ¯ï¼Œä¸è¦æ³„éœ²ç»™ä»»ä½•äºº

**éªŒè¯é…ç½®**ï¼š
åœ¨ `Secrets and variables` â†’ `Actions` é¡µé¢ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ° 4 ä¸ª secretsï¼š
- âœ… `SERVER_HOST`
- âœ… `SERVER_USER`
- âœ… `SERVER_SSH_PORT`
- âœ… `SERVER_SSH_KEY`

### 9.3 æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²

**æ­¥éª¤1ï¼šåœ¨æœ¬åœ°åšä¸€ä¸ªå°çš„ä¿®æ”¹**

```bash
cd "/Users/dong/Documents/Cursor/Embodied Pulse"

# åšä¸€ä¸ªå°çš„ä¿®æ”¹ï¼ˆæ¯”å¦‚æ·»åŠ æ³¨é‡Šï¼‰
echo "# æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²" >> README.md

# æäº¤å¹¶æ¨é€
git add README.md
git commit -m "test: æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²"
git push origin main
```

**æ­¥éª¤2ï¼šåœ¨ GitHub ä¸ŠæŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**

1. å›åˆ° GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡»é¡¶éƒ¨çš„ **`Actions`** æ ‡ç­¾
3. ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªæ–°çš„å·¥ä½œæµè¿è¡Œï¼ˆæ˜¾ç¤ºé»„è‰²æˆ–ç»¿è‰²çš„åœ†ç‚¹ï¼‰
4. ç‚¹å‡»è¿™ä¸ªå·¥ä½œæµï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—

**æ­¥éª¤3ï¼šæŸ¥çœ‹éƒ¨ç½²æ—¥å¿—**

åœ¨ `Actions` é¡µé¢ï¼š
1. ç‚¹å‡»æœ€æ–°çš„å·¥ä½œæµè¿è¡Œ
2. ç‚¹å‡» **`deploy`** ä»»åŠ¡
3. å±•å¼€ **`SSH Deploy to Production`** æ­¥éª¤
4. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

**æˆåŠŸæ ‡å¿—**ï¼š
- çœ‹åˆ° `[CI] å¼€å§‹éƒ¨ç½² EmbodiedPulse2026 ...`
- çœ‹åˆ° `[deploy] æ‹‰å–æœ€æ–°ä»£ç ...`
- çœ‹åˆ° `[deploy] éƒ¨ç½²å®Œæˆã€‚`
- çœ‹åˆ° `[CI] éƒ¨ç½²è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚`
- å·¥ä½œæµæ˜¾ç¤ºç»¿è‰² âœ“

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- å¸¸è§é—®é¢˜ï¼š
  - SSH è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ `SERVER_HOST`ã€`SERVER_USER`ã€`SERVER_SSH_KEY`
  - æƒé™é”™è¯¯ â†’ æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æƒé™
  - è„šæœ¬è·¯å¾„é”™è¯¯ â†’ æ£€æŸ¥ `scripts/deploy_server.sh` æ˜¯å¦å­˜åœ¨

### 9.4 GitHub Actions å·¥ä½œæµæ–‡ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`.github/workflows/deploy.yml`

**å®Œæ•´å†…å®¹**ï¼š

```yaml
name: Deploy to Server

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout (for completeness, thoughä¸ä¾èµ–æœ¬åœ°ä»£ç )
        uses: actions/checkout@v4

      - name: SSH Deploy to Production
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: ${{ secrets.SERVER_SSH_PORT }}
          script: |
            echo "[CI] å¼€å§‹éƒ¨ç½² EmbodiedPulse2026 ..."
            cd /srv/EmbodiedPulse2026
            chmod +x scripts/deploy_server.sh
            bash scripts/deploy_server.sh
            echo "[CI] éƒ¨ç½²è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚"
```

**è¯´æ˜**ï¼š
- ç›‘å¬ `main` åˆ†æ”¯çš„ `push` äº‹ä»¶
- ä½¿ç”¨ SSH ç™»å½•æœåŠ¡å™¨
- æ‰§è¡Œéƒ¨ç½²è„šæœ¬

---

## åã€ä¸Šçº¿å‰æ£€æŸ¥

### 10.1 ä½¿ç”¨æ£€æŸ¥è„šæœ¬

**æ‰§è¡Œå…¨é¢æ£€æŸ¥ï¼š**

```bash
cd /srv/EmbodiedPulse2026
chmod +x scripts/check_deployment_status.sh
bash scripts/check_deployment_status.sh
```

**è„šæœ¬ä¼šæ£€æŸ¥**ï¼š
1. æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æœåŠ¡æ˜¯å¦è¿è¡Œ
3. ç«¯å£æ˜¯å¦ç›‘å¬
4. ç¯å¢ƒå˜é‡é…ç½®
5. å®šæ—¶ä»»åŠ¡çŠ¶æ€
6. Nginx é…ç½®
7. HTTPS è¯ä¹¦
8. DNS è§£æ
9. ä»£ç å’Œä¾èµ–
10. åŠŸèƒ½å¯ç”¨æ€§
11. é”™è¯¯æ—¥å¿—

### 10.2 æ‰‹åŠ¨æ£€æŸ¥æ¸…å•

**âœ… æ•°æ®åº“æ£€æŸ¥**
- [ ] `instance/papers.db` å­˜åœ¨ä¸”æœ‰æ•°æ®
- [ ] `bilibili.db` å­˜åœ¨ä¸”æœ‰æ•°æ®
- [ ] æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆ644ï¼‰

**âœ… æœåŠ¡æ£€æŸ¥**
- [ ] `embodiedpulse` æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] `nginx` æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] æœåŠ¡å·²è®¾ç½®ä¸ºå¼€æœºè‡ªå¯

**âœ… ç«¯å£æ£€æŸ¥**
- [ ] 5001 ç«¯å£æ­£åœ¨ç›‘å¬
- [ ] 80 ç«¯å£æ­£åœ¨ç›‘å¬
- [ ] 443 ç«¯å£æ­£åœ¨ç›‘å¬ï¼ˆå¦‚æœé…ç½®äº†HTTPSï¼‰

**âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥**
- [ ] `.env` æ–‡ä»¶å­˜åœ¨
- [ ] `AUTO_FETCH_ENABLED=true`
- [ ] systemd æœåŠ¡é…ç½®åŒ…å« `EnvironmentFile`

**âœ… å®šæ—¶ä»»åŠ¡æ£€æŸ¥**
- [ ] æ—¥å¿—ä¸­çœ‹åˆ°"å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨"
- [ ] å®šæ—¶ä»»åŠ¡é…ç½®æ­£ç¡®

**âœ… Nginx æ£€æŸ¥**
- [ ] é…ç½®è¯­æ³•æ­£ç¡®
- [ ] æ‰€æœ‰åŸŸåé…ç½®å­˜åœ¨

**âœ… HTTPS æ£€æŸ¥**
- [ ] æ‰€æœ‰åŸŸåéƒ½æœ‰ SSL è¯ä¹¦
- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
- [ ] è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²å¯ç”¨

**âœ… DNS æ£€æŸ¥**
- [ ] æ‰€æœ‰åŸŸåéƒ½è§£æåˆ° `101.200.222.139`

**âœ… åŠŸèƒ½æµ‹è¯•**
- [ ] `http://essay.gradmotion.com` å¯ä»¥è®¿é—®
- [ ] `http://blibli.gradmotion.com` å¯ä»¥è®¿é—®
- [ ] `http://login.gradmotion.com` å¯ä»¥è®¿é—®
- [ ] `http://admin123.gradmotion.com` å¯ä»¥è®¿é—®
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æ­£å¸¸æ˜¾ç¤º

---

## åä¸€ã€å¸¸è§é—®é¢˜ä¸Debug

### 11.1 ç«¯å£è¢«å ç”¨

**é—®é¢˜ç°è±¡**ï¼š
```
ERROR: Connection in use: ('0.0.0.0', 5001)
ERROR: connection to ('0.0.0.0', 5001) failed: [Errno 98] Address already in use
```

**åŸå› **ï¼š
- ä¹‹å‰çš„è¿›ç¨‹æ²¡æœ‰æ­£ç¡®å…³é—­
- å¤šä¸ª Gunicorn å®ä¾‹åŒæ—¶è¿è¡Œ

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬
cd /srv/EmbodiedPulse2026
chmod +x scripts/fix_port_and_service.sh
bash scripts/fix_port_and_service.sh

# æ–¹æ³•2ï¼šæ‰‹åŠ¨ä¿®å¤
# 1. åœæ­¢æœåŠ¡
systemctl stop embodiedpulse

# 2. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -ti:5001
# æˆ–
netstat -tuln | grep 5001

# 3. æ€æ­»è¿›ç¨‹
lsof -ti:5001 | xargs kill -9
# æˆ–
fuser -k 5001/tcp

# 4. ç­‰å¾…å‡ ç§’
sleep 3

# 5. é‡æ–°å¯åŠ¨æœåŠ¡
systemctl start embodiedpulse
```

### 11.2 ç¯å¢ƒå˜é‡æœªåŠ è½½

**é—®é¢˜ç°è±¡**ï¼š
- å®šæ—¶ä»»åŠ¡æœªå¯åŠ¨
- æ—¥å¿—ä¸­æ˜¾ç¤º "å®šæ—¶ä»»åŠ¡æœªå¯ç”¨ï¼ˆAUTO_FETCH_ENABLED=falseï¼‰"
- ä½† `.env` æ–‡ä»¶ä¸­ `AUTO_FETCH_ENABLED=true`

**åŸå› **ï¼š
- systemd æœåŠ¡é…ç½®ç¼ºå°‘ `EnvironmentFile`

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥æœåŠ¡é…ç½®
cat /etc/systemd/system/embodiedpulse.service | grep EnvironmentFile

# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜ç¼ºå°‘é…ç½®ï¼Œéœ€è¦æ·»åŠ 
nano /etc/systemd/system/embodiedpulse.service
```

åœ¨ `[Service]` éƒ¨åˆ†ï¼Œæ‰¾åˆ°ï¼š
```ini
Environment="PATH=/srv/EmbodiedPulse2026/venv/bin"
Environment="FLASK_ENV=production"
```

åœ¨è¿™ä¸¤è¡Œ**åé¢**æ·»åŠ ï¼š
```ini
EnvironmentFile=/srv/EmbodiedPulse2026/.env
```

ä¿å­˜åï¼š
```bash
# é‡æ–°åŠ è½½ systemd
systemctl daemon-reload

# é‡å¯æœåŠ¡
systemctl restart embodiedpulse

# éªŒè¯
journalctl -u embodiedpulse -n 50 | grep -i "å®šæ—¶ä»»åŠ¡\|AUTO_FETCH"
```

### 11.3 Nginx é™æ€èµ„æº404

**é—®é¢˜ç°è±¡**ï¼š
- é¡µé¢å¯ä»¥è®¿é—®ï¼Œä½†æ²¡æœ‰æ ·å¼ï¼ˆCSS/JS åŠ è½½å¤±è´¥ï¼‰
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º 404 é”™è¯¯

**åŸå› **ï¼š
- Nginx é…ç½®ç¼ºå°‘ `/static/` è·¯ç”±
- `proxy_pass` è·¯å¾„ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥ Nginx é…ç½®
grep -A 5 "location /static/" /etc/nginx/sites-available/embodiedpulse.conf

# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œéœ€è¦æ·»åŠ é…ç½®
# ä½¿ç”¨ä¿®å¤è„šæœ¬
cd /srv/EmbodiedPulse2026
bash scripts/nginx_config_fix.sh

# æˆ–æ‰‹åŠ¨æ·»åŠ ï¼ˆåœ¨æ¯ä¸ª server å—ä¸­æ·»åŠ ï¼‰
location /static/ {
    proxy_pass http://127.0.0.1:5001/static/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

### 11.4 åŸŸå404æˆ–è·³è½¬é”™è¯¯

**é—®é¢˜ç°è±¡**ï¼š
- `blibli.gradmotion.com/login` è¿”å› 404
- åŸŸåè®¿é—®åè·³è½¬åˆ°é”™è¯¯çš„é¡µé¢

**åŸå› **ï¼š
- Nginx `location` åŒ¹é…é¡ºåºé—®é¢˜
- `proxy_pass` è·¯å¾„é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥é…ç½®
grep -A 10 "server_name blibli" /etc/nginx/sites-available/embodiedpulse.conf

# ç¡®ä¿ `/login` ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼Œä¸”ä¼˜å…ˆçº§é«˜äº `location /`
# æ­£ç¡®é…ç½®ï¼š
location = /login {
    proxy_pass http://127.0.0.1:5001/login;
    ...
}

location / {
    proxy_pass http://127.0.0.1:5001/bilibili;
    ...
}
```

### 11.5 å®šæ—¶ä»»åŠ¡æœªå¯åŠ¨

**é—®é¢˜ç°è±¡**ï¼š
- æ—¥å¿—ä¸­æ˜¾ç¤º "å®šæ—¶ä»»åŠ¡æœªå¯ç”¨"
- æ•°æ®æ²¡æœ‰è‡ªåŠ¨æ›´æ–°

**æ£€æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥ .env æ–‡ä»¶
cat /srv/EmbodiedPulse2026/.env | grep AUTO_FETCH_ENABLED
# åº”è¯¥æ˜¾ç¤ºï¼šAUTO_FETCH_ENABLED=true

# 2. æ£€æŸ¥ systemd æœåŠ¡é…ç½®
cat /etc/systemd/system/embodiedpulse.service | grep EnvironmentFile
# åº”è¯¥æ˜¾ç¤ºï¼šEnvironmentFile=/srv/EmbodiedPulse2026/.env

# 3. æ£€æŸ¥æ—¥å¿—
journalctl -u embodiedpulse -n 100 | grep -i "å®šæ—¶ä»»åŠ¡\|scheduler"
# åº”è¯¥çœ‹åˆ°å¯åŠ¨ä¿¡æ¯

# 4. ä½¿ç”¨æ£€æŸ¥å’Œä¿®å¤è„šæœ¬
cd /srv/EmbodiedPulse2026
bash scripts/check_and_fix_scheduler.sh
```

### 11.6 æ•°æ®åº“æƒé™é”™è¯¯

**é—®é¢˜ç°è±¡**ï¼š
```
Permission denied
database is locked
```

**è§£å†³æ–¹æ³•**ï¼š

```bash
cd /srv/EmbodiedPulse2026

# è®¾ç½®æ­£ç¡®çš„æƒé™
chmod 644 instance/papers.db
chmod 644 bilibili.db
chown root:root instance/papers.db
chown root:root bilibili.db

# å¦‚æœæ–‡ä»¶è¢«é”å®šï¼Œé‡å¯æœåŠ¡
systemctl restart embodiedpulse
```

### 11.7 GitHub Actions éƒ¨ç½²å¤±è´¥

**å¸¸è§é”™è¯¯1ï¼šSSH è¿æ¥å¤±è´¥**

**é”™è¯¯ä¿¡æ¯**ï¼š
```
dial tcp 101.200.222.139:22: connect: connection refused
```

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥æœåŠ¡å™¨ SSH æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`systemctl status ssh`
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 22 ç«¯å£
- æ£€æŸ¥ `SERVER_HOST` æ˜¯å¦æ­£ç¡®

**å¸¸è§é”™è¯¯2ï¼šæƒé™è¢«æ‹’ç»**

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Permission denied (publickey)
```

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ `SERVER_SSH_KEY` æ˜¯å¦æ­£ç¡®ï¼ˆå®Œæ•´ç§é’¥å†…å®¹ï¼‰
- æ£€æŸ¥æœåŠ¡å™¨ä¸Š `~/.ssh/authorized_keys` æ˜¯å¦åŒ…å«å…¬é’¥
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`chmod 600 ~/.ssh/github_actions`

**å¸¸è§é”™è¯¯3ï¼šè„šæœ¬è·¯å¾„ä¸å­˜åœ¨**

**é”™è¯¯ä¿¡æ¯**ï¼š
```
bash: scripts/deploy_server.sh: No such file or directory
```

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ä»£ç æ˜¯å¦å·²æ‹‰å–åˆ°æœåŠ¡å™¨
- æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š`ls -la /srv/EmbodiedPulse2026/scripts/deploy_server.sh`
- ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š`chmod +x scripts/deploy_server.sh`

---

## åäºŒã€å¿«é€Ÿå‚è€ƒ

### 12.1 æ‰€æœ‰è„šæœ¬æ¸…å•

| è„šæœ¬æ–‡ä»¶ | ç”¨é€” | æ‰§è¡Œä½ç½® |
|---------|------|---------|
| `scripts/create_systemd_service.sh` | åˆ›å»º systemd æœåŠ¡ | æœåŠ¡å™¨ |
| `scripts/nginx_config_fix.sh` | é…ç½® Nginx | æœåŠ¡å™¨ |
| `scripts/setup_https.sh` | é…ç½® HTTPS è¯ä¹¦ | æœåŠ¡å™¨ |
| `scripts/deploy_server.sh` | è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ | æœåŠ¡å™¨ï¼ˆGitHub Actionsè°ƒç”¨ï¼‰ |
| `scripts/fix_port_and_service.sh` | ä¿®å¤ç«¯å£å ç”¨å’ŒæœåŠ¡é…ç½® | æœåŠ¡å™¨ |
| `scripts/check_and_fix_scheduler.sh` | æ£€æŸ¥å’Œä¿®å¤å®šæ—¶ä»»åŠ¡ | æœåŠ¡å™¨ |
| `scripts/check_deployment_status.sh` | å…¨é¢æ£€æŸ¥éƒ¨ç½²çŠ¶æ€ | æœåŠ¡å™¨ |
| `scripts/verify_deployment.sh` | éªŒè¯éƒ¨ç½² | æœåŠ¡å™¨ |

### 12.2 å…³é”®è·¯å¾„å’Œæ–‡ä»¶

| è·¯å¾„/æ–‡ä»¶ | è¯´æ˜ |
|----------|------|
| `/srv/EmbodiedPulse2026` | é¡¹ç›®æ ¹ç›®å½• |
| `/srv/EmbodiedPulse2026/venv` | Python è™šæ‹Ÿç¯å¢ƒ |
| `/srv/EmbodiedPulse2026/.env` | ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ |
| `/srv/EmbodiedPulse2026/instance/papers.db` | è®ºæ–‡æ•°æ®åº“ |
| `/srv/EmbodiedPulse2026/bilibili.db` | Bç«™è§†é¢‘æ•°æ®åº“ |
| `/etc/systemd/system/embodiedpulse.service` | systemd æœåŠ¡é…ç½® |
| `/etc/nginx/sites-available/embodiedpulse.conf` | Nginx ç«™ç‚¹é…ç½® |

### 12.3 å¸¸ç”¨å‘½ä»¤

**æœåŠ¡ç®¡ç†**ï¼š
```bash
# å¯åŠ¨æœåŠ¡
systemctl start embodiedpulse

# åœæ­¢æœåŠ¡
systemctl stop embodiedpulse

# é‡å¯æœåŠ¡
systemctl restart embodiedpulse

# æŸ¥çœ‹çŠ¶æ€
systemctl status embodiedpulse

# æŸ¥çœ‹æ—¥å¿—
journalctl -u embodiedpulse -f
```

**Nginx ç®¡ç†**ï¼š
```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
systemctl reload nginx

# é‡å¯ Nginx
systemctl restart nginx

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

**æ•°æ®åº“æ“ä½œ**ï¼š
```bash
# å¤‡ä»½æ•°æ®åº“
cp instance/papers.db backups/papers_$(date +%Y%m%d).db

# æ£€æŸ¥æ•°æ®åº“å†…å®¹
sqlite3 instance/papers.db "SELECT COUNT(*) FROM papers;"
```

### 12.4 å®Œæ•´éƒ¨ç½²å‘½ä»¤åºåˆ—ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

**é¦–æ¬¡éƒ¨ç½²ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰ï¼š**

```bash
# ===== 1. ç™»å½•æœåŠ¡å™¨ =====
ssh root@101.200.222.139
# è¾“å…¥å¯†ç ï¼šXLj4kUnh

# ===== 2. æ›´æ–°ç³»ç»Ÿ =====
apt update && apt upgrade -y
apt install -y git python3 python3-venv python3-pip nginx curl lsof certbot python3-certbot-nginx

# ===== 3. å…‹éš†ä»£ç  =====
mkdir -p /srv
cd /srv
git clone https://github.com/aramisjiang-wq/EmbodiedPulse2026.git
cd EmbodiedPulse2026

# ===== 4. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ =====
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# ===== 5. åˆ›å»º .env æ–‡ä»¶ =====
cat > .env << 'EOF'
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 * * * *
AUTO_FETCH_BILIBILI_SCHEDULE=0 */6 * * *
AUTO_FETCH_NEWS_SCHEDULE=0 * * * *
AUTO_FETCH_JOBS_SCHEDULE=0 * * * *
AUTO_FETCH_FULL_SCHEDULE=0 2 * * *
SEMANTIC_UPDATE_LIMIT=200
LOG_LEVEL=info
EOF

# ===== 6. åˆ›å»º systemd æœåŠ¡ =====
chmod +x scripts/create_systemd_service.sh
bash scripts/create_systemd_service.sh
systemctl start embodiedpulse

# ===== 7. é…ç½® Nginx =====
chmod +x scripts/nginx_config_fix.sh
bash scripts/nginx_config_fix.sh

# ===== 8. é…ç½® HTTPSï¼ˆéœ€è¦DNSå·²ç”Ÿæ•ˆï¼‰=====
chmod +x scripts/setup_https.sh
bash scripts/setup_https.sh

# ===== 9. éªŒè¯éƒ¨ç½² =====
chmod +x scripts/check_deployment_status.sh
bash scripts/check_deployment_status.sh
```

### 12.5 æ•°æ®åº“è¿ç§»å‘½ä»¤ï¼ˆå¦‚æœæœ‰å†å²æ•°æ®ï¼‰

**åœ¨æœ¬åœ°æ‰§è¡Œï¼š**

```bash
cd "/Users/dong/Documents/Cursor/Embodied Pulse"

# å¤‡ä»½æ•°æ®åº“
mkdir -p backups
cp instance/papers.db backups/papers_backup_$(date +%Y%m%d).db
cp bilibili.db backups/bilibili_backup_$(date +%Y%m%d).db

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp instance/papers.db root@101.200.222.139:/srv/EmbodiedPulse2026/instance/
scp bilibili.db root@101.200.222.139:/srv/EmbodiedPulse2026/
# è¾“å…¥å¯†ç ï¼šXLj4kUnh
```

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
cd /srv/EmbodiedPulse2026
mkdir -p instance
chmod 644 instance/papers.db bilibili.db
chown root:root instance/papers.db bilibili.db
systemctl restart embodiedpulse
```

### 12.6 GitHub Actions é…ç½®å‘½ä»¤

**åœ¨æœåŠ¡å™¨ä¸Šç”ŸæˆSSHå¯†é’¥ï¼š**

```bash
ssh-keygen -t rsa -b 4096 -C "github-actions" -f ~/.ssh/github_actions
# ç›´æ¥æŒ‰ Enterï¼ˆä¸è®¾å¯†ç ï¼‰
cat ~/.ssh/github_actions.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/github_actions
chmod 644 ~/.ssh/authorized_keys

# æŸ¥çœ‹ç§é’¥ï¼ˆå¤åˆ¶å…¨éƒ¨å†…å®¹ï¼‰
cat ~/.ssh/github_actions
```

**åœ¨ GitHub ä¸Šæ·»åŠ  Secrets**ï¼š
1. `Settings` â†’ `Secrets and variables` â†’ `Actions`
2. æ·»åŠ ï¼š
   - `SERVER_HOST` = `101.200.222.139`
   - `SERVER_USER` = `root`
   - `SERVER_SSH_PORT` = `22`
   - `SERVER_SSH_KEY` = ï¼ˆç²˜è´´ç§é’¥å†…å®¹ï¼‰

---

## åä¸‰ã€éƒ¨ç½²å®Œæˆæ ‡å¿—

å½“ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œç½‘ç«™å¯ä»¥æ­£å¼ä¸Šçº¿ï¼š

- [x] æ‰€æœ‰åŸŸåå¯ä»¥æ­£å¸¸è®¿é—®ï¼ˆHTTP/HTTPSï¼‰
- [x] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [x] HTTPS è¯ä¹¦å·²é…ç½®
- [x] æ•°æ®åº“æ•°æ®å®Œæ•´
- [x] å®šæ—¶ä»»åŠ¡æ­£å¸¸è¿è¡Œ
- [x] è‡ªåŠ¨éƒ¨ç½²é…ç½®å®Œæˆ
- [x] æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯
- [x] æ— ä¸¥é‡é”™è¯¯æ—¥å¿—

---

## åå››ã€åç»­ç»´æŠ¤

### 14.1 æ—¥å¸¸æ›´æ–°ä»£ç 

**æ–¹æ³•1ï¼šä½¿ç”¨ GitHub Actionsï¼ˆæ¨èï¼‰**
- æœ¬åœ°ä¿®æ”¹ä»£ç 
- `git push origin main`
- GitHub Actions è‡ªåŠ¨éƒ¨ç½²

**æ–¹æ³•2ï¼šæ‰‹åŠ¨éƒ¨ç½²**
```bash
ssh root@101.200.222.139
cd /srv/EmbodiedPulse2026
git pull origin main
systemctl restart embodiedpulse
```

### 14.2 æŸ¥çœ‹æ—¥å¿—

```bash
# åº”ç”¨æ—¥å¿—
journalctl -u embodiedpulse -f

# Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

### 14.3 å¤‡ä»½æ•°æ®åº“

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /srv/EmbodiedPulse2026/scripts/backup_db.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/srv/backups/embodiedpulse"
mkdir -p "$BACKUP_DIR"
DATE=$(date +%Y%m%d_%H%M%S)
cp /srv/EmbodiedPulse2026/instance/papers.db "$BACKUP_DIR/papers_$DATE.db"
cp /srv/EmbodiedPulse2026/bilibili.db "$BACKUP_DIR/bilibili_$DATE.db"
gzip "$BACKUP_DIR/papers_$DATE.db"
gzip "$BACKUP_DIR/bilibili_$DATE.db"
find "$BACKUP_DIR" -name "*.db.gz" -mtime +7 -delete
echo "å¤‡ä»½å®Œæˆ: $DATE"
EOF

chmod +x /srv/EmbodiedPulse2026/scripts/backup_db.sh

# è®¾ç½®å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
(crontab -l 2>/dev/null; echo "0 2 * * * /srv/EmbodiedPulse2026/scripts/backup_db.sh") | crontab -
```

---

## åäº”ã€æ€»ç»“

### 15.1 éƒ¨ç½²æµç¨‹æ€»ç»“

1. **å‡†å¤‡é˜¶æ®µ**ï¼šæœåŠ¡å™¨ä¿¡æ¯ã€åŸŸåã€GitHub ä»“åº“
2. **ç¯å¢ƒé…ç½®**ï¼šç³»ç»Ÿæ›´æ–°ã€å·¥å…·å®‰è£…
3. **ä»£ç éƒ¨ç½²**ï¼šå…‹éš†ä»£ç ã€è™šæ‹Ÿç¯å¢ƒã€ä¾èµ–å®‰è£…
4. **æ•°æ®åº“è¿ç§»**ï¼šä¸Šä¼ æ•°æ®åº“æ–‡ä»¶
5. **æœåŠ¡é…ç½®**ï¼šsystemd æœåŠ¡ã€ç¯å¢ƒå˜é‡
6. **Nginx é…ç½®**ï¼šåå‘ä»£ç†ã€å¤šåŸŸåè·¯ç”±
7. **HTTPS é…ç½®**ï¼šSSL è¯ä¹¦ã€è‡ªåŠ¨ç»­æœŸ
8. **è‡ªåŠ¨éƒ¨ç½²**ï¼šGitHub Actionsã€SSH å¯†é’¥
9. **éªŒè¯æµ‹è¯•**ï¼šåŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æ£€æŸ¥

### 15.2 å…³é”®æˆåŠŸå› ç´ 

1. **ç¯å¢ƒå˜é‡æ­£ç¡®åŠ è½½**ï¼šç¡®ä¿ systemd æœåŠ¡é…ç½®åŒ…å« `EnvironmentFile`
2. **ç«¯å£ä¸è¢«å ç”¨**ï¼šç¡®ä¿ 5001 ç«¯å£å¯ç”¨
3. **Nginx é…ç½®æ­£ç¡®**ï¼šé™æ€èµ„æºå’Œ API è·¯ç”±æ­£ç¡®ä»£ç†
4. **æ•°æ®åº“æƒé™æ­£ç¡®**ï¼šæ–‡ä»¶å¯è¯»å†™
5. **DNS è§£æç”Ÿæ•ˆ**ï¼šåŸŸåæ­£ç¡®è§£æåˆ°æœåŠ¡å™¨IP
6. **HTTPS è¯ä¹¦æœ‰æ•ˆ**ï¼šè¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²å¯ç”¨

### 15.3 ä¸‹æ¬¡éƒ¨ç½²æ–°é¡¹ç›®æ—¶

1. **ä¿®æ”¹æœåŠ¡å™¨ä¿¡æ¯**ï¼šIPã€ç”¨æˆ·åã€å¯†ç 
2. **ä¿®æ”¹åŸŸåä¿¡æ¯**ï¼šæ›¿æ¢æ‰€æœ‰åŸŸå
3. **ä¿®æ”¹é¡¹ç›®è·¯å¾„**ï¼š`/srv/EmbodiedPulse2026` â†’ æ–°è·¯å¾„
4. **ä¿®æ”¹æœåŠ¡åç§°**ï¼š`embodiedpulse` â†’ æ–°æœåŠ¡å
5. **æŒ‰ç…§æœ¬æ•™ç¨‹é€æ­¥æ‰§è¡Œ**

---

## é™„å½•ï¼šå®Œæ•´é…ç½®æ–‡ä»¶å‚è€ƒ

### A.1 .env æ–‡ä»¶å®Œæ•´æ¨¡æ¿

```bash
# Flask ç¯å¢ƒ
FLASK_ENV=production

# å®šæ—¶ä»»åŠ¡å¼€å…³
AUTO_FETCH_ENABLED=true

# å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆCRON æ ¼å¼ï¼‰
AUTO_FETCH_SCHEDULE=0 * * * *
AUTO_FETCH_BILIBILI_SCHEDULE=0 */6 * * *
AUTO_FETCH_NEWS_SCHEDULE=0 * * * *
AUTO_FETCH_JOBS_SCHEDULE=0 * * * *
AUTO_FETCH_FULL_SCHEDULE=0 2 * * *

# Semantic Scholar æ›´æ–°é™åˆ¶
SEMANTIC_UPDATE_LIMIT=200

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info
```

### A.2 systemd æœåŠ¡æ–‡ä»¶å®Œæ•´æ¨¡æ¿

```ini
[Unit]
Description=Embodied Pulse Flask Application (Gunicorn)
After=network.target

[Service]
User=root
Group=root
WorkingDirectory=/srv/EmbodiedPulse2026
Environment="PATH=/srv/EmbodiedPulse2026/venv/bin"
Environment="FLASK_ENV=production"
EnvironmentFile=/srv/EmbodiedPulse2026/.env
ExecStart=/srv/EmbodiedPulse2026/venv/bin/gunicorn -c /srv/EmbodiedPulse2026/gunicorn_config.py app:app
ExecReload=/bin/kill -s HUP $MAINPID
Restart=always
RestartSec=3
StandardOutput=journal
StandardError=journal
SyslogIdentifier=embodiedpulse

[Install]
WantedBy=multi-user.target
```

### A.3 Nginx é…ç½®æ–‡ä»¶å®Œæ•´æ¨¡æ¿

è§"ä¸ƒã€Nginx é…ç½®"ç« èŠ‚ä¸­çš„å®Œæ•´é…ç½®ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-17  
**ç»´æŠ¤è€…**: AI Assistant  
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®å®é™…éƒ¨ç½²ç»éªŒè¡¥å……

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ"åä¸€ã€å¸¸è§é—®é¢˜ä¸Debug"ç« èŠ‚ã€‚** ğŸš€

