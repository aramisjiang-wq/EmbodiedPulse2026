# 运维协作清单

**项目名称**：Robotics ArXiv Daily (Embodied Pulse)  
**创建时间**：2025年12月10日  
**版本**：v1.2.2

---

## 📋 快速信息

### 项目基本信息
- **Git仓库**：`<请填写实际仓库地址>`
- **分支**：`main`
- **部署方式**：Docker Compose（推荐）或直接部署
- **应用端口**：5001（内部），80/443（外部，通过Nginx）

### 服务器要求
- **最低配置**：2核CPU，2GB内存，20GB存储
- **推荐配置**：4核CPU，4GB内存，50GB存储
- **操作系统**：Ubuntu 22.04 LTS（或其他Linux发行版）

---

## 🚀 快速部署（Docker Compose方式）

### 1. 准备服务器
```bash
# 安装Docker和Docker Compose
sudo apt-get update
sudo apt-get install -y docker.io docker-compose
sudo systemctl enable docker
sudo systemctl start docker
```

### 2. 部署应用
```bash
# 克隆项目
git clone <git-repo-url> /opt/robotics-arxiv-daily
cd /opt/robotics-arxiv-daily

# 配置环境变量
cat > .env << EOF
DATABASE_URL=sqlite:///./papers.db
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
AUTO_FETCH_MAX_RESULTS=100
LOG_LEVEL=info
EOF

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f web
```

### 3. 配置Nginx反向代理
```bash
# 创建Nginx配置
sudo tee /etc/nginx/sites-available/robotics-arxiv > /dev/null << 'EOF'
server {
    listen 80;
    server_name your-domain.com;  # 替换为实际域名

    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static {
        alias /opt/robotics-arxiv-daily/static;
        expires 30d;
    }
}
EOF

# 启用配置
sudo ln -s /etc/nginx/sites-available/robotics-arxiv /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 4. 配置SSL（可选，推荐）
```bash
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

---

## 🔄 日常更新流程

### 方式A：手动更新（适合小团队）
```bash
# 开发者推送代码后，运维执行：
cd /opt/robotics-arxiv-daily
git pull origin main
docker-compose build
docker-compose up -d
docker-compose logs -f web  # 查看日志确认正常
```

### 方式B：CI/CD自动部署（推荐）
- 开发者推送代码到Git仓库
- CI/CD自动触发部署
- 无需运维手动操作

---

## 📊 监控和日志

### 查看日志
```bash
# 实时查看日志
docker-compose logs -f web

# 查看最近100行
docker-compose logs --tail=100 web
```

### 健康检查
```bash
# 检查服务状态
curl http://localhost:5001/api/stats

# 预期响应：{"success": true, ...}
```

### 服务状态
```bash
# 查看容器状态
docker-compose ps

# 查看资源使用
docker stats robotics-arxiv-web
```

---

## 💾 备份策略

### 需要备份的文件
1. **数据库文件**：`/opt/robotics-arxiv-daily/papers.db`（最重要）
2. **配置文件**：`/opt/robotics-arxiv-daily/config.yaml`

### 备份脚本
```bash
#!/bin/bash
# /opt/robotics-arxiv-daily/backup.sh

BACKUP_DIR="/backup/robotics-arxiv"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# 备份数据库
cp /opt/robotics-arxiv-daily/papers.db $BACKUP_DIR/papers_${DATE}.db

# 压缩备份
tar -czf $BACKUP_DIR/backup_${DATE}.tar.gz $BACKUP_DIR/papers_${DATE}.db

# 删除7天前的备份
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete

echo "备份完成: $BACKUP_DIR/backup_${DATE}.tar.gz"
```

### 设置定时备份
```bash
# 每天凌晨3点备份
0 3 * * * /opt/robotics-arxiv-daily/backup.sh >> /var/log/robotics-arxiv-backup.log 2>&1
```

---

## 🔧 故障排查

### 服务无法启动
```bash
# 查看日志
docker-compose logs web

# 检查端口占用
netstat -tlnp | grep 5001

# 检查数据库文件权限
ls -l /opt/robotics-arxiv-daily/papers.db
```

### 数据库问题
```bash
# 检查数据库文件
ls -lh /opt/robotics-arxiv-daily/papers.db

# 检查文件权限
chmod 666 /opt/robotics-arxiv-daily/papers.db  # 或使用适当的用户权限
```

### 性能问题
```bash
# 查看资源使用
docker stats robotics-arxiv-web

# 查看进程
ps aux | grep gunicorn
```

---

## 📞 联系信息

**开发者联系方式**：`<请填写>`

**问题反馈**：
- 紧急问题：`<请填写紧急联系方式>`
- 一般问题：通过GitHub Issues或邮件

---

## 📝 环境变量说明

| 变量名 | 说明 | 必需 | 默认值 |
|--------|------|------|--------|
| `DATABASE_URL` | 数据库连接URL | ✅ | `sqlite:///./papers.db` |
| `FLASK_ENV` | Flask环境 | ✅ | `production` |
| `LOG_LEVEL` | 日志级别 | ❌ | `info` |
| `AUTO_FETCH_ENABLED` | 是否启用自动抓取 | ❌ | `false` |
| `AUTO_FETCH_SCHEDULE` | 自动抓取时间（Cron格式） | ❌ | `0 2 * * *` |
| `AUTO_FETCH_MAX_RESULTS` | 每次抓取最大论文数 | ❌ | `10` |

---

## ✅ 部署检查清单

**部署前：**
- [ ] 服务器配置满足要求
- [ ] Docker和Docker Compose已安装
- [ ] Git仓库可访问
- [ ] 域名DNS已配置

**部署中：**
- [ ] 代码已克隆
- [ ] 环境变量已配置
- [ ] 服务已启动
- [ ] 健康检查通过

**部署后：**
- [ ] 网站可正常访问
- [ ] API接口正常
- [ ] 定时任务已配置
- [ ] 备份已配置

---

**详细部署文档**：请参考 `生产环境部署方案_20251210.md`





