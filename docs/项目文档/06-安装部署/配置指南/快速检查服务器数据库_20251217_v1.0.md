# 快速检查服务器数据库

**版本**: v1.0  
**日期**: 2025-12-17

---

## 🚀 一键检查命令（复制粘贴执行）

```bash
ssh root@101.200.222.139 << 'EOF'
cd /srv/EmbodiedPulse2026
git pull origin main 2>/dev/null || true
bash scripts/check_server_database.sh 2>/dev/null || python3 << 'PYEOF'
import os
from dotenv import load_dotenv

load_dotenv()

print("=" * 60)
print("当前数据库配置和数据量")
print("=" * 60)
print()

# 检查论文数据库
papers_db_url = os.getenv('DATABASE_URL', 'sqlite:///./papers.db')
print("📚 具身论文数据库:")
print(f"   配置: {papers_db_url}")

if papers_db_url.startswith('postgresql://') or papers_db_url.startswith('postgres://'):
    print("   ✅ 使用: PostgreSQL")
    try:
        from models import get_session, Paper
        session = get_session()
        papers_count = session.query(Paper).count()
        session.close()
        print(f"   📊 论文数量: {papers_count} 篇")
    except Exception as e:
        print(f"   ❌ 无法查询: {e}")
else:
    print("   ✅ 使用: SQLite")
    import os.path
    db_file = papers_db_url.replace('sqlite:///', '')
    if os.path.exists(db_file):
        size = os.path.getsize(db_file) / (1024 * 1024)
        print(f"   文件: {db_file}")
        print(f"   大小: {size:.2f} MB")
        try:
            from models import get_session, Paper
            session = get_session()
            papers_count = session.query(Paper).count()
            session.close()
            print(f"   📊 论文数量: {papers_count} 篇")
        except Exception as e:
            print(f"   ❌ 无法查询: {e}")
    else:
        print(f"   ⚠️  文件不存在")

print()

# 检查B站数据库
bilibili_db_url = os.getenv('BILIBILI_DATABASE_URL', 'sqlite:///./bilibili.db')
print("📹 具身视频数据库:")
print(f"   配置: {bilibili_db_url}")

if bilibili_db_url.startswith('postgresql://') or bilibili_db_url.startswith('postgres://'):
    print("   ✅ 使用: PostgreSQL")
    try:
        from bilibili_models import get_bilibili_session, BilibiliUp, BilibiliVideo
        bilibili_session = get_bilibili_session()
        ups_count = bilibili_session.query(BilibiliUp).count()
        videos_count = bilibili_session.query(BilibiliVideo).count()
        bilibili_session.close()
        print(f"   📊 UP主数量: {ups_count} 个")
        print(f"   📊 视频数量: {videos_count} 个")
    except Exception as e:
        print(f"   ❌ 无法查询: {e}")
else:
    print("   ✅ 使用: SQLite")
    db_file = bilibili_db_url.replace('sqlite:///', '')
    if os.path.exists(db_file):
        size = os.path.getsize(db_file) / (1024 * 1024)
        print(f"   文件: {db_file}")
        print(f"   大小: {size:.2f} MB")
        try:
            from bilibili_models import get_bilibili_session, BilibiliUp, BilibiliVideo
            bilibili_session = get_bilibili_session()
            ups_count = bilibili_session.query(BilibiliUp).count()
            videos_count = bilibili_session.query(BilibiliVideo).count()
            bilibili_session.close()
            print(f"   📊 UP主数量: {ups_count} 个")
            print(f"   📊 视频数量: {videos_count} 个")
        except Exception as e:
            print(f"   ❌ 无法查询: {e}")
    else:
        print(f"   ⚠️  文件不存在")

print()
print("=" * 60)
PYEOF
EOF
```

---

## 📋 或者分步执行

### 步骤1：SSH登录服务器

```bash
ssh root@101.200.222.139
```

### 步骤2：进入项目目录

```bash
cd /srv/EmbodiedPulse2026
```

### 步骤3：拉取最新代码（如果需要）

```bash
git pull origin main
```

### 步骤4：执行检查

```bash
bash scripts/check_server_database.sh
```

---

## 📊 输出示例

```
==========================================
服务器数据库检查
==========================================

📄 .env文件配置:
   DATABASE_URL: sqlite:///./papers.db
   BILIBILI_DATABASE_URL: sqlite:///./bilibili.db

📁 SQLite文件检查:
   ✓  papers.db 存在 (大小: 45.2M)
   ✓  bilibili.db 存在 (大小: 12.5M)

🐘 PostgreSQL检查:
   ✓  PostgreSQL已安装
   ⚠  数据库 'embodied_pulse' 不存在

============================================================
当前数据库配置和数据量
============================================================

📚 具身论文数据库:
   配置: sqlite:///./papers.db
   ✅ 使用: SQLite
   文件: papers.db
   大小: 45.23 MB
   📊 论文数量: 14234 篇

📹 具身视频数据库:
   配置: sqlite:///./bilibili.db
   ✅ 使用: SQLite
   文件: bilibili.db
   大小: 12.45 MB
   📊 UP主数量: 25 个
   📊 视频数量: 1250 个

============================================================
```

---

**文档版本**: v1.0  
**最后更新**: 2025-12-17

