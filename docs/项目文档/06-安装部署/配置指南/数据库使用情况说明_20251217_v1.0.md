# æ•°æ®åº“ä½¿ç”¨æƒ…å†µè¯´æ˜

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š å½“å‰æ•°æ®åº“é…ç½®

### 1. å…·èº«è®ºæ–‡æ•°æ®åº“

**ç¯å¢ƒå˜é‡**: `DATABASE_URL`  
**é»˜è®¤å€¼**: `sqlite:///./papers.db`  
**å½“å‰çŠ¶æ€**: 
- å¦‚æœæœªè®¾ç½® `DATABASE_URL`ï¼Œä½¿ç”¨ SQLite (`papers.db`)
- å¦‚æœè®¾ç½®äº† `DATABASE_URL=postgresql://...`ï¼Œä½¿ç”¨ PostgreSQL

**ä½¿ç”¨ä½ç½®**:
- `models.py` - è®ºæ–‡æ•°æ®æ¨¡å‹
- `database.py` - Flask-SQLAlchemyé…ç½®
- `app.py` - è®ºæ–‡ç›¸å…³APIç«¯ç‚¹

---

### 2. å…·èº«è§†é¢‘æ•°æ®åº“

**ç¯å¢ƒå˜é‡**: `BILIBILI_DATABASE_URL`  
**é»˜è®¤å€¼**: `sqlite:///./bilibili.db`  
**å½“å‰çŠ¶æ€**:
- å¦‚æœæœªè®¾ç½® `BILIBILI_DATABASE_URL`ï¼Œä½¿ç”¨ SQLite (`bilibili.db`)
- å¦‚æœè®¾ç½®äº† `BILIBILI_DATABASE_URL=postgresql://...`ï¼Œä½¿ç”¨ PostgreSQL

**ä½¿ç”¨ä½ç½®**:
- `bilibili_models.py` - Bç«™æ•°æ®æ¨¡å‹
- `app.py` - Bç«™ç›¸å…³APIç«¯ç‚¹

---

## ğŸ” å¦‚ä½•æ£€æŸ¥å½“å‰ä½¿ç”¨çš„æ•°æ®åº“

### æ–¹æ³•1ï¼šä½¿ç”¨æ£€æŸ¥è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /srv/EmbodiedPulse2026
python3 scripts/check_current_database.py
```

**è¾“å‡ºç¤ºä¾‹**:
```
============================================================
å½“å‰æ•°æ®åº“é…ç½®æ£€æŸ¥
============================================================

ğŸ“š å…·èº«è®ºæ–‡æ•°æ®åº“:
   DATABASE_URL: sqlite:///./papers.db
   âœ… ä½¿ç”¨: SQLite
   æ–‡ä»¶: papers.db
   å¤§å°: 45.23 MB

ğŸ“¹ å…·èº«è§†é¢‘æ•°æ®åº“:
   BILIBILI_DATABASE_URL: sqlite:///./bilibili.db
   âœ… ä½¿ç”¨: SQLite
   æ–‡ä»¶: bilibili.db
   å¤§å°: 12.45 MB

ğŸ“Š æ•°æ®ç»Ÿè®¡:
   è®ºæ–‡æ•°é‡: 14234 ç¯‡
   UPä¸»æ•°é‡: 25 ä¸ª
   è§†é¢‘æ•°é‡: 1250 ä¸ª
```

### æ–¹æ³•2ï¼šæ£€æŸ¥.envæ–‡ä»¶

```bash
cd /srv/EmbodiedPulse2026
cat .env | grep DATABASE_URL
```

**è¾“å‡ºç¤ºä¾‹**:
```
DATABASE_URL=sqlite:///./papers.db
BILIBILI_DATABASE_URL=sqlite:///./bilibili.db
```

### æ–¹æ³•3ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
cd /srv/EmbodiedPulse2026
source venv/bin/activate
python3 << 'EOF'
import os
from dotenv import load_dotenv
load_dotenv()

print("è®ºæ–‡æ•°æ®åº“:", os.getenv('DATABASE_URL', 'sqlite:///./papers.db'))
print("Bç«™æ•°æ®åº“:", os.getenv('BILIBILI_DATABASE_URL', 'sqlite:///./bilibili.db'))
EOF
```

---

## ğŸ“ è¿ç§»çŠ¶æ€è¯´æ˜

### å…·èº«è®ºæ–‡æ•°æ®åº“è¿ç§»

**è¿ç§»è„šæœ¬**: `migrate_sqlite_to_postgresql.py`  
**è¿ç§»è¡¨**: `papers`  
**çŠ¶æ€**: 
- âœ… è¿ç§»è„šæœ¬å·²æ”¯æŒ
- âš ï¸ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œè¿ç§»

### å…·èº«è§†é¢‘æ•°æ®åº“è¿ç§»

**è¿ç§»è„šæœ¬**: `migrate_sqlite_to_postgresql.py`  
**è¿ç§»è¡¨**: 
- `bilibili_ups` (UPä¸»)
- `bilibili_videos` (è§†é¢‘)
**çŠ¶æ€**: 
- âœ… è¿ç§»è„šæœ¬å·²æ”¯æŒï¼ˆå·²æ·»åŠ ï¼‰
- âš ï¸ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œè¿ç§»

---

## ğŸš€ è¿ç§»åˆ°PostgreSQLåçš„é…ç½®

### è¿ç§»å‰ï¼ˆSQLiteï¼‰

```bash
# .envæ–‡ä»¶
DATABASE_URL=sqlite:///./papers.db
BILIBILI_DATABASE_URL=sqlite:///./bilibili.db
```

### è¿ç§»åï¼ˆPostgreSQLï¼‰

```bash
# .envæ–‡ä»¶
DATABASE_URL=postgresql://embodied_user:å¯†ç @localhost:5432/embodied_pulse
BILIBILI_DATABASE_URL=postgresql://embodied_user:å¯†ç @localhost:5432/embodied_pulse
```

**æ³¨æ„**: 
- ä¸¤ä¸ªæ•°æ®åº“å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªPostgreSQLæ•°æ®åº“ï¼ˆæ¨èï¼‰
- ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„PostgreSQLæ•°æ®åº“
- å¯†ç éœ€è¦URLç¼–ç ï¼ˆç‰¹æ®Šå­—ç¬¦ï¼‰

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

æ‰§è¡Œè¿ç§»åï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] `DATABASE_URL` å·²æ›´æ–°ä¸ºPostgreSQL URL
- [ ] `BILIBILI_DATABASE_URL` å·²æ›´æ–°ä¸ºPostgreSQL URLï¼ˆæˆ–ä½¿ç”¨ä¸»æ•°æ®åº“ï¼‰
- [ ] è®ºæ–‡æ•°æ®å·²è¿ç§»ï¼ˆæ•°æ®é‡æ­£ç¡®ï¼‰
- [ ] Bç«™UPä¸»æ•°æ®å·²è¿ç§»ï¼ˆæ•°æ®é‡æ­£ç¡®ï¼‰
- [ ] Bç«™è§†é¢‘æ•°æ®å·²è¿ç§»ï¼ˆæ•°æ®é‡æ­£ç¡®ï¼‰
- [ ] ç½‘ç«™åŠŸèƒ½æ­£å¸¸ï¼ˆè®ºæ–‡é¡µé¢ã€Bç«™é¡µé¢ï¼‰
- [ ] æœåŠ¡é‡å¯æˆåŠŸ

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®è®¤æ˜¯å¦å·²è¿ç§»åˆ°PostgreSQLï¼Ÿ

**A**: è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š
```bash
python3 scripts/check_current_database.py
```

å¦‚æœæ˜¾ç¤º "âœ… ä½¿ç”¨: PostgreSQL"ï¼Œè¯´æ˜å·²è¿ç§»ã€‚

### Q2: ä¸¤ä¸ªæ•°æ®åº“å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ªPostgreSQLæ•°æ®åº“å—ï¼Ÿ

**A**: ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ¨èä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“ï¼Œä¾¿äºç®¡ç†å’Œå¤‡ä»½ã€‚

### Q3: è¿ç§»åSQLiteæ–‡ä»¶è¿˜éœ€è¦ä¿ç•™å—ï¼Ÿ

**A**: å»ºè®®ä¿ç•™ä½œä¸ºå¤‡ä»½ï¼Œç¡®è®¤è¿ç§»æˆåŠŸåå†åˆ é™¤ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-17

