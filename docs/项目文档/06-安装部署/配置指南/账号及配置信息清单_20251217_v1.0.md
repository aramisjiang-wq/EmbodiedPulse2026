# è´¦å·åŠé…ç½®ä¿¡æ¯æ¸…å•

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-17  
**âš ï¸ å®‰å…¨æç¤º**: æœ¬æ–‡æ¡£åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²ç»™æœªæˆæƒäººå‘˜

---

## ğŸ“‹ ç›®å½•

1. [æœåŠ¡å™¨ä¿¡æ¯](#ä¸€æœåŠ¡å™¨ä¿¡æ¯)
2. [åŸŸåä¿¡æ¯](#äºŒåŸŸåä¿¡æ¯)
3. [GitHub ä¿¡æ¯](#ä¸‰github-ä¿¡æ¯)
4. [é£ä¹¦ OAuth é…ç½®](#å››é£ä¹¦-oauth-é…ç½®)
5. [JWT é…ç½®](#äº”jwt-é…ç½®)
6. [æ•°æ®åº“é…ç½®](#å…­æ•°æ®åº“é…ç½®)
7. [ç¯å¢ƒå˜é‡é…ç½®](#ä¸ƒç¯å¢ƒå˜é‡é…ç½®)
8. [GitHub Actions Secrets](#å…«github-actions-secrets)
9. [SSH å¯†é’¥ä¿¡æ¯](#ä¹ssh-å¯†é’¥ä¿¡æ¯)

---

## ä¸€ã€æœåŠ¡å™¨ä¿¡æ¯

### 1.1 åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **æœåŠ¡å™¨IP** | `101.200.222.139` |
| **SSHç«¯å£** | `22`ï¼ˆé»˜è®¤ï¼‰ |
| **ç”¨æˆ·å** | `root` |
| **å¯†ç ** | `XLj4kUnh` |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 20.04.6 LTS |
| **é¡¹ç›®ç›®å½•** | `/srv/EmbodiedPulse2026` |

### 1.2 SSH è¿æ¥å‘½ä»¤

```bash
ssh root@101.200.222.139
# è¾“å…¥å¯†ç : XLj4kUnh
```

### 1.3 æœåŠ¡å™¨ç«¯å£

| ç«¯å£ | ç”¨é€” | çŠ¶æ€ |
|------|------|------|
| `22` | SSH | âœ… å¼€æ”¾ |
| `80` | HTTP | âœ… å¼€æ”¾ï¼ˆNginxï¼‰ |
| `443` | HTTPS | âœ… å¼€æ”¾ï¼ˆNginxï¼‰ |
| `5001` | Flask/Gunicorn | ğŸ”’ ä»…æœ¬åœ°ï¼ˆ127.0.0.1ï¼‰ |

---

## äºŒã€åŸŸåä¿¡æ¯

### 2.1 åŸŸååˆ—è¡¨

| åŸŸå | ç”¨é€” | è·¯ç”± | çŠ¶æ€ |
|------|------|------|------|
| `login.gradmotion.com` | ç™»å½•é¡µé¢ | `/login` | âœ… å·²é…ç½® |
| `essay.gradmotion.com` | å…·èº«è®ºæ–‡é¡µé¢ | `/` | âœ… å·²é…ç½® |
| `blibli.gradmotion.com` | å…·èº«è§†é¢‘é¡µé¢ | `/bilibili` | âœ… å·²é…ç½® |
| `admin123.gradmotion.com` | ç®¡ç†ç«¯ | `/admin` | âœ… å·²é…ç½® |

### 2.2 DNS é…ç½®è¦æ±‚

**æ‰€æœ‰åŸŸåéƒ½éœ€è¦é…ç½® A è®°å½•ï¼ŒæŒ‡å‘æœåŠ¡å™¨IP**ï¼š

```
login.gradmotion.com    A    101.200.222.139
essay.gradmotion.com    A    101.200.222.139
blibli.gradmotion.com   A    101.200.222.139
admin123.gradmotion.com A    101.200.222.139
```

**é…ç½®ä½ç½®**: åŸŸåç®¡ç†å¹³å°ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰

---

## ä¸‰ã€GitHub ä¿¡æ¯

### 3.1 ä»“åº“ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **ä»“åº“åœ°å€** | `https://github.com/aramisjiang-wq/EmbodiedPulse2026` |
| **é»˜è®¤åˆ†æ”¯** | `main` |
| **ä»“åº“ç±»å‹** | Privateï¼ˆç§æœ‰ï¼‰ |

### 3.2 è®¿é—®æ–¹å¼

- **HTTPS**: `https://github.com/aramisjiang-wq/EmbodiedPulse2026.git`
- **SSH**: `git@github.com:aramisjiang-wq/EmbodiedPulse2026.git`

---

## å››ã€é£ä¹¦ OAuth é…ç½®

### 4.1 åº”ç”¨ä¿¡æ¯

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| **App ID** | `cli_a6727c4ffc71d00b` | é£ä¹¦åº”ç”¨ID |
| **App Secret** | `dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI` | é£ä¹¦åº”ç”¨å¯†é’¥ |
| **å›è°ƒåœ°å€ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰** | `https://login.gradmotion.com/api/auth/feishu/callback` | âš ï¸ **éœ€è¦é…ç½®** |

### 4.2 å›è°ƒåœ°å€é…ç½® âš ï¸ **é‡è¦**

**éœ€è¦åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®çš„å›è°ƒåœ°å€**ï¼š

1. **ç”Ÿäº§ç¯å¢ƒï¼ˆå¿…é¡»ï¼‰**:
   ```
   https://login.gradmotion.com/api/auth/feishu/callback
   ```

2. **å¤‡ç”¨åœ°å€ï¼ˆå¯é€‰ï¼‰**:
   ```
   https://essay.gradmotion.com/api/auth/feishu/callback
   ```

**é…ç½®æ­¥éª¤**:
1. è®¿é—®é£ä¹¦å¼€æ”¾å¹³å°: https://open.feishu.cn
2. ç™»å½•ç®¡ç†å‘˜è´¦å·
3. æ‰¾åˆ°åº”ç”¨ï¼ˆApp ID: `cli_a6727c4ffc71d00b`ï¼‰
4. è¿›å…¥"å®‰å…¨è®¾ç½®" â†’ "é‡å®šå‘URL"
5. æ·»åŠ ä»¥ä¸Šå›è°ƒåœ°å€
6. ä¿å­˜é…ç½®

**âš ï¸ é‡è¦æç¤º**:
- å›è°ƒåœ°å€å¿…é¡»ä½¿ç”¨ **HTTPS**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- å›è°ƒåœ°å€è·¯å¾„å¿…é¡»æ˜¯ `/api/auth/feishu/callback`
- å›è°ƒåœ°å€å¿…é¡»åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®åæ‰èƒ½æ­£å¸¸ç™»å½•

### 4.3 ç¯å¢ƒå˜é‡é…ç½®

åœ¨æœåŠ¡å™¨çš„ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
FEISHU_APP_ID=cli_a6727c4ffc71d00b
FEISHU_APP_SECRET=dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI
FEISHU_REDIRECT_URI=https://login.gradmotion.com/api/auth/feishu/callback
```

---

## äº”ã€JWT é…ç½®

### 5.1 JWT å¯†é’¥

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| **JWT_SECRET_KEY** | `embodied-pulse-jwt-secret-key-2025` | JWT åŠ å¯†å¯†é’¥ |
| **JWT_ACCESS_TOKEN_EXPIRES** | `86400` | Token æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ï¼Œ24å°æ—¶ |

### 5.2 ç¯å¢ƒå˜é‡é…ç½®

åœ¨æœåŠ¡å™¨çš„ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
JWT_SECRET_KEY=embodied-pulse-jwt-secret-key-2025
JWT_ACCESS_TOKEN_EXPIRES=86400
```

**âš ï¸ å®‰å…¨æç¤º**:
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„éšæœºå­—ç¬¦ä¸²
- ä¸è¦å°†å¯†é’¥æäº¤åˆ°ä»£ç ä»“åº“

---

## å…­ã€æ•°æ®åº“é…ç½®

### 6.1 æ•°æ®åº“æ–‡ä»¶ä½ç½®

| æ•°æ®åº“ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|--------|----------|------|
| **è®ºæ–‡æ•°æ®åº“** | `/srv/EmbodiedPulse2026/instance/papers.db` | SQLite |
| **Bç«™è§†é¢‘æ•°æ®åº“** | `/srv/EmbodiedPulse2026/bilibili.db` | SQLite |
| **æ–°é—»æ•°æ®åº“** | `/srv/EmbodiedPulse2026/news.db` | SQLiteï¼ˆå¯é€‰ï¼‰ |
| **æ‹›è˜æ•°æ®åº“** | `/srv/EmbodiedPulse2026/jobs.db` | SQLiteï¼ˆå¯é€‰ï¼‰ |

### 6.2 æ•°æ®åº“è¿æ¥é…ç½®

**å½“å‰ä½¿ç”¨ SQLite**ï¼ˆé»˜è®¤é…ç½®ï¼‰ï¼š

```bash
DATABASE_URL=sqlite:///./papers.db
```

**å¦‚æœä½¿ç”¨ PostgreSQL**ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
DATABASE_URL=postgresql://username:password@localhost:5432/embodied_pulse
```

---

## ä¸ƒã€ç¯å¢ƒå˜é‡é…ç½®

### 7.1 å®Œæ•´ .env æ–‡ä»¶æ¨¡æ¿

**æ–‡ä»¶ä½ç½®**: `/srv/EmbodiedPulse2026/.env`

```bash
# ==================== Flask ç¯å¢ƒ ====================
FLASK_ENV=production

# ==================== é£ä¹¦ OAuth é…ç½® ====================
FEISHU_APP_ID=cli_a6727c4ffc71d00b
FEISHU_APP_SECRET=dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI
FEISHU_REDIRECT_URI=https://login.gradmotion.com/api/auth/feishu/callback

# ==================== JWT é…ç½® ====================
JWT_SECRET_KEY=embodied-pulse-jwt-secret-key-2025
JWT_ACCESS_TOKEN_EXPIRES=86400

# ==================== æ•°æ®åº“é…ç½® ====================
DATABASE_URL=sqlite:///./papers.db

# ==================== å®šæ—¶ä»»åŠ¡å¼€å…³ ====================
AUTO_FETCH_ENABLED=true

# ==================== å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆCRON æ ¼å¼ï¼‰====================
# æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œè®ºæ–‡æŠ“å–
AUTO_FETCH_SCHEDULE=0 * * * *

# æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡Bç«™æ•°æ®æŠ“å–ï¼ˆé¿å…è§¦å‘é£æ§ï¼‰
AUTO_FETCH_BILIBILI_SCHEDULE=0 */6 * * *

# æ¯å°æ—¶æ‰§è¡Œæ–°é—»æŠ“å–
AUTO_FETCH_NEWS_SCHEDULE=0 * * * *

# æ¯å°æ—¶æ‰§è¡Œæ‹›è˜ä¿¡æ¯æŠ“å–
AUTO_FETCH_JOBS_SCHEDULE=0 * * * *

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå…¨é‡è®ºæ–‡æŠ“å–
AUTO_FETCH_FULL_SCHEDULE=0 2 * * *

# ==================== Semantic Scholar æ›´æ–°é™åˆ¶ ====================
SEMANTIC_UPDATE_LIMIT=200

# ==================== æ—¥å¿—çº§åˆ« ====================
LOG_LEVEL=info
```

### 7.2 ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `FLASK_ENV` | âœ… | `production` | Flask ç¯å¢ƒ |
| `FEISHU_APP_ID` | âœ… | - | é£ä¹¦ App ID |
| `FEISHU_APP_SECRET` | âœ… | - | é£ä¹¦ App Secret |
| `FEISHU_REDIRECT_URI` | âœ… | - | é£ä¹¦å›è°ƒåœ°å€ |
| `JWT_SECRET_KEY` | âœ… | - | JWT å¯†é’¥ |
| `AUTO_FETCH_ENABLED` | âœ… | `false` | å®šæ—¶ä»»åŠ¡å¼€å…³ |
| `AUTO_FETCH_SCHEDULE` | âŒ | `0 * * * *` | è®ºæ–‡æŠ“å–è°ƒåº¦ |
| `AUTO_FETCH_BILIBILI_SCHEDULE` | âŒ | `0 */6 * * *` | Bç«™æŠ“å–è°ƒåº¦ |
| `LOG_LEVEL` | âŒ | `info` | æ—¥å¿—çº§åˆ« |

---

## å…«ã€GitHub Actions Secrets

### 8.1 Secrets åˆ—è¡¨

**é…ç½®ä½ç½®**: GitHub ä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions

| Secret åç§° | å€¼ | è¯´æ˜ |
|------------|-----|------|
| `SERVER_HOST` | `101.200.222.139` | æœåŠ¡å™¨IP |
| `SERVER_USER` | `root` | SSH ç”¨æˆ·å |
| `SERVER_SSH_PORT` | `22` | SSH ç«¯å£ |
| `SERVER_SSH_KEY` | ï¼ˆè§ä¸‹æ–¹ï¼‰ | SSH ç§é’¥ |

### 8.2 SSH ç§é’¥ç”Ÿæˆ

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**:

```bash
# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions

# æŒ‰æç¤ºæ“ä½œï¼ˆç›´æ¥æŒ‰ Enterï¼Œä¸è®¾å¯†ç ï¼‰

# å°†å…¬é’¥æ·»åŠ åˆ° authorized_keys
cat ~/.ssh/github_actions.pub >> ~/.ssh/authorized_keys

# è®¾ç½®æƒé™
chmod 600 ~/.ssh/github_actions
chmod 644 ~/.ssh/authorized_keys

# æŸ¥çœ‹ç§é’¥ï¼ˆå¤åˆ¶å…¨éƒ¨å†…å®¹ï¼ŒåŒ…æ‹¬ BEGIN å’Œ END è¡Œï¼‰
cat ~/.ssh/github_actions
```

**å°†ç§é’¥å†…å®¹æ·»åŠ åˆ° GitHub Secrets**:
- å¤åˆ¶å®Œæ•´çš„ç§é’¥å†…å®¹ï¼ˆä» `-----BEGIN OPENSSH PRIVATE KEY-----` åˆ° `-----END OPENSSH PRIVATE KEY-----`ï¼‰
- åœ¨ GitHub ä»“åº“çš„ Secrets é¡µé¢æ·»åŠ  `SERVER_SSH_KEY`

---

## ä¹ã€SSH å¯†é’¥ä¿¡æ¯

### 9.1 GitHub Actions éƒ¨ç½²å¯†é’¥

**å¯†é’¥æ–‡ä»¶**: `~/.ssh/github_actions`ï¼ˆæœåŠ¡å™¨ä¸Šï¼‰

**ç”¨é€”**: GitHub Actions è‡ªåŠ¨éƒ¨ç½²æ—¶ SSH ç™»å½•æœåŠ¡å™¨

**æƒé™**: 
- ç§é’¥æƒé™: `600`
- å…¬é’¥å·²æ·»åŠ åˆ° `~/.ssh/authorized_keys`

### 9.2 å¯†é’¥ç®¡ç†

**æŸ¥çœ‹å¯†é’¥**:
```bash
# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/github_actions.pub

# æŸ¥çœ‹ç§é’¥ï¼ˆç”¨äºæ·»åŠ åˆ° GitHub Secretsï¼‰
cat ~/.ssh/github_actions
```

**é‡æ–°ç”Ÿæˆå¯†é’¥**:
```bash
# å¤‡ä»½æ—§å¯†é’¥
mv ~/.ssh/github_actions ~/.ssh/github_actions.backup
mv ~/.ssh/github_actions.pub ~/.ssh/github_actions.pub.backup

# ç”Ÿæˆæ–°å¯†é’¥
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions

# æ›´æ–° authorized_keys
cat ~/.ssh/github_actions.pub >> ~/.ssh/authorized_keys

# æ›´æ–° GitHub Secretsï¼ˆä½¿ç”¨æ–°ç§é’¥ï¼‰
```

---

## åã€é…ç½®æ£€æŸ¥æ¸…å•

### 10.1 ä¸Šçº¿å‰å¿…é¡»æ£€æŸ¥

- [ ] **æœåŠ¡å™¨ä¿¡æ¯**: IPã€ç”¨æˆ·åã€å¯†ç æ­£ç¡®
- [ ] **åŸŸåDNS**: 4ä¸ªåŸŸåéƒ½è§£æåˆ° `101.200.222.139`
- [ ] **é£ä¹¦å›è°ƒåœ°å€**: å·²åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½® `https://login.gradmotion.com/api/auth/feishu/callback`
- [ ] **ç¯å¢ƒå˜é‡**: `.env` æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…éœ€é…ç½®
- [ ] **GitHub Secrets**: 4ä¸ª Secrets éƒ½å·²é…ç½®
- [ ] **SSH å¯†é’¥**: æœåŠ¡å™¨ä¸Šå·²ç”Ÿæˆå¹¶é…ç½®
- [ ] **HTTPS è¯ä¹¦**: 4ä¸ªåŸŸåéƒ½æœ‰æœ‰æ•ˆçš„ SSL è¯ä¹¦

### 10.2 é…ç½®éªŒè¯å‘½ä»¤

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cd /srv/EmbodiedPulse2026
cat .env | grep -E "FEISHU|JWT|AUTO_FETCH"

# æ£€æŸ¥é£ä¹¦é…ç½®
python3 scripts/check_feishu_config.py

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
bash scripts/check_deployment_status.sh

# æµ‹è¯•åŸŸåè§£æ
nslookup login.gradmotion.com
nslookup essay.gradmotion.com
nslookup blibli.gradmotion.com
nslookup admin123.gradmotion.com

# æµ‹è¯• HTTPS
curl -I https://login.gradmotion.com
curl -I https://essay.gradmotion.com
```

---

## åä¸€ã€å®‰å…¨æ³¨æ„äº‹é¡¹

### 11.1 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

- âœ… ä¸è¦å°†æœ¬æ–‡æ¡£æäº¤åˆ°å…¬å¼€ä»£ç ä»“åº“
- âœ… ä¸è¦å°†å¯†ç å’Œå¯†é’¥ç¡¬ç¼–ç åˆ°ä»£ç ä¸­
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿé…ç½®
- âœ… å®šæœŸæ›´æ¢å¯†ç å’Œå¯†é’¥

### 11.2 è®¿é—®æ§åˆ¶

- âœ… é™åˆ¶ SSH è®¿é—®ï¼ˆä½¿ç”¨å¯†é’¥è®¤è¯ï¼Œç¦ç”¨å¯†ç ç™»å½•ï¼‰
- âœ… é™åˆ¶æœåŠ¡å™¨ç«¯å£è®¿é—®ï¼ˆä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼‰
- âœ… å®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—

### 11.3 å¤‡ä»½ç­–ç•¥

- âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- âœ… å¤‡ä»½é…ç½®æ–‡ä»¶ï¼ˆ`.env`ï¼‰
- âœ… å¤‡ä»½ SSH å¯†é’¥

---

## åäºŒã€å¿«é€Ÿå‚è€ƒ

### 12.1 å…³é”®ä¿¡æ¯é€ŸæŸ¥

**æœåŠ¡å™¨**: `root@101.200.222.139`  
**é¡¹ç›®ç›®å½•**: `/srv/EmbodiedPulse2026`  
**æœåŠ¡åç§°**: `embodiedpulse`  
**åº”ç”¨ç«¯å£**: `5001`ï¼ˆæœ¬åœ°ï¼‰

**é£ä¹¦å›è°ƒåœ°å€**: `https://login.gradmotion.com/api/auth/feishu/callback` âš ï¸ **å¿…é¡»é…ç½®**

### 12.2 å¸¸ç”¨å‘½ä»¤

```bash
# SSH ç™»å½•
ssh root@101.200.222.139

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status embodiedpulse

# æŸ¥çœ‹æ—¥å¿—
journalctl -u embodiedpulse -f

# æ£€æŸ¥é…ç½®
bash /srv/EmbodiedPulse2026/scripts/check_deployment_status.sh
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-17  
**ç»´æŠ¤è€…**: AI Assistant  
**âš ï¸ å®‰å…¨ç­‰çº§**: é«˜åº¦æ•æ„Ÿ - è¯·å¦¥å–„ä¿ç®¡

