# 修复502 Bad Gateway错误

**问题**: 应用崩溃，返回502错误

---

## 立即检查步骤

### 步骤1：检查应用状态

```bash
sudo systemctl status embodiedpulse --no-pager -l
```

### 步骤2：检查应用日志

```bash
sudo journalctl -u embodiedpulse -n 100 --no-pager | tail -50
```

### 步骤3：检查语法错误

```bash
cd /srv/EmbodiedPulse2026

# 检查Python语法
venv/bin/python3 -m py_compile app.py

# 如果有错误，会显示具体位置
```

---

## 可能的原因和修复

### 原因1：删除logger.info后语法错误

如果删除第305行后导致语法错误，需要检查：

```bash
cd /srv/EmbodiedPulse2026

# 检查第1311-1315行
sed -n '1311,1315p' app.py

# 应该看到：
#                    'user_stat': {
#                        'videos': format_number(up.videos_count) if up.videos_count else '0',
#                        'likes': up.likes_formatted or (format_number(up.likes_count) if up.likes_count else '0'),
#                        'views': up.views_formatted or (format_number(up.views_count) if up.views_count else '0'),
#                    },
```

### 原因2：应用进程崩溃

```bash
# 检查进程
ps aux | grep gunicorn | grep -v grep

# 如果没有进程，重启
sudo systemctl restart embodiedpulse
sleep 5
sudo systemctl status embodiedpulse
```

### 原因3：从GitHub恢复正确的代码

如果本地代码是正确的，可以从GitHub拉取：

```bash
cd /srv/EmbodiedPulse2026

# 检查修改
git status

# 如果有未提交的修改，先备份
git stash

# 拉取最新代码
git pull origin main

# 重启
sudo systemctl restart embodiedpulse
```

---

## 快速修复命令

```bash
cd /srv/EmbodiedPulse2026

# 1. 检查语法
venv/bin/python3 -m py_compile app.py 2>&1

# 2. 如果有错误，从GitHub恢复
git checkout app.py

# 3. 或者手动修复（确保第1311-1315行正确）
# 检查当前内容
sed -n '1310,1316p' app.py

# 4. 重启应用
sudo systemctl restart embodiedpulse
sleep 5

# 5. 检查状态
sudo systemctl status embodiedpulse --no-pager -l | head -30
```

---

**文档结束**

