# 测试记录

**最后更新**：2025-12-17  
**版本**：v1.0  
**测试范围**：Embodied Pulse 全功能测试

---

## 📋 目录

1. [应用启动和API测试](#一应用启动和api测试)
2. [管理端测试](#二管理端测试)
3. [用户端测试](#三用户端测试)
4. [论文管理页面测试](#四论文管理页面测试)
5. [视频管理页面测试](#五视频管理页面测试)
6. [常见问题排查](#六常见问题排查)
7. [测试检查清单](#七测试检查清单)

---

## 一、应用启动和API测试

### 1.1 测试时间
2025-12-16 13:04

### 1.2 应用启动测试

**测试步骤**：
```bash
# 检查应用是否运行
lsof -ti:5001

# 如果没有运行，启动应用
cd "/Users/dong/Documents/Cursor/Embodied Pulse"
python3 app.py
```

**测试结果**：
- ✅ 应用已成功启动
- ✅ PID: 89949
- ✅ 监听端口: 5001
- ✅ 日志文件: /tmp/embodied_pulse.log

### 1.3 API测试

#### ✅ /api/stats
- 状态: 正常
- 响应: 成功返回统计数据

#### ✅ /api/fetch-status
- 状态: 正常
- 响应: 成功返回抓取状态

#### ✅ /api/fetch (POST)
- 状态: 正常
- 响应: 抓取任务已启动
- 注意: 如果已有任务在运行，会返回"正在运行中"提示

#### ⚠️ /api/papers
- 状态: 需要检查（可能有 build_nested_from_flat 未定义的问题）

### 1.4 修复验证

#### ✅ 日期过滤修复
- `get_daily_papers()` 函数已添加 `days_back` 参数
- 日期过滤逻辑已正确实现
- ArXiv API查询将包含日期过滤条件

#### ✅ 自动化更新
- 环境变量已设置: `AUTO_FETCH_ENABLED=true`
- 定时任务调度: `0 * * * *` (每小时整点执行)
- APScheduler 已安装

### 1.5 待验证项

1. **定时任务启动**
   - 需要检查日志确认定时任务是否已启动
   - 命令: `tail -f /tmp/embodied_pulse.log | grep -i scheduler`

2. **日期过滤生效**
   - 需要执行一次抓取，检查日志中是否包含日期过滤信息
   - 应该看到: `{topic}: 查询日期范围 YYYY-MM-DD 到 YYYY-MM-DD (最近14天)`

3. **12月12日和15日论文**
   - 执行抓取后，检查数据库确认论文是否被正确抓取

---

## 二、管理端测试

### 2.1 快速开始

**确认Flask应用正在运行**：
```bash
# 检查应用是否运行
lsof -ti:5001

# 如果没有运行，启动应用
cd "/Users/dong/Documents/Cursor/Embodied Pulse"
python3 app.py
```

### 2.2 管理员登录

**访问**: http://localhost:5001/admin/login

**测试步骤**:
1. 在浏览器中打开上述链接
2. 输入用户名: `limx`
3. 输入密码: `limx123456`
4. 点击"登录"按钮
5. ✅ 应该跳转到管理仪表盘

**预期结果**:
- 登录表单渲染正常
- 输入框样式正常
- 登录按钮可点击
- 成功登录后跳转到 `/admin/dashboard`

### 2.3 管理仪表盘

**访问**: http://localhost:5001/admin/dashboard
（登录后自动跳转，或直接访问）

**测试步骤**:
1. 查看页面布局
2. 检查4个统计卡片是否显示
3. 查看图表是否渲染（Chart.js）
4. 检查最近活动列表

**预期结果**:
- ✅ 页面布局完整
- ✅ 统计卡片显示：
  - 总用户数: 0
  - 今日新增: 0
  - 今日登录: 1
  - 今日访问: 0
- ✅ 图表渲染正常
- ✅ 侧边栏显示正常

### 2.4 用户管理页面

**访问**: http://localhost:5001/admin/users

**测试步骤**:
1. 点击侧边栏"用户管理"
2. 查看用户列表（应为空）
3. 测试搜索和筛选功能
4. 检查分页控件

**预期结果**:
- ✅ 页面渲染正常
- ✅ 表格显示"暂无用户数据"
- ✅ 搜索框和筛选器正常
- ✅ 批量操作按钮已禁用

### 2.5 日志监控页面

**访问**: http://localhost:5001/admin/logs

**测试步骤**:
1. 点击侧边栏"日志监控"
2. 查看"登录日志"Tab
3. 切换到"访问日志"Tab
4. 测试筛选功能

**预期结果**:
- ✅ 页面渲染正常
- ✅ Tab切换正常
- ✅ 登录日志显示1条记录（limx登录）
- ✅ 访问日志为空或显示当前访问

### 2.6 退出登录

**测试步骤**:
1. 点击侧边栏底部"退出登录"按钮
2. 确认跳转到登录页面
3. 尝试访问 `/admin/dashboard`
4. 确认被重定向到登录页面

**预期结果**:
- ✅ 成功退出登录
- ✅ 清除Token
- ✅ 需要重新登录才能访问管理页面

---

## 三、用户端测试

### 3.1 飞书登录页面

**访问**: http://localhost:5001/login

**测试步骤**:
1. 在浏览器中打开上述链接
2. 查看页面布局
3. 检查飞书扫码登录组件

**当前状态**: 🔄 需要配置飞书OAuth才能完整测试

**如需测试，请先配置**:
1. 创建 `.env` 文件
2. 添加飞书配置:
```bash
FEISHU_APP_ID=cli_a6727c4ffc71d00b
FEISHU_APP_SECRET=dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI
FEISHU_REDIRECT_URI=http://localhost:5001/api/auth/feishu/callback
JWT_SECRET_KEY=your-secret-key-here
```
3. 重启Flask应用

### 3.2 个人中心

**访问**: http://localhost:5001/profile

**测试步骤**:
1. （需先通过飞书登录）
2. 查看个人信息
3. 测试Tab切换
4. 查看登录历史
5. 查看访问记录

**当前状态**: 🔄 需要先通过飞书登录

---

## 四、论文管理页面测试

### 4.1 访问地址
```
http://localhost:5001/admin/papers
```

### 4.2 测试前准备

**确保服务器运行**：
```bash
# 启动Flask服务器
python3 app.py
# 或
flask run --port 5001
```

**确保已登录管理员账号**：
- 访问 `/admin/login` 登录
- 或使用飞书扫码登录
- 确保账号具有 `admin` 或 `super_admin` 权限

### 4.3 测试项目

#### 4.3.1 页面加载测试
- [ ] 页面能正常加载
- [ ] 侧边栏显示"论文管理"为激活状态
- [ ] 统计卡片显示数据（总论文数、今日新增、平均引用数、类别数）
- [ ] 论文列表正常显示

#### 4.3.2 搜索功能测试
- [ ] 在搜索框输入关键词（如"robot"），点击"搜索"
- [ ] 列表应该只显示包含该关键词的论文
- [ ] 测试搜索标题、作者、摘要

#### 4.3.3 筛选功能测试
- [ ] 选择类别筛选，列表应该只显示该类别论文
- [ ] 选择日期范围（开始日期、结束日期）
- [ ] 输入最小引用数，列表应该只显示引用数>=该值的论文
- [ ] 点击"重置"按钮，所有筛选条件应该清空

#### 4.3.4 分页功能测试
- [ ] 如果论文数量超过20篇，应该显示分页控件
- [ ] 点击"上一页"、"下一页"按钮
- [ ] 点击页码，应该跳转到对应页面

#### 4.3.5 论文详情测试
- [ ] 点击论文行的"查看"按钮（眼睛图标）
- [ ] 应该弹出模态框显示论文详情
- [ ] 详情包括：ID、标题、作者、发布日期、类别、引用数、摘要、PDF链接、代码链接等
- [ ] 点击模态框外部或关闭按钮，模态框应该关闭

#### 4.3.6 编辑功能测试
- [ ] 点击论文行的"编辑"按钮（铅笔图标）
- [ ] 应该弹出编辑模态框
- [ ] 修改标题、类别、代码链接
- [ ] 点击"保存"按钮
- [ ] 应该显示成功提示，列表应该更新

#### 4.3.7 删除功能测试
- [ ] 点击论文行的"删除"按钮（垃圾桶图标）
- [ ] 应该弹出确认对话框
- [ ] 点击"确定"，论文应该被删除
- [ ] 列表应该更新，删除的论文不再显示

#### 4.3.8 复选框功能测试
- [ ] 点击表格第一行的全选复选框
- [ ] 所有论文的复选框应该被选中
- [ ] 再次点击，应该取消全选
- [ ] 点击单个论文的复选框，应该选中/取消选中该论文

---

## 五、视频管理页面测试

### 5.1 访问地址
```
http://localhost:5001/admin/bilibili
```

### 5.2 测试项目

#### 5.2.1 页面加载测试
- [ ] 页面能正常加载
- [ ] 侧边栏显示"视频管理"为激活状态
- [ ] 默认显示"UP主列表"Tab
- [ ] 统计卡片显示数据（总UP主数、总视频数、总播放量、今日新增）

#### 5.2.2 Tab切换测试
- [ ] 点击"UP主列表"Tab，应该显示UP主列表
- [ ] 点击"视频列表"Tab，应该显示视频列表
- [ ] Tab按钮应该有激活状态（高亮显示）

#### 5.2.3 UP主列表测试
- [ ] UP主列表正常显示（UID、名称、粉丝数、视频数、总播放量、最后更新）
- [ ] 在搜索框输入UP主名称，点击"搜索"
- [ ] 列表应该只显示匹配的UP主
- [ ] 点击"查看"按钮，应该显示UP主详情
- [ ] 分页功能正常

#### 5.2.4 视频列表测试
- [ ] 切换到"视频列表"Tab
- [ ] 视频列表正常显示（BV号、标题、UP主、发布时间、播放量、评论数、收藏数）
- [ ] UP主筛选下拉框应该显示所有UP主
- [ ] 选择UP主，列表应该只显示该UP主的视频
- [ ] 选择日期范围，列表应该只显示该日期范围内的视频
- [ ] 输入最小播放量，列表应该只显示播放量>=该值的视频
- [ ] 点击"查看"按钮，应该显示视频详情
- [ ] 分页功能正常

#### 5.2.5 搜索和筛选测试
- [ ] 在搜索框输入关键词，点击"搜索"
- [ ] 列表应该只显示匹配的结果
- [ ] 点击"重置"按钮，所有筛选条件应该清空

---

## 六、常见问题排查

### 6.1 页面无法访问
**现象**: 浏览器显示"无法连接"

**解决方案**:
```bash
# 检查Flask应用是否运行
lsof -ti:5001

# 如果没有运行，启动应用
python3 app.py
```

### 6.2 页面404错误
**现象**: 页面显示"404 Not Found"

**解决方案**:
- 检查templates文件夹是否存在
- 检查HTML文件是否存在
- 查看app.py中的路由配置

### 6.3 API调用失败
**现象**: 浏览器控制台显示API错误

**解决方案**:
- 检查Token是否有效
- 查看app.log日志
- 确认数据库是否初始化

### 6.4 图表不显示
**现象**: Chart.js图表不渲染

**解决方案**:
- 检查Chart.js CDN是否加载
- 查看浏览器控制台错误
- 确认API数据是否返回

### 6.5 数据不显示
**现象**: 页面加载但数据为空

**解决方案**:
- 检查数据库中是否有数据
- 检查API端点是否正常（打开浏览器开发者工具，查看Network标签）
- 检查后端日志是否有错误信息

### 6.6 API返回401错误
**原因**: 未登录或token过期

**解决**: 重新登录

### 6.7 API返回500错误
**解决方案**:
- 检查后端日志查看具体错误
- 检查数据库连接是否正常
- 检查模型导入是否正确

### 6.8 模态框不显示
**解决方案**:
- 检查浏览器控制台是否有JavaScript错误
- 检查CSS样式是否正确加载

---

## 七、测试检查清单

### 7.1 详细验证项

#### 页面渲染
- [ ] HTML结构完整
- [ ] CSS样式加载正常
- [ ] JavaScript加载正常
- [ ] 无404错误（检查浏览器控制台）

#### 交互功能
- [ ] 按钮可点击
- [ ] 表单可提交
- [ ] 模态框可打开/关闭
- [ ] Tab切换正常
- [ ] 分页功能正常

#### 数据展示
- [ ] API数据正确获取
- [ ] 数据渲染正确
- [ ] 图表显示正常
- [ ] 统计数字准确

#### 权限控制
- [ ] 未登录无法访问管理页面
- [ ] Token过期自动跳转登录
- [ ] 普通用户无法访问管理端
- [ ] 超级管理员有完整权限

### 7.2 功能测试清单

#### 管理端
- [ ] 登录页面正常显示和登录成功
- [ ] 管理仪表盘正常显示统计数据
- [ ] 用户管理页面正常渲染
- [ ] 日志监控页面正常显示
- [ ] 退出登录功能正常

#### 论文管理页面
- [ ] 页面加载正常
- [ ] 统计信息显示正确
- [ ] 列表显示正常
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 分页功能正常
- [ ] 详情查看正常
- [ ] 编辑功能正常
- [ ] 删除功能正常
- [ ] 复选框功能正常

#### 视频管理页面
- [ ] 页面加载正常
- [ ] Tab切换正常
- [ ] UP主列表显示正常
- [ ] 视频列表显示正常
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 分页功能正常
- [ ] 详情查看正常

### 7.3 性能标准
- 页面加载时间 < 2秒
- API响应时间 < 500ms
- 无JavaScript错误
- 无CSS样式错乱

### 7.4 浏览器兼容性测试
- [ ] Chrome/Edge（推荐）
- [ ] Firefox
- [ ] Safari

### 7.5 移动端测试（可选）
- [ ] 在移动设备上访问页面
- [ ] 检查响应式布局是否正常

---

## 八、测试数据参考

### 8.1 初始状态数据
- **总用户数**: 0（不含管理员）
- **管理员数**: 1（limx）
- **登录历史**: 1条（limx的登录记录）
- **访问日志**: 测试访问产生的记录

### 8.2 测试账号
```
管理员账号:
  用户名: limx
  密码: limx123456
  角色: 超级管理员
  权限: 全部权限
```

### 8.3 测试数据准备

#### 论文数据
- 确保数据库中有论文数据
- 可以通过访问 `/api/papers` 检查

#### 视频数据
- 确保数据库中有UP主和视频数据
- 可以通过访问 `/api/bilibili/all` 检查

---

## 九、快速测试命令

### 9.1 启动和访问
```bash
# 1. 启动Flask应用（如果未运行）
cd "/Users/dong/Documents/Cursor/Embodied Pulse"
python3 app.py

# 2. 在新终端窗口，打开浏览器测试
open http://localhost:5001/admin/login
open http://localhost:5001/admin/dashboard
open http://localhost:5001/admin/users
open http://localhost:5001/admin/logs
open http://localhost:5001/login
open http://localhost:5001/profile

# 3. 查看应用日志
tail -f app.log

# 4. 停止应用
lsof -ti:5001 | xargs kill -9
```

### 9.2 检查API端点
```bash
# 检查论文统计API（需要先登录获取token）
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:5001/api/admin/papers/stats

# 检查视频统计API
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:5001/api/admin/bilibili/stats
```

### 9.3 检查数据库
```bash
# 检查论文数量
python3 -c "from models import get_session, Paper; s = get_session(); print(s.query(Paper).count()); s.close()"

# 检查UP主数量
python3 -c "from bilibili_models import get_bilibili_session, BilibiliUp; s = get_bilibili_session(); print(s.query(BilibiliUp).count()); s.close()"
```

---

## 十、测试报告模板

测试完成后，请记录以下信息：

### 管理登录页面
- [ ] 页面渲染: 正常/异常
- [ ] 登录功能: 成功/失败
- [ ] 错误提示: 正常/异常

### 管理仪表盘
- [ ] 页面布局: 正常/异常
- [ ] 统计卡片: 正常/异常
- [ ] 图表显示: 正常/异常

### 用户管理
- [ ] 列表显示: 正常/异常
- [ ] 搜索筛选: 正常/异常
- [ ] 详情/编辑: 正常/异常

### 日志监控
- [ ] Tab切换: 正常/异常
- [ ] 日志列表: 正常/异常
- [ ] 筛选功能: 正常/异常

### 论文管理
- [ ] 页面加载: 正常/异常
- [ ] 搜索筛选: 正常/异常
- [ ] 编辑删除: 正常/异常

### 视频管理
- [ ] 页面加载: 正常/异常
- [ ] Tab切换: 正常/异常
- [ ] 搜索筛选: 正常/异常

### 问题记录
- 问题1: [描述]
- 问题2: [描述]

---

## 十一、注意事项

1. **权限要求**：只有管理员账号才能访问管理页面
2. **数据安全**：删除操作不可恢复，请谨慎测试
3. **性能考虑**：大数据量时，分页和筛选可能需要一些时间
4. **浏览器缓存**：如果页面没有更新，尝试清除浏览器缓存或使用无痕模式
5. **测试环境**：建议在测试环境进行完整测试，避免影响生产数据

---

## 十二、验收标准

### 12.1 管理端（必须）
- ✅ 登录页面正常显示和登录成功
- ✅ 管理仪表盘正常显示统计数据
- ✅ 用户管理页面正常渲染
- ✅ 日志监控页面正常显示
- ✅ 退出登录功能正常

### 12.2 用户端（可选）
- 🔄 登录页面正常显示
- 🔄 飞书OAuth流程正常（需配置）
- 🔄 个人中心正常显示（需登录）

### 12.3 性能标准
- 页面加载时间 < 2秒
- API响应时间 < 500ms
- 无JavaScript错误
- 无CSS样式错乱

---

**测试完成时间**: 2025-12-16 13:04  
**状态**: ✅ 应用已启动，基本功能正常，待验证定时任务和日期过滤

**祝测试顺利！** 🎉

如有问题，请查看 `app.log` 日志文件或测试报告。

