# 免费自动部署平台方案

**创建时间**：2025年12月10日  
**项目名称**：Robotics ArXiv Daily (Embodied Pulse)  
**版本**：v1.2.2

---

## 📋 目录

1. [平台对比](#平台对比)
2. [推荐方案：Railway（最推荐）](#推荐方案railway最推荐)
3. [备选方案：Render](#备选方案render)
4. [备选方案：Fly.io](#备选方案flyio)
5. [其他平台参考](#其他平台参考)
6. [部署步骤详解](#部署步骤详解)
7. [注意事项和限制](#注意事项和限制)
8. [迁移指南](#迁移指南)

---

## 🎯 平台对比

### 适合本项目的免费平台

| 平台 | 免费额度 | Docker支持 | 数据库 | 自动部署 | 推荐度 |
|------|---------|-----------|--------|---------|--------|
| **Railway** | $5/月免费额度 | ✅ | ✅ 内置PostgreSQL | ✅ | ⭐⭐⭐⭐⭐ |
| **Render** | 免费计划（有限制） | ✅ | ✅ 内置PostgreSQL | ✅ | ⭐⭐⭐⭐ |
| **Fly.io** | 3个共享CPU实例 | ✅ | ⚠️ 需单独配置 | ✅ | ⭐⭐⭐ |
| **Vercel** | 免费（Serverless） | ⚠️ 仅Serverless | ❌ | ✅ | ⭐⭐ |
| **Netlify** | 免费（静态） | ❌ | ❌ | ✅ | ⭐ |

### 推荐排序

1. **Railway** - 最适合，免费额度充足，功能完整
2. **Render** - 备选，免费计划有限制但可用
3. **Fly.io** - 备选，需要更多配置

---

## 🚂 推荐方案：Railway（最推荐）

### 为什么选择Railway？

✅ **优点**：
- **免费额度充足**：每月$5免费额度（约35元人民币）
- **Docker支持**：完美支持Docker部署
- **内置数据库**：免费PostgreSQL数据库
- **自动部署**：连接GitHub，自动部署
- **简单易用**：界面友好，配置简单
- **无信用卡要求**：免费额度无需绑定信用卡

⚠️ **限制**：
- 免费额度用完后需要付费
- 休眠机制：不活跃时会休眠（首次访问会唤醒）

### Railway免费额度

- **$5/月免费额度**
- 足够运行一个小型Flask应用
- 包含：计算资源、数据库、网络流量

### 部署步骤

#### 1. 准备工作

**修改项目以适配Railway：**

**A. 创建`railway.json`配置文件（可选）：**
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "startCommand": "gunicorn -c gunicorn_config.py app:app",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

**B. 修改`gunicorn_config.py`以支持环境变量端口：**
```python
# gunicorn_config.py
import os

# 从环境变量获取端口，Railway会自动设置PORT环境变量
port = os.getenv('PORT', '5001')
bind = f"0.0.0.0:{port}"  # 改为0.0.0.0以监听所有接口
```

**C. 修改数据库配置以支持PostgreSQL（可选，也可以继续用SQLite）：**

**方式1：继续使用SQLite（简单）**
- 无需修改，Railway支持SQLite文件存储

**方式2：使用Railway的PostgreSQL（推荐，更稳定）**
```python
# models.py 或 app.py
import os

# 从环境变量获取数据库URL
DATABASE_URL = os.getenv('DATABASE_URL', 'sqlite:///./papers.db')

# 如果是PostgreSQL URL，使用PostgreSQL
# 如果是SQLite URL，使用SQLite
if DATABASE_URL.startswith('postgresql://'):
    # PostgreSQL配置
    engine = create_engine(DATABASE_URL)
else:
    # SQLite配置（原有逻辑）
    engine = create_engine(DATABASE_URL)
```

#### 2. 在Railway上创建项目

1. **访问Railway**：https://railway.app
2. **注册账号**：使用GitHub账号登录（推荐）
3. **创建新项目**：点击"New Project"
4. **选择"Deploy from GitHub repo"**
5. **授权GitHub**：允许Railway访问你的仓库
6. **选择仓库**：选择`robotics-arxiv-daily`仓库
7. **选择分支**：选择`main`分支

#### 3. 配置环境变量

在Railway项目设置中添加环境变量：

```
DATABASE_URL=sqlite:///./papers.db  # 如果使用SQLite
# 或使用Railway提供的DATABASE_URL（如果使用PostgreSQL）

FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
AUTO_FETCH_MAX_RESULTS=100
LOG_LEVEL=info
PORT=5001  # Railway会自动设置，但可以显式指定
```

#### 4. 配置数据库（如果使用PostgreSQL）

1. 在Railway项目中点击"New" → "Database" → "Add PostgreSQL"
2. Railway会自动创建PostgreSQL数据库
3. 自动设置`DATABASE_URL`环境变量
4. 运行数据库迁移：
   ```bash
   # 在Railway的终端中执行
   python3 init_database.py
   ```

#### 5. 部署

Railway会自动：
1. 检测到Dockerfile
2. 构建Docker镜像
3. 部署应用
4. 分配域名（如：`your-app.up.railway.app`）

#### 6. 配置自定义域名（可选）

1. 在Railway项目设置中点击"Settings" → "Domains"
2. 添加你的域名
3. 配置DNS记录（Railway会提供说明）

#### 7. 自动部署配置

Railway默认已启用自动部署：
- 每次推送到`main`分支，自动触发部署
- 可以在项目设置中配置部署规则

---

## 🎨 备选方案：Render

### Render免费计划

✅ **优点**：
- 完全免费（有限制）
- Docker支持
- 自动部署
- 内置PostgreSQL

⚠️ **限制**：
- **休眠机制**：15分钟不活跃会休眠
- **唤醒慢**：休眠后首次访问需要30-60秒唤醒
- **资源限制**：CPU和内存有限

### 部署步骤

#### 1. 准备工作

**修改`gunicorn_config.py`：**
```python
import os

port = os.getenv('PORT', '5001')
bind = f"0.0.0.0:{port}"
```

#### 2. 在Render上创建服务

1. **访问Render**：https://render.com
2. **注册账号**：使用GitHub账号登录
3. **创建新Web Service**：
   - 点击"New" → "Web Service"
   - 连接GitHub仓库
   - 选择仓库和分支

#### 3. 配置服务

- **Name**：`robotics-arxiv-daily`
- **Environment**：`Docker`
- **Region**：选择离你最近的区域
- **Branch**：`main`
- **Root Directory**：`./`（项目根目录）

#### 4. 环境变量

在Render的Environment Variables中添加：
```
DATABASE_URL=sqlite:///./papers.db
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
LOG_LEVEL=info
```

#### 5. 配置数据库（可选）

1. 创建PostgreSQL数据库：
   - 点击"New" → "PostgreSQL"
2. 在Web Service中连接数据库：
   - 使用自动生成的`DATABASE_URL`环境变量

#### 6. 部署

Render会自动构建和部署，分配域名如：`your-app.onrender.com`

---

## ✈️ 备选方案：Fly.io

### Fly.io免费额度

✅ **优点**：
- 3个共享CPU实例免费
- 全球边缘部署
- Docker支持完善
- 性能好

⚠️ **限制**：
- 需要信用卡验证（但不会扣费）
- 配置相对复杂
- 数据库需要单独配置

### 部署步骤

#### 1. 安装Fly CLI

```bash
# macOS
curl -L https://fly.io/install.sh | sh

# 或使用Homebrew
brew install flyctl
```

#### 2. 登录Fly.io

```bash
fly auth login
```

#### 3. 初始化项目

```bash
cd /path/to/robotics-arxiv-daily
fly launch
```

#### 4. 配置`fly.toml`

```toml
app = "robotics-arxiv-daily"
primary_region = "iad"  # 选择区域

[build]
  dockerfile = "Dockerfile"

[env]
  FLASK_ENV = "production"
  AUTO_FETCH_ENABLED = "true"
  AUTO_FETCH_SCHEDULE = "0 2 * * *"

[[services]]
  internal_port = 5001
  protocol = "tcp"

  [[services.ports]]
    handlers = ["http"]
    port = 80

  [[services.ports]]
    handlers = ["tls", "http"]
    port = 443
```

#### 5. 部署

```bash
fly deploy
```

---

## 📚 其他平台参考

### Vercel / Netlify

**不推荐用于本项目**，原因：
- 主要针对静态网站和Serverless函数
- 不支持长时间运行的后端服务
- 数据库支持有限

### Heroku

**已取消免费计划**，不再推荐。

---

## 🔧 部署步骤详解（以Railway为例）

### 完整部署流程

#### 步骤1：准备代码

```bash
# 1. 确保代码已提交到GitHub
git add .
git commit -m "准备部署到Railway"
git push origin main

# 2. 修改gunicorn_config.py以支持Railway
# （见上方配置）
```

#### 步骤2：在Railway上创建项目

1. 访问 https://railway.app
2. 使用GitHub登录
3. 点击"New Project" → "Deploy from GitHub repo"
4. 选择仓库和分支

#### 步骤3：配置环境变量

在Railway项目设置中添加：
```
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
AUTO_FETCH_MAX_RESULTS=100
LOG_LEVEL=info
```

#### 步骤4：等待部署完成

Railway会自动：
- 构建Docker镜像
- 部署应用
- 分配域名

#### 步骤5：验证部署

访问Railway提供的域名，确认网站正常。

#### 步骤6：配置自动部署

Railway默认已启用：
- 每次推送到`main`分支自动部署
- 可以在设置中配置部署规则

---

## ⚠️ 注意事项和限制

### Railway注意事项

1. **免费额度**：
   - 每月$5免费额度
   - 超出后需要付费
   - 建议监控使用情况

2. **休眠机制**：
   - 不活跃时会休眠
   - 首次访问需要几秒唤醒
   - 可以配置Keep-Alive避免休眠

3. **数据库**：
   - SQLite文件存储在临时存储中
   - 建议使用PostgreSQL（更稳定）
   - 定期备份数据

### Render注意事项

1. **休眠问题**：
   - 15分钟不活跃会休眠
   - 首次访问需要30-60秒唤醒
   - 不适合需要实时响应的应用

2. **资源限制**：
   - CPU和内存有限
   - 不适合高并发场景

### 通用注意事项

1. **环境变量**：
   - 敏感信息不要提交到代码
   - 使用平台的环境变量功能

2. **日志**：
   - 使用平台提供的日志查看功能
   - 定期检查错误日志

3. **备份**：
   - 定期备份数据库
   - 使用平台提供的备份功能或手动备份

4. **监控**：
   - 监控应用状态
   - 设置告警（如果平台支持）

---

## 🔄 迁移指南

### 从本地/服务器迁移到Railway

#### 1. 备份数据

```bash
# 备份数据库
cp papers.db papers.db.backup

# 备份配置文件
cp config.yaml config.yaml.backup
```

#### 2. 准备代码

```bash
# 确保代码已提交到GitHub
git push origin main
```

#### 3. 在Railway上部署

按照上述步骤在Railway上创建项目。

#### 4. 迁移数据（如果使用PostgreSQL）

```bash
# 在Railway的终端中执行
# 1. 导出SQLite数据
sqlite3 papers.db .dump > data.sql

# 2. 导入到PostgreSQL（需要修改SQL语法）
# 或使用数据迁移脚本
python3 migrate_to_postgresql.py
```

#### 5. 更新DNS（如果使用自定义域名）

1. 在Railway上配置域名
2. 更新DNS记录指向Railway

#### 6. 验证迁移

1. 访问新域名，确认功能正常
2. 检查数据是否完整
3. 测试所有功能

---

## 📊 平台选择建议

### 根据需求选择

| 需求 | 推荐平台 |
|------|---------|
| **最佳体验** | Railway |
| **完全免费** | Render（接受休眠） |
| **高性能** | Fly.io |
| **简单易用** | Railway |
| **全球部署** | Fly.io |

### 推荐方案

**首选：Railway**
- 免费额度充足
- 功能完整
- 使用简单
- 自动部署

**备选：Render**
- 完全免费
- 功能完整
- 但会休眠

---

## 🔗 快速链接

- **Railway**：https://railway.app
- **Render**：https://render.com
- **Fly.io**：https://fly.io

---

## 📝 更新记录

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|---------|--------|
| 2025-12-10 | v1.0 | 初始版本 | AI开发助手 |

---

**最后更新**：2025年12月10日  
**维护者**：开发团队
