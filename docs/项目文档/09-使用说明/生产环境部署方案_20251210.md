# 生产环境部署方案

**创建时间**：2025年12月10日  
**项目名称**：Robotics ArXiv Daily (Embodied Pulse)  
**版本**：v1.2.2

---

## 📋 目录

1. [项目概述](#项目概述)
2. [部署方式选择](#部署方式选择)
3. [服务器要求](#服务器要求)
4. [部署方案A：Docker容器部署（推荐）](#部署方案a-docker容器部署推荐)
5. [部署方案B：直接部署](#部署方案b-直接部署)
6. [部署方案C：免费自动部署平台](#部署方案c免费自动部署平台) ⭐ **推荐新手**
7. [环境配置](#环境配置)
8. [数据库配置](#数据库配置)
9. [域名和端口配置](#域名和端口配置)
10. [监控和日志](#监控和日志)
11. [备份策略](#备份策略)
12. [代码更新流程（开发者指南）](#代码更新流程开发者指南) ⭐ **重点阅读**
13. [运维协作流程](#运维协作流程)
14. [故障排查](#故障排查)
15. [附录](#附录)

> 💡 **快速开始**：如果你没有自己的服务器，推荐使用[免费自动部署平台](#部署方案c免费自动部署平台)（Railway、Render等），详见[免费自动部署平台方案文档](../09-使用说明/免费自动部署平台方案_20251210.md)

---

## 📖 项目概述

### 项目简介
- **项目名称**：Robotics ArXiv Daily (Embodied Pulse)
- **项目类型**：Flask Web应用 + 定时任务
- **主要功能**：
  - 每日抓取ArXiv论文数据
  - 展示具身智能领域论文、新闻、招聘、数据集
  - 提供Web界面和API接口
  - 定时自动更新数据

### 技术栈
- **后端**：Python 3.9+、Flask、SQLAlchemy、APScheduler
- **数据库**：SQLite（可升级为PostgreSQL/MySQL）
- **Web服务器**：Gunicorn
- **容器化**：Docker + Docker Compose
- **前端**：HTML/CSS/JavaScript（Chart.js）

---

## 🎯 部署方式选择

### 方案对比

| 特性 | Docker容器部署 | 直接部署 |
|------|--------------|---------|
| **部署复杂度** | ⭐⭐ 简单 | ⭐⭐⭐ 中等 |
| **环境隔离** | ✅ 完全隔离 | ❌ 依赖系统环境 |
| **可移植性** | ✅ 高 | ❌ 低 |
| **运维友好** | ✅ 容器管理简单 | ⚠️ 需要手动管理 |
| **资源占用** | ⚠️ 略高（容器开销） | ✅ 较低 |
| **推荐度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

### 推荐方案
**推荐使用Docker容器部署**，原因：
1. 环境一致性好，避免"在我机器上能跑"的问题
2. 运维管理简单，容器启停、更新方便
3. 易于扩展和迁移
4. 已有完整的Docker配置

---

## 💻 服务器要求

### 最低配置
- **CPU**：2核心
- **内存**：2GB
- **存储**：20GB（SSD推荐）
- **网络**：公网IP，带宽≥5Mbps
- **操作系统**：Linux（Ubuntu 20.04+ / CentOS 7+）

### 推荐配置
- **CPU**：4核心
- **内存**：4GB
- **存储**：50GB SSD
- **网络**：公网IP，带宽≥10Mbps
- **操作系统**：Ubuntu 22.04 LTS

### 软件要求
- **Docker**：20.10+（如果使用容器部署）
- **Docker Compose**：2.0+（如果使用容器部署）
- **Python**：3.9+（如果直接部署）
- **Nginx**：1.18+（反向代理，推荐）

---

## 🐳 部署方案A：Docker容器部署（推荐）

### 方案概述
运维提供Docker容器环境，开发者推送代码到Git仓库，运维通过CI/CD或手动部署。

### 协作流程

#### 1. 开发者准备
```bash
# 1. 确保代码已提交到Git仓库
git add .
git commit -m "准备部署"
git push origin main

# 2. 提供以下信息给运维：
# - Git仓库地址
# - 分支名称（通常是main）
# - 项目根目录路径
# - 需要的环境变量（见下方"环境配置"章节）
```

#### 2. 运维操作

**方式A：使用Docker Compose（推荐）**

```bash
# 1. 在服务器上克隆项目
git clone <git-repo-url> /opt/robotics-arxiv-daily
cd /opt/robotics-arxiv-daily

# 2. 配置环境变量（创建.env文件）
cat > .env << EOF
DATABASE_URL=sqlite:///./papers.db
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
AUTO_FETCH_MAX_RESULTS=100
FLASK_ENV=production
LOG_LEVEL=info
EOF

# 3. 启动服务
docker-compose up -d

# 4. 查看日志
docker-compose logs -f web

# 5. 检查服务状态
docker-compose ps
```

**方式B：使用Docker镜像（适合CI/CD）**

```bash
# 1. 构建镜像
docker build -t robotics-arxiv-daily:latest .

# 2. 运行容器
docker run -d \
  --name robotics-arxiv-web \
  -p 5001:5001 \
  -v $(pwd)/papers.db:/app/papers.db \
  -v $(pwd)/docs:/app/docs \
  -v $(pwd)/config.yaml:/app/config.yaml \
  -e DATABASE_URL=sqlite:///./papers.db \
  -e AUTO_FETCH_ENABLED=true \
  -e AUTO_FETCH_SCHEDULE="0 2 * * *" \
  -e FLASK_ENV=production \
  --restart always \
  robotics-arxiv-daily:latest

# 3. 查看日志
docker logs -f robotics-arxiv-web
```

### 更新流程

**开发者推送新代码后：**

```bash
# 运维在服务器上执行
cd /opt/robotics-arxiv-daily
git pull origin main
docker-compose build  # 重新构建镜像
docker-compose up -d  # 重启服务
```

### 数据持久化

确保以下目录/文件挂载到宿主机：
- `./papers.db` - 数据库文件
- `./docs/` - 文档目录
- `./config.yaml` - 配置文件

---

## 🖥️ 部署方案B：直接部署

### 方案概述
直接在服务器上安装Python环境，运行应用。

### 部署步骤

```bash
# 1. 克隆项目
git clone <git-repo-url> /opt/robotics-arxiv-daily
cd /opt/robotics-arxiv-daily

# 2. 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 3. 安装依赖
pip install --upgrade pip
pip install -r requirements.txt

# 4. 初始化数据库
python3 init_database.py

# 5. 配置环境变量（见下方"环境配置"章节）
export DATABASE_URL=sqlite:///./papers.db
export FLASK_ENV=production

# 6. 使用systemd管理服务
sudo tee /etc/systemd/system/robotics-arxiv.service > /dev/null << EOF
[Unit]
Description=Robotics ArXiv Daily Web Service
After=network.target

[Service]
Type=notify
User=www-data
WorkingDirectory=/opt/robotics-arxiv-daily
Environment="PATH=/opt/robotics-arxiv-daily/venv/bin"
Environment="DATABASE_URL=sqlite:///./papers.db"
Environment="FLASK_ENV=production"
Environment="AUTO_FETCH_ENABLED=true"
Environment="AUTO_FETCH_SCHEDULE=0 2 * * *"
ExecStart=/opt/robotics-arxiv-daily/venv/bin/gunicorn -c gunicorn_config.py app:app
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# 7. 启动服务
sudo systemctl daemon-reload
sudo systemctl enable robotics-arxiv
sudo systemctl start robotics-arxiv

# 8. 查看状态
sudo systemctl status robotics-arxiv
```

### 更新流程

```bash
cd /opt/robotics-arxiv-daily
git pull origin main
source venv/bin/activate
pip install -r requirements.txt  # 如果有新依赖
sudo systemctl restart robotics-arxiv
```

---

## 🚀 部署方案C：免费自动部署平台

### 概述

如果你**没有自己的服务器**或**不想管理服务器**，可以使用免费的自动部署平台。这些平台提供：
- ✅ 免费额度或免费计划
- ✅ 自动部署（连接GitHub自动部署）
- ✅ 内置数据库
- ✅ 无需运维管理

### 推荐平台

1. **Railway**（最推荐）
   - 每月$5免费额度
   - 功能完整，使用简单
   - 支持Docker和自动部署

2. **Render**
   - 完全免费（会休眠）
   - 功能完整
   - 适合小型项目

3. **Fly.io**
   - 3个免费实例
   - 性能好，全球部署

### 详细文档

**完整的免费平台部署指南**：请参考 [免费自动部署平台方案文档](./免费自动部署平台方案_20251210.md)

该文档包含：
- 平台对比和选择建议
- 详细的部署步骤
- 配置说明
- 注意事项和限制

### 快速开始（Railway示例）

1. **访问Railway**：https://railway.app
2. **使用GitHub登录**
3. **创建新项目** → "Deploy from GitHub repo"
4. **选择你的仓库**
5. **等待自动部署完成**

就这么简单！每次推送代码到GitHub，Railway会自动部署。

---

## ⚙️ 环境配置

### 必需的环境变量

| 变量名 | 说明 | 默认值 | 示例 |
|--------|------|--------|------|
| `DATABASE_URL` | 数据库连接URL | `sqlite:///./papers.db` | `sqlite:///./papers.db` |
| `FLASK_ENV` | Flask环境 | `production` | `production` |
| `LOG_LEVEL` | 日志级别 | `info` | `info` / `debug` |

### 可选的环境变量

| 变量名 | 说明 | 默认值 | 示例 |
|--------|------|--------|------|
| `AUTO_FETCH_ENABLED` | 是否启用自动抓取 | `false` | `true` / `false` |
| `AUTO_FETCH_SCHEDULE` | 自动抓取时间（Cron格式） | `0 2 * * *` | `0 2 * * *`（每天凌晨2点） |
| `AUTO_FETCH_MAX_RESULTS` | 每次抓取最大论文数 | `10` | `100` |

### 环境变量配置方式

**Docker Compose方式：**
```yaml
# docker-compose.yml
environment:
  - DATABASE_URL=sqlite:///./papers.db
  - FLASK_ENV=production
  - AUTO_FETCH_ENABLED=true
```

**或使用.env文件：**
```bash
# .env
DATABASE_URL=sqlite:///./papers.db
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
```

---

## 🗄️ 数据库配置

### 当前配置（SQLite）

**优点**：
- 无需额外安装数据库服务
- 配置简单，适合中小型应用
- 数据文件易于备份

**缺点**：
- 并发性能有限
- 不适合高并发场景

**配置方式：**
```bash
# 环境变量
DATABASE_URL=sqlite:///./papers.db

# 确保数据库文件有写权限
chmod 666 papers.db  # 或使用适当的用户权限
```

### 升级到PostgreSQL（可选，适合高并发）

**1. 修改requirements.txt：**
```txt
psycopg2-binary  # 添加PostgreSQL驱动
```

**2. 修改环境变量：**
```bash
DATABASE_URL=postgresql://user:password@localhost:5432/robotics_arxiv
```

**3. 修改models.py（如果需要）：**
```python
# 确保SQLAlchemy连接字符串正确
engine = create_engine(DATABASE_URL)
```

**4. 初始化数据库：**
```bash
python3 init_database.py
```

---

## 🌐 域名和端口配置

### 端口配置

**应用端口：**
- **内部端口**：5001（Flask应用监听）
- **外部端口**：由运维配置（建议80/443通过Nginx反向代理）

### Nginx反向代理配置（推荐）

**创建Nginx配置文件：**
```nginx
# /etc/nginx/sites-available/robotics-arxiv
server {
    listen 80;
    server_name your-domain.com;  # 替换为实际域名

    # 重定向到HTTPS（如果配置了SSL）
    # return 301 https://$server_name$request_uri;

    # 或者直接代理到HTTP（开发环境）
    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket支持（如果需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # 静态文件缓存
    location /static {
        alias /opt/robotics-arxiv-daily/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

**启用配置：**
```bash
sudo ln -s /etc/nginx/sites-available/robotics-arxiv /etc/nginx/sites-enabled/
sudo nginx -t  # 测试配置
sudo systemctl reload nginx
```

### SSL证书配置（HTTPS，推荐）

**使用Let's Encrypt：**
```bash
# 安装Certbot
sudo apt-get install certbot python3-certbot-nginx

# 获取证书
sudo certbot --nginx -d your-domain.com

# 自动续期（已自动配置）
```

---

## 📊 监控和日志

### 日志配置

**Gunicorn日志：**
- **访问日志**：输出到stdout（可通过Docker logs查看）
- **错误日志**：输出到stderr

**应用日志：**
- 位置：通过Python logging模块输出
- 级别：由`LOG_LEVEL`环境变量控制

**查看日志：**

**Docker方式：**
```bash
# 实时查看日志
docker-compose logs -f web

# 查看最近100行
docker-compose logs --tail=100 web
```

**直接部署方式：**
```bash
# systemd日志
sudo journalctl -u robotics-arxiv -f

# 查看最近100行
sudo journalctl -u robotics-arxiv -n 100
```

### 健康检查

**应用健康检查端点：**
```bash
# 检查服务状态
curl http://localhost:5001/api/stats

# 预期响应：{"success": true, ...}
```

**Docker健康检查：**
- 已在Dockerfile中配置
- 每30秒检查一次

### 监控建议

1. **服务可用性监控**：
   - 定期访问 `/api/stats` 端点
   - 设置告警（如5分钟内无响应）

2. **资源监控**：
   - CPU使用率
   - 内存使用率
   - 磁盘空间（特别是数据库文件）

3. **业务监控**：
   - 论文数量增长趋势
   - API响应时间
   - 错误率

---

## 💾 备份策略

### 数据备份

**需要备份的文件：**
1. **数据库文件**：`papers.db`（最重要）
2. **配置文件**：`config.yaml`
3. **文档目录**：`docs/`（可选）

**备份脚本示例：**
```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/backup/robotics-arxiv"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# 备份数据库
cp /opt/robotics-arxiv-daily/papers.db $BACKUP_DIR/papers_${DATE}.db

# 备份配置文件
cp /opt/robotics-arxiv-daily/config.yaml $BACKUP_DIR/config_${DATE}.yaml

# 压缩备份
tar -czf $BACKUP_DIR/backup_${DATE}.tar.gz \
  $BACKUP_DIR/papers_${DATE}.db \
  $BACKUP_DIR/config_${DATE}.yaml

# 删除7天前的备份
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete

echo "备份完成: $BACKUP_DIR/backup_${DATE}.tar.gz"
```

**设置定时备份（Cron）：**
```bash
# 每天凌晨3点备份
0 3 * * * /opt/robotics-arxiv-daily/backup.sh >> /var/log/robotics-arxiv-backup.log 2>&1
```

### 恢复数据

```bash
# 停止服务
docker-compose stop web  # 或 systemctl stop robotics-arxiv

# 恢复数据库
cp /backup/robotics-arxiv/papers_YYYYMMDD_HHMMSS.db /opt/robotics-arxiv-daily/papers.db

# 重启服务
docker-compose start web  # 或 systemctl start robotics-arxiv
```

---

## 🔄 代码更新流程（开发者指南）

### 概述

本文档详细说明开发者如何更新代码并部署到生产环境。根据团队规模和运维配置，可以选择不同的更新方式。

---

### 方式A：手动更新流程（适合小团队）

#### 1. 本地开发和测试

```bash
# 1. 在本地开发环境进行开发
git checkout -b feature/your-feature-name  # 创建功能分支
# ... 进行代码修改 ...

# 2. 本地测试
python3 app.py  # 或使用你的本地测试方式
# 确保功能正常，无错误

# 3. 提交代码
git add .
git commit -m "feat: 添加新功能描述"
git push origin feature/your-feature-name

# 4. 创建Pull Request（如果使用GitHub/GitLab）
# 在GitHub/GitLab上创建PR，进行代码审查
```

#### 2. 合并到主分支

```bash
# 1. 代码审查通过后，合并到main分支
# （通常在GitHub/GitLab上通过Web界面操作）

# 2. 本地同步main分支
git checkout main
git pull origin main
```

#### 3. 通知运维更新

**方式1：直接通知运维**
```
运维你好，代码已更新到main分支，请更新生产环境。

更新内容：
- 修复了XXX问题
- 添加了XXX功能

Git提交：<commit-hash>
```

**方式2：运维定期检查**
- 运维可以设置定时任务，定期检查并更新

#### 4. 运维执行更新（运维操作）

```bash
# 1. 进入项目目录
cd /opt/robotics-arxiv-daily

# 2. 备份当前版本（可选，但推荐）
cp -r . ../robotics-arxiv-daily-backup-$(date +%Y%m%d)

# 3. 拉取最新代码
git fetch origin
git pull origin main

# 4. 检查是否有新依赖
# 查看requirements.txt是否有变化
git diff HEAD~1 requirements.txt

# 5. 更新Docker容器（Docker Compose方式）
docker-compose build  # 重新构建镜像
docker-compose up -d  # 重启服务

# 或直接部署方式
source venv/bin/activate
pip install -r requirements.txt  # 如果有新依赖
sudo systemctl restart robotics-arxiv

# 6. 查看日志，确认服务正常
docker-compose logs -f web
# 或
sudo journalctl -u robotics-arxiv -f

# 7. 验证服务
curl http://localhost:5001/api/stats
```

#### 5. 验证更新成功

```bash
# 1. 检查服务状态
docker-compose ps
# 或
sudo systemctl status robotics-arxiv

# 2. 访问网站，确认功能正常
# 在浏览器中访问网站，测试新功能

# 3. 检查API接口
curl http://your-domain.com/api/stats

# 4. 查看日志，确认无错误
docker-compose logs --tail=50 web
```

---

### 方式B：CI/CD自动部署（推荐，适合大团队）

#### 1. 配置CI/CD

**GitHub Actions示例：**

创建 `.github/workflows/deploy.yml`：

```yaml
name: Deploy to Production

on:
  push:
    branches: [main]  # 只有main分支的推送才触发部署

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            cd /opt/robotics-arxiv-daily
            git pull origin main
            docker-compose build
            docker-compose up -d
            docker-compose logs --tail=20 web
```

**配置Secrets（在GitHub仓库设置中）：**
- `HOST`: 服务器IP或域名
- `USERNAME`: SSH用户名
- `SSH_KEY`: SSH私钥

#### 2. 开发者工作流程

```bash
# 1. 开发功能
git checkout -b feature/new-feature
# ... 开发代码 ...

# 2. 提交和推送
git add .
git commit -m "feat: 新功能"
git push origin feature/new-feature

# 3. 创建Pull Request
# 在GitHub上创建PR，进行代码审查

# 4. 合并到main分支
# 合并后，CI/CD自动触发部署
# 无需手动通知运维！
```

#### 3. 自动部署流程

1. **代码合并** → 触发GitHub Actions
2. **构建阶段** → 检查代码、运行测试（如果有）
3. **部署阶段** → SSH连接到服务器，执行更新命令
4. **验证阶段** → 健康检查，确认服务正常

#### 4. 查看部署状态

- 在GitHub仓库的"Actions"标签页查看部署进度
- 如果部署失败，查看日志并修复问题

---

### 方式C：混合方式（推荐）

结合手动和自动部署的优点：

1. **开发环境**：手动部署，快速迭代
2. **测试环境**：CI/CD自动部署
3. **生产环境**：手动部署，需要审批

---

### 更新前检查清单

**开发者检查：**
- [ ] 代码已通过本地测试
- [ ] 代码已提交到Git仓库
- [ ] 已创建Pull Request（如果使用）
- [ ] 代码审查已通过
- [ ] 已合并到main分支

**运维检查（手动部署时）：**
- [ ] 已备份当前版本
- [ ] 已查看更新内容（git log）
- [ ] 已检查是否有数据库迁移（如果有）
- [ ] 已确认更新时机（避免高峰期）

---

### 更新后验证

**必须验证的项目：**
1. ✅ 服务正常启动（无错误日志）
2. ✅ 网站可正常访问
3. ✅ API接口正常响应
4. ✅ 新功能正常工作
5. ✅ 定时任务正常执行（如果涉及）
6. ✅ 数据库操作正常（如果涉及数据库变更）

**验证命令：**
```bash
# 1. 检查服务状态
docker-compose ps
# 或
sudo systemctl status robotics-arxiv

# 2. 检查健康状态
curl http://localhost:5001/api/stats

# 3. 查看日志
docker-compose logs --tail=100 web | grep -i error
# 或
sudo journalctl -u robotics-arxiv -n 100 | grep -i error

# 4. 检查资源使用
docker stats robotics-arxiv-web
```

---

### 回滚机制

如果更新后出现问题，需要快速回滚：

#### Docker Compose方式

```bash
# 1. 停止当前容器
docker-compose stop web

# 2. 回滚到上一个版本
cd /opt/robotics-arxiv-daily
git log --oneline  # 查看提交历史
git checkout <previous-commit-hash>  # 回滚到上一个提交

# 3. 重新构建和启动
docker-compose build
docker-compose up -d

# 4. 验证回滚成功
docker-compose logs -f web
```

#### 直接部署方式

```bash
# 1. 停止服务
sudo systemctl stop robotics-arxiv

# 2. 回滚代码
cd /opt/robotics-arxiv-daily
git log --oneline
git checkout <previous-commit-hash>

# 3. 重启服务
sudo systemctl start robotics-arxiv

# 4. 验证
sudo systemctl status robotics-arxiv
```

#### 使用备份恢复

```bash
# 如果之前有备份
cd /opt
rm -rf robotics-arxiv-daily
cp -r robotics-arxiv-daily-backup-YYYYMMDD robotics-arxiv-daily
cd robotics-arxiv-daily
docker-compose up -d
```

---

### 特殊更新场景

#### 1. 数据库结构变更

如果更新涉及数据库结构变更：

```bash
# 1. 备份数据库（重要！）
cp papers.db papers.db.backup-$(date +%Y%m%d)

# 2. 更新代码
git pull origin main

# 3. 运行数据库迁移脚本（如果有）
python3 migrate_xxx.py  # 替换为实际的迁移脚本

# 4. 重启服务
docker-compose restart web
```

#### 2. 配置文件变更

如果更新涉及`config.yaml`变更：

```bash
# 1. 备份配置文件
cp config.yaml config.yaml.backup

# 2. 更新代码
git pull origin main

# 3. 检查配置文件差异
git diff HEAD~1 config.yaml

# 4. 手动合并配置（如果需要）
# 保留生产环境的特殊配置

# 5. 重启服务
docker-compose restart web
```

#### 3. 依赖更新

如果`requirements.txt`有变更：

```bash
# Docker Compose方式（自动处理）
docker-compose build  # 会重新安装依赖

# 直接部署方式
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart robotics-arxiv
```

#### 4. 环境变量变更

如果更新需要新的环境变量：

```bash
# 1. 更新.env文件或docker-compose.yml
vim .env  # 添加新的环境变量

# 2. 重启服务
docker-compose down
docker-compose up -d
```

---

### 最佳实践

1. **小步快跑**：
   - 每次更新尽量小，便于回滚
   - 避免一次性大量变更

2. **测试先行**：
   - 本地充分测试
   - 有测试环境的话，先在测试环境部署

3. **文档同步**：
   - 重要更新更新文档
   - 记录更新内容和影响

4. **备份习惯**：
   - 重要更新前备份数据库
   - 保留最近几个版本的备份

5. **沟通及时**：
   - 重大更新提前通知
   - 更新后及时验证和反馈

6. **监控观察**：
   - 更新后观察日志
   - 关注错误率和性能指标

---

### 更新频率建议

- **功能更新**：按需，建议每周1-2次
- **Bug修复**：及时，发现问题立即修复
- **安全更新**：紧急，发现漏洞立即更新
- **依赖更新**：定期，建议每月检查一次

---

## 🤝 运维协作流程

### 首次部署流程

1. **开发者提供信息**：
   - Git仓库地址和分支
   - 环境变量配置清单
   - 域名和端口需求
   - 特殊配置要求

2. **运维准备环境**：
   - 准备服务器（满足最低配置要求）
   - 安装Docker和Docker Compose（如果使用容器部署）
   - 配置Nginx反向代理
   - 配置SSL证书（如果需要HTTPS）

3. **部署应用**：
   - 克隆代码仓库
   - 配置环境变量
   - 启动服务
   - 验证服务正常运行

4. **配置监控和备份**：
   - 设置日志收集
   - 配置健康检查
   - 设置定时备份

### 日常更新流程

> **详细更新流程请参考：[代码更新流程（开发者指南）](#代码更新流程开发者指南)章节**

**快速参考：**

**方式A：手动更新（适合小团队）**
1. 开发者推送代码到Git仓库
2. 通知运维
3. 运维执行更新命令

**方式B：CI/CD自动部署（推荐）**
1. 开发者推送代码到Git仓库
2. CI/CD自动触发部署
3. 无需手动操作

### 问题反馈流程

1. **发现问题**：
   - 用户反馈或监控告警
   - 记录问题现象和时间

2. **排查问题**：
   - 查看日志：`docker-compose logs -f web`
   - 检查服务状态：`docker-compose ps`
   - 检查资源使用：`docker stats`

3. **解决问题**：
   - 开发者修复问题
   - 推送代码
   - 运维更新部署

4. **验证修复**：
   - 确认问题已解决
   - 更新问题记录

---

## 🔧 故障排查

### 常见问题

#### 1. 服务无法启动

**检查步骤：**
```bash
# 查看日志
docker-compose logs web
# 或
sudo journalctl -u robotics-arxiv -n 50

# 检查端口占用
netstat -tlnp | grep 5001

# 检查数据库文件权限
ls -l papers.db
```

#### 2. 数据库连接失败

**检查步骤：**
```bash
# 检查数据库文件是否存在
ls -l papers.db

# 检查文件权限
chmod 666 papers.db  # 或使用适当的用户权限

# 检查环境变量
echo $DATABASE_URL
```

#### 3. 定时任务不执行

**检查步骤：**
```bash
# 检查环境变量
docker-compose exec web env | grep AUTO_FETCH

# 检查应用日志
docker-compose logs web | grep -i scheduler
```

#### 4. 性能问题

**检查步骤：**
```bash
# 查看容器资源使用
docker stats robotics-arxiv-web

# 查看Gunicorn worker数量
ps aux | grep gunicorn

# 检查数据库大小
ls -lh papers.db
```

### 紧急恢复

**如果服务完全崩溃：**

```bash
# 1. 停止服务
docker-compose stop web
# 或
sudo systemctl stop robotics-arxiv

# 2. 恢复备份
cp /backup/robotics-arxiv/papers_latest.db papers.db

# 3. 重启服务
docker-compose start web
# 或
sudo systemctl start robotics-arxiv

# 4. 验证服务
curl http://localhost:5001/api/stats
```

---

## 📎 附录

### A. 部署检查清单

**部署前：**
- [ ] 服务器配置满足要求
- [ ] Docker/Docker Compose已安装（容器部署）
- [ ] Python 3.9+已安装（直接部署）
- [ ] Git仓库可访问
- [ ] 域名DNS已配置
- [ ] SSL证书已配置（如果需要HTTPS）

**部署中：**
- [ ] 代码已克隆到服务器
- [ ] 环境变量已配置
- [ ] 数据库已初始化
- [ ] 服务已启动
- [ ] 健康检查通过

**部署后：**
- [ ] 网站可正常访问
- [ ] API接口正常
- [ ] 定时任务已配置
- [ ] 日志正常输出
- [ ] 备份已配置
- [ ] 监控已设置

### B. 联系信息模板

**给运维的信息清单：**

```
项目名称：Robotics ArXiv Daily (Embodied Pulse)
Git仓库：https://github.com/your-org/robotics-arxiv-daily
分支：main
部署方式：Docker Compose（推荐）

服务器要求：
- CPU: 2核心（推荐4核心）
- 内存: 2GB（推荐4GB）
- 存储: 20GB（推荐50GB）

端口需求：
- 内部端口：5001
- 外部端口：80/443（通过Nginx反向代理）

环境变量：
DATABASE_URL=sqlite:///./papers.db
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
LOG_LEVEL=info

域名：your-domain.com（请替换为实际域名）

特殊要求：
- 需要定时任务支持（每天凌晨2点自动抓取数据）
- 需要数据持久化（数据库文件需要备份）
```

### C. 快速部署命令（运维参考）

```bash
# 一键部署脚本（Docker Compose方式）
git clone <git-repo-url> /opt/robotics-arxiv-daily
cd /opt/robotics-arxiv-daily

cat > .env << EOF
DATABASE_URL=sqlite:///./papers.db
FLASK_ENV=production
AUTO_FETCH_ENABLED=true
AUTO_FETCH_SCHEDULE=0 2 * * *
LOG_LEVEL=info
EOF

docker-compose up -d
docker-compose logs -f web
```

---

## 📝 更新记录

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|---------|--------|
| 2025-12-10 | v1.0 | 初始版本 | AI开发助手 |

---

**最后更新**：2025年12月10日  
**维护者**：开发团队 + 运维团队  
**联系方式**：请根据实际情况填写
