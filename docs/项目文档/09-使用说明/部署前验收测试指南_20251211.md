# 部署前验收测试指南

**创建时间**：2025-12-11  
**目的**：每次部署前进行全局稳定性和可用性测试，确保系统正常运行

---

## 📋 概述

部署前验收测试文件夹位于项目根目录的 `tests/` 目录，包含以下测试：

1. **API端点测试** (`test_api_endpoints.py`) - 测试所有API端点的可用性
2. **数据库连接测试** (`test_database_connections.py`) - 测试所有数据库连接
3. **功能测试** (`test_functionality.py`) - 测试核心功能的业务逻辑
4. **集成测试** (`test_integration.py`) - 测试系统集成（待实现）
5. **性能测试** (`test_performance.py`) - 测试性能指标（待实现）

---

## 🚀 快速开始

### 1. 确保服务器运行

```bash
# 开发环境
python3 app.py

# 或生产环境
gunicorn -c gunicorn_config.py app:app
```

### 2. 运行所有测试

```bash
# 运行所有测试
python3 tests/run_all_tests.py
```

### 3. 运行特定测试

```bash
# 只测试API端点
python3 tests/test_api_endpoints.py

# 只测试数据库连接
python3 tests/test_database_connections.py

# 只测试功能
python3 tests/test_functionality.py
```

---

## 📝 测试详情

### 1. API端点测试

**测试内容**：
- 所有API端点的HTTP状态码
- API响应格式（JSON）
- 错误处理

**测试的API**：
- `/` - 首页
- `/api/papers` - 论文列表
- `/api/stats` - 统计数据
- `/api/search` - 搜索
- `/api/news` - 新闻列表
- `/api/jobs` - 岗位列表
- `/api/datasets` - 数据集列表
- `/api/bilibili` - Bilibili数据
- `/api/fetch-status` - 抓取状态
- `/api/fetch-news-status` - 新闻抓取状态
- `/api/refresh-status` - 刷新状态

### 2. 数据库连接测试

**测试内容**：
- 所有数据库的连接
- 数据库查询功能
- 数据完整性

**测试的数据库**：
- 主数据库（论文）
- 岗位数据库
- 数据集数据库
- 新闻数据库

### 3. 功能测试

**测试内容**：
- 论文功能
- 新闻功能
- 岗位功能
- 数据集功能
- Bilibili功能
- 统计功能

---

## ✅ 验收标准

### 必须通过的测试

- ✅ 所有API端点测试必须通过
- ✅ 所有数据库连接测试必须通过
- ✅ 所有功能测试必须通过

### 验收流程

1. **运行测试**
   ```bash
   python3 tests/run_all_tests.py
   ```

2. **检查结果**
   - 所有测试显示 ✅ 通过
   - 无 ❌ 失败项

3. **确认部署**
   - 所有测试通过后，可以部署
   - 如有失败，必须修复后再部署

---

## 📊 测试报告

测试结果会输出到控制台，包含：
- 每个测试的通过/失败状态
- 详细的错误信息（如有）
- 测试统计摘要

**示例输出**：
```
============================================================
开始API端点测试
============================================================

✅ 首页: GET / - 状态码 200
✅ 论文列表: GET /api/papers - 状态码 200
...

============================================================
测试结果统计
============================================================
✅ 首页: 通过
✅ 论文列表: 通过
...

总计: 11/11 通过
✅ 所有API端点测试通过！
```

---

## 🔧 配置

### 修改测试服务器地址

如果服务器运行在不同地址，可以修改测试文件中的 `BASE_URL`：

```python
# tests/test_api_endpoints.py
BASE_URL = "http://localhost:5001"  # 修改为实际地址
```

### 修改超时时间

```python
# tests/test_api_endpoints.py
TIMEOUT = 10  # 修改超时时间（秒）
```

---

## ⚠️ 注意事项

1. **服务器必须运行**：测试前确保服务器已启动
2. **数据库可访问**：确保所有数据库文件存在且可访问
3. **网络连接**：某些测试需要外部API访问（如Bilibili）
4. **测试环境**：建议在测试环境先运行，再在生产环境运行

---

## 🐛 常见问题

### 问题1：连接被拒绝

**错误**：`无法连接到服务器`

**解决**：
- 确保服务器已启动
- 检查 `BASE_URL` 配置是否正确
- 检查防火墙设置

### 问题2：数据库连接失败

**错误**：`数据库连接失败`

**解决**：
- 确保数据库文件存在
- 检查数据库文件权限
- 检查数据库路径配置

### 问题3：API返回错误

**错误**：`API返回错误状态码`

**解决**：
- 检查服务器日志
- 确认API路由已正确注册
- 检查数据库数据是否完整

---

## 📚 相关文档

- [功能稳定性检查报告](../07-测试文档/功能稳定性检查报告_20251211.md)
- [功能可用性测试清单](../07-测试文档/功能可用性测试清单_20251211.md)
- [系统稳定性总结](../07-测试文档/系统稳定性总结_20251211.md)
- [定时任务部署检查清单](./定时任务部署检查清单_20251211.md)

---

## 🎯 最佳实践

1. **每次部署前运行**：确保每次部署前都运行测试
2. **修复所有失败**：不要忽略失败的测试
3. **记录测试结果**：保存测试结果作为部署记录
4. **定期更新测试**：随着功能增加，更新测试用例

---

**最后更新**：2025-12-11




