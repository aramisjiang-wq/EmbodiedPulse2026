# 论文数据更新功能部署检查清单

## 部署前检查

### 1. 代码文件检查
- [ ] `app.py` - 已添加 `semantic_update_status` 全局变量
- [ ] `auth_routes.py` - 已添加4个新的管理端API接口
- [ ] `update_semantic_scholar_data.py` - 已修改支持状态更新
- [ ] `templates/admin_papers.html` - 已添加操作按钮和状态显示
- [ ] `static/js/admin_papers.js` - 已实现前端功能

### 2. Git状态检查
```bash
# 检查是否有未提交的更改
git status

# 查看修改的文件
git diff --name-only

# 确认修改的文件
git diff app.py
git diff auth_routes.py
git diff update_semantic_scholar_data.py
git diff templates/admin_papers.html
git diff static/js/admin_papers.js
```

### 3. 代码语法检查
```bash
# 检查Python语法
python3 -m py_compile app.py
python3 -m py_compile auth_routes.py
python3 -m py_compile update_semantic_scholar_data.py

# 检查JavaScript语法（如果有工具）
# npm install -g eslint
# eslint static/js/admin_papers.js
```

### 4. 依赖检查
```bash
# 确保以下依赖已安装
pip list | grep -E "(flask|sqlalchemy|arxiv|requests)"
```

## 部署步骤

### 方式一：使用部署脚本（推荐）

```bash
# 1. 在服务器上执行
cd /srv/EmbodiedPulse2026
chmod +x scripts/deploy_paper_update_feature.sh
./scripts/deploy_paper_update_feature.sh
```

### 方式二：手动部署

#### 1. 提交代码到Git（如果还未提交）
```bash
git add app.py auth_routes.py update_semantic_scholar_data.py templates/admin_papers.html static/js/admin_papers.js
git commit -m "feat: 添加管理端论文数据更新功能（ArXiv抓取和Semantic Scholar更新）"
git push origin main
```

#### 2. 在服务器上拉取代码
```bash
cd /srv/EmbodiedPulse2026
git fetch origin
git checkout main
git pull origin main
```

#### 3. 检查文件是否存在
```bash
ls -la app.py auth_routes.py update_semantic_scholar_data.py
ls -la templates/admin_papers.html static/js/admin_papers.js
```

#### 4. 重启服务
```bash
# 使用systemd
sudo systemctl restart embodiedpulse

# 检查服务状态
sudo systemctl status embodiedpulse

# 查看日志
sudo journalctl -u embodiedpulse -f
```

## 部署后验证

### 1. 检查服务状态
```bash
# 检查服务是否运行
sudo systemctl status embodiedpulse

# 检查端口是否监听
netstat -tlnp | grep 5001
# 或
ss -tlnp | grep 5001
```

### 2. 检查API端点
```bash
# 检查新API是否已注册（需要认证，这里只是检查代码）
grep -r "papers/fetch-arxiv" /srv/EmbodiedPulse2026/auth_routes.py
grep -r "papers/update-semantic" /srv/EmbodiedPulse2026/auth_routes.py
```

### 3. 功能测试

#### 测试ArXiv论文抓取
1. 访问管理端：`https://your-domain.com/admin/papers`
2. 点击"从ArXiv拉取新论文"按钮
3. 观察状态显示和进度条
4. 验证任务完成后论文列表是否刷新

#### 测试Semantic Scholar更新
1. 点击"更新Semantic Scholar数据"按钮
2. 观察状态显示和进度条
3. 验证任务完成后引用数等数据是否更新

### 4. 检查日志
```bash
# 查看应用日志
sudo journalctl -u embodiedpulse -n 100 --no-pager

# 实时查看日志
sudo journalctl -u embodiedpulse -f

# 查看错误日志
sudo journalctl -u embodiedpulse -p err -n 50
```

## 常见问题排查

### 问题1：服务启动失败
```bash
# 检查服务状态
sudo systemctl status embodiedpulse

# 查看详细错误
sudo journalctl -u embodiedpulse -n 50

# 检查Python语法
python3 -m py_compile app.py
python3 -m py_compile auth_routes.py
```

### 问题2：API接口404
- 检查路由是否正确注册
- 检查Blueprint是否正确导入
- 检查URL前缀是否正确

### 问题3：前端按钮无响应
- 检查浏览器控制台是否有错误
- 检查JavaScript文件是否正确加载
- 检查API接口是否可访问

### 问题4：任务状态不更新
- 检查全局变量是否正确初始化
- 检查线程锁是否正确使用
- 检查状态更新逻辑是否正确

## 回滚步骤

如果部署后出现问题，可以回滚：

```bash
# 1. 停止服务
sudo systemctl stop embodiedpulse

# 2. 回滚代码
cd /srv/EmbodiedPulse2026
git log --oneline -10  # 查看提交历史
git checkout <previous-commit-hash>  # 回滚到之前的提交

# 或使用备份
cp -r backups/deploy_YYYYMMDD_HHMMSS/* .

# 3. 重启服务
sudo systemctl start embodiedpulse
```

## 部署完成确认

- [ ] 服务正常运行
- [ ] API接口可访问
- [ ] 前端按钮显示正常
- [ ] ArXiv抓取功能测试通过
- [ ] Semantic Scholar更新功能测试通过
- [ ] 日志无错误信息

## 联系信息

如有问题，请查看：
- 项目文档：`docs/项目文档/09-问题修复/管理端论文数据更新功能方案_20251219_v1.0.md`
- 部署脚本：`scripts/deploy_paper_update_feature.sh`

