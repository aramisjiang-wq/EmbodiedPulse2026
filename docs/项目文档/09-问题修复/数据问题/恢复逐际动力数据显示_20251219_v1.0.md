# 恢复逐际动力数据显示

## 问题描述

用户反馈：逐际动力的所有数据都看不到了。

## 可能的原因

1. **数据库状态问题**：`is_active=False` 导致UP主被过滤
2. **视频状态问题**：视频被标记为 `is_deleted=True`
3. **缓存问题**：缓存数据格式错误导致返回空数据
4. **代码逻辑问题**：查询条件有问题

## 诊断步骤

### 步骤1：检查数据库中的数据

在服务器上运行：

```bash
cd /srv/EmbodiedPulse2026
git pull origin main
source venv/bin/activate
python3 scripts/check_limx_data.py
```

这会显示：
- UP主记录是否存在
- `is_active` 状态
- 视频数量和状态
- 统计数据

### 步骤2：检查API返回

```bash
# 清除缓存并测试API
curl "http://localhost:5000/api/bilibili/all?force=1" | jq '.data[] | select(.user_info.name == "逐际动力")'
```

### 步骤3：检查前端显示

打开浏览器开发者工具，查看：
- Network 标签中的 `/api/bilibili/all` 请求
- Console 中的错误信息
- 返回的数据格式

## 快速修复方案

### 方案1：修复数据库状态（如果is_active=False）

```bash
cd /srv/EmbodiedPulse2026
source venv/bin/activate
python3 -c "
from bilibili_models import get_bilibili_session, BilibiliUp
session = get_bilibili_session()
up = session.query(BilibiliUp).filter_by(uid=1172054289).first()
if up:
    up.is_active = True
    session.commit()
    print('✅ 已设置 is_active=True')
else:
    print('❌ UP主记录不存在')
session.close()
"
```

### 方案2：清除缓存

```bash
# 重启服务以清除内存缓存
sudo systemctl restart embodiedpulse

# 或者访问API时带上force=1参数
curl "http://localhost:5000/api/bilibili/all?force=1"
```

### 方案3：回滚代码（如果需要）

如果确认是代码问题，可以回滚到之前的工作版本：

```bash
cd /srv/EmbodiedPulse2026
git log --oneline | grep "修复管理端数据显示"
# 找到提交ID，例如：c0ec4273

# 回滚到该版本
git checkout c0ec4273 -- app.py
git commit -m "回滚app.py到之前的工作版本"
git push origin main

# 重启服务
sudo systemctl restart embodiedpulse
```

## 验证

修复后，验证数据是否正常显示：

1. 检查数据库：`python3 scripts/check_limx_data.py`
2. 检查API：`curl "http://localhost:5000/api/bilibili/all?force=1" | jq '.data[0]'`
3. 检查前端：刷新页面，查看逐际动力的数据是否显示

## 注意事项

- 回滚代码前，先备份当前版本
- 确认数据库中的数据是否还在
- 如果数据被误删，需要重新抓取

