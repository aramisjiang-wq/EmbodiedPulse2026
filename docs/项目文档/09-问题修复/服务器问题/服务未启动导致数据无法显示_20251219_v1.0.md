# 服务未启动导致数据无法显示

## 问题描述

测试API时发现服务未启动（Connection refused），导致数据无法显示。

## 解决步骤

### 步骤1：检查服务状态

```bash
sudo systemctl status embodiedpulse
```

### 步骤2：如果服务未运行，启动服务

```bash
sudo systemctl start embodiedpulse
```

### 步骤3：如果启动失败，查看日志

```bash
sudo journalctl -u embodiedpulse -n 50 --no-pager
```

### 步骤4：检查服务配置

```bash
# 查看服务配置文件
cat /etc/systemd/system/embodiedpulse.service

# 如果配置文件有问题，需要修复
```

### 步骤5：重启服务

```bash
sudo systemctl restart embodiedpulse
sudo systemctl status embodiedpulse
```

### 步骤6：验证服务是否正常

```bash
# 等待几秒让服务启动
sleep 5

# 测试API
curl "http://localhost:5000/api/bilibili/all?force=1" | head -20

# 或者运行测试脚本
python3 scripts/test_api_response.py
```

## 常见问题

### 问题1：服务启动失败

**可能原因**：
- 代码有语法错误
- 依赖包缺失
- 数据库连接失败
- 端口被占用

**解决方法**：
1. 查看日志：`sudo journalctl -u embodiedpulse -n 100 --no-pager`
2. 检查代码：`python3 -m py_compile app.py`
3. 检查依赖：`pip list | grep -E "flask|gunicorn"`
4. 检查端口：`netstat -tlnp | grep 5000`

### 问题2：服务启动但立即退出

**可能原因**：
- 代码运行时错误
- 数据库连接失败
- 环境变量缺失

**解决方法**：
1. 查看日志找出错误
2. 检查环境变量：`env | grep -E "DATABASE|BILI"`
3. 手动运行测试：`python3 -c "from app import app; print('OK')"`

## 验证数据是否恢复

服务启动后，验证数据：

```bash
# 1. 测试API
python3 scripts/test_api_response.py

# 2. 检查逐际动力数据
python3 scripts/check_limx_data.py

# 3. 访问前端页面，查看数据是否显示
```


