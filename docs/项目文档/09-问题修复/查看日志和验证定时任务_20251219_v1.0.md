# æŸ¥çœ‹æ—¥å¿—å’ŒéªŒè¯å®šæ—¶ä»»åŠ¡

**æ—¥æœŸ**: 2025-12-19

---

## ğŸ“‹ æ—¥å¿—ä½ç½®

### æ–¹å¼1ï¼šsystemd æ—¥å¿—ï¼ˆæ¨èï¼‰

å¦‚æœä½¿ç”¨ systemd æœåŠ¡ï¼Œæ—¥å¿—è¾“å‡ºåˆ° systemd journalï¼š

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u embodiedpulse -f

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼ˆæœ€å100è¡Œï¼‰
journalctl -u embodiedpulse -n 100

# æŸ¥çœ‹åŒ…å«"è§†é¢‘æ’­æ”¾é‡"çš„æ—¥å¿—
journalctl -u embodiedpulse | grep "è§†é¢‘æ’­æ”¾é‡"

# æŸ¥çœ‹åŒ…å«"å®šæ—¶ä»»åŠ¡"çš„æ—¥å¿—
journalctl -u embodiedpulse | grep "å®šæ—¶ä»»åŠ¡"
```

### æ–¹å¼2ï¼šé¡¹ç›®æ ¹ç›®å½•æ—¥å¿—æ–‡ä»¶

```bash
# æŸ¥çœ‹ app.logï¼ˆå¦‚æœå­˜åœ¨ï¼‰
tail -f app.log

# æˆ–è€…
cat app.log | grep "è§†é¢‘æ’­æ”¾é‡"
```

### æ–¹å¼3ï¼šGunicorn æ—¥å¿—

Gunicorn é…ç½®ä¸­æ—¥å¿—è¾“å‡ºåˆ° stdout/stderrï¼Œä¼šè¢« systemd æ•è·ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
journalctl -u embodiedpulse --no-pager

# å®æ—¶æŸ¥çœ‹
journalctl -u embodiedpulse -f
```

---

## ğŸ” éªŒè¯å®šæ—¶ä»»åŠ¡

### æ­¥éª¤1ï¼šæ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦å·²é…ç½®

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼ŒæŸ¥æ‰¾å®šæ—¶ä»»åŠ¡é…ç½®ä¿¡æ¯
journalctl -u embodiedpulse | grep "è§†é¢‘æ’­æ”¾é‡æ›´æ–°å®šæ—¶ä»»åŠ¡"

# åº”è¯¥çœ‹åˆ°ï¼š
# è§†é¢‘æ’­æ”¾é‡æ›´æ–°å®šæ—¶ä»»åŠ¡å·²é…ç½®: 0 2 * * *
```

### æ­¥éª¤2ï¼šæ£€æŸ¥å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨æ˜¯å¦å¯åŠ¨

```bash
# æŸ¥çœ‹æœåŠ¡å¯åŠ¨æ—¥å¿—
journalctl -u embodiedpulse | grep "å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨"

# åº”è¯¥çœ‹åˆ°ï¼š
# âœ… å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨ï¼ˆé€‚ç”¨äºGunicornç­‰ç”Ÿäº§ç¯å¢ƒï¼‰
```

### æ­¥éª¤3ï¼šæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æ›´æ–°ï¼ˆæµ‹è¯•ï¼‰

```bash
cd /srv/EmbodiedPulse2026
source venv/bin/activate
python3 scripts/update_video_play_counts.py
```

### æ­¥éª¤4ï¼šæŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¥å¿—

```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¥å¿—
journalctl -u embodiedpulse | grep "å®šæ—¶è§†é¢‘æ’­æ”¾é‡æ›´æ–°ä»»åŠ¡"

# æˆ–è€…æŸ¥çœ‹æ‰€æœ‰å®šæ—¶ä»»åŠ¡ç›¸å…³æ—¥å¿—
journalctl -u embodiedpulse | grep -E "å®šæ—¶|scheduled|APScheduler"
```

---

## ğŸš€ å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status embodiedpulse

# 2. æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼ˆæœ€å50è¡Œï¼‰
journalctl -u embodiedpulse -n 50

# 3. æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ç›¸å…³æ—¥å¿—
journalctl -u embodiedpulse | grep -E "å®šæ—¶ä»»åŠ¡|scheduler|è§†é¢‘æ’­æ”¾é‡"

# 4. å®æ—¶æŸ¥çœ‹æ—¥å¿—
journalctl -u embodiedpulse -f
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æ—¥å¿—æ–‡ä»¶

**åŸå› **ï¼šGunicorn é…ç½®ä¸­æ—¥å¿—è¾“å‡ºåˆ° stdout/stderrï¼Œè¢« systemd æ•è·

**è§£å†³**ï¼šä½¿ç”¨ `journalctl -u embodiedpulse` æŸ¥çœ‹

### é—®é¢˜2ï¼šçœ‹ä¸åˆ°å®šæ—¶ä»»åŠ¡æ—¥å¿—

**å¯èƒ½åŸå› **ï¼š
1. å®šæ—¶ä»»åŠ¡è¿˜æœªæ‰§è¡Œï¼ˆé»˜è®¤æ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
2. `AUTO_UPDATE_VIDEO_PLAYS_ENABLED` æœªè®¾ç½®ä¸º `true`
3. å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨æœªå¯åŠ¨

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
grep AUTO_UPDATE_VIDEO_PLAYS /srv/EmbodiedPulse2026/.env

# æ£€æŸ¥æœåŠ¡æ—¥å¿—ä¸­çš„å®šæ—¶ä»»åŠ¡é…ç½®
journalctl -u embodiedpulse | grep "è§†é¢‘æ’­æ”¾é‡æ›´æ–°å®šæ—¶ä»»åŠ¡"
```

### é—®é¢˜3ï¼šå¦‚ä½•ç«‹å³æµ‹è¯•å®šæ—¶ä»»åŠ¡

**æ–¹æ³•1**ï¼šæ‰‹åŠ¨è¿è¡Œè„šæœ¬
```bash
cd /srv/EmbodiedPulse2026
source venv/bin/activate
python3 scripts/update_video_play_counts.py
```

**æ–¹æ³•2**ï¼šä¿®æ”¹å®šæ—¶ä»»åŠ¡æ—¶é—´ä¸ºå½“å‰æ—¶é—´ï¼ˆæµ‹è¯•åæ”¹å›ï¼‰
```bash
# ä¸´æ—¶ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼ˆæµ‹è¯•ç”¨ï¼‰
export AUTO_UPDATE_VIDEO_PLAYS_SCHEDULE="*/5 * * * *"  # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆæµ‹è¯•ç”¨ï¼‰
systemctl restart embodiedpulse
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] æœåŠ¡æ­£åœ¨è¿è¡Œï¼š`systemctl status embodiedpulse`
- [ ] å®šæ—¶ä»»åŠ¡å·²é…ç½®ï¼šæ—¥å¿—ä¸­çœ‹åˆ°"è§†é¢‘æ’­æ”¾é‡æ›´æ–°å®šæ—¶ä»»åŠ¡å·²é…ç½®"
- [ ] å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨ï¼šæ—¥å¿—ä¸­çœ‹åˆ°"å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨"
- [ ] æ‰‹åŠ¨æµ‹è¯•æˆåŠŸï¼š`python3 scripts/update_video_play_counts.py` æ‰§è¡ŒæˆåŠŸ
- [ ] æ•°æ®å·²æ›´æ–°ï¼šæ£€æŸ¥æ•°æ®åº“ä¸­çš„è§†é¢‘æ’­æ”¾é‡æ˜¯å¦æ›´æ–°


