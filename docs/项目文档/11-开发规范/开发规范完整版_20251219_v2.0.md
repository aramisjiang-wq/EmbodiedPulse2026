# 开发规范完整版

**文档版本**: v2.0  
**创建日期**: 2025-12-19  
**最后更新**: 2025-12-19  
**适用范围**: Embodied Pulse 项目及所有由 AI 助手参与的 Web / 后端 / 数据类项目

---

## 📋 目录

1. [核心原则](#核心原则)
2. [文档管理规范](#文档管理规范)
3. [代码管理规范](#代码管理规范)
4. [功能说明组织规范](#功能说明组织规范)
5. [问题修复分类规范](#问题修复分类规范)
6. [开发记录管理规范](#开发记录管理规范)
7. [文档命名规范](#文档命名规范)
8. [文档更新规范](#文档更新规范)
9. [代码质量规范](#代码质量规范)
10. [版本控制规范](#版本控制规范)
11. [AI助手行为准则](#ai助手行为准则)

---

## 🎯 核心原则

### 1. 代码管理原则（必须严格遵守）

**✅ 必须遵守：**
- 所有代码修改必须先提交到GitHub
- 服务器代码必须从GitHub拉取（`git pull origin main`）
- 使用标准化的脚本和流程
- 记录所有操作和结果

**❌ 严格禁止：**
- 禁止直接在服务器上手动编辑代码
- 禁止跳过GitHub直接修改服务器代码
- 禁止不测试就重启服务
- 禁止在服务器上使用 `nano`、`vim` 等编辑器直接修改代码

### 2. 修复流程原则

**标准流程（必须遵循）：**
```
本地修复 → 提交GitHub → 服务器拉取 → 验证 → 重启 → 测试
```

**服务器修复流程：**
```bash
cd /srv/EmbodiedPulse2026
bash scripts/server_fix_standard_flow.sh
```

### 3. 文档管理原则

**核心原则**：
- **一个目的一个文档** - 相同目的的文档必须合并
- **文档更新时同步更新文档名称** - 必须更新日期和版本号
- **按页面组织功能说明** - 功能说明必须按页面结构化
- **问题修复按类型分类** - 必须按问题类型分类整理

---

## 📁 文档管理规范

### 1. 文档存储位置（核心原则）

- **所有项目文档统一放在项目内的 `docs/项目文档/` 目录下**
- 不在 `docs/` 下随意新建零散目录，一律归入编号体系
- 所有文档按**产品开发流程顺序**编号（01-12）

### 2. 文件夹编号系统

| 编号 | 文件夹名 | 阶段 | 说明 |
|------|---------|------|------|
| 01 | 需求文档 | 需求分析阶段 | 产品需求文档（PRD）、功能需求分析 |
| 02 | 产品文档 | 产品设计阶段 | 产品介绍、设计理念、开发过程分享 |
| 03 | 技术文档 | 技术设计阶段 | 技术架构、数据库设计、技术方案 |
| 04 | 功能说明 | 功能开发阶段 | **功能详细说明（按页面/功能分类）** |
| 05 | 开发记录 | 开发过程阶段 | 开发过程记录、复盘、总结（合并为完整文档） |
| 06 | 安装部署 | 安装部署阶段 | 安装指南、配置说明、环境搭建、部署方案 |
| 07 | 优化记录 | 优化迭代阶段 | UI/UX优化和性能优化记录 |
| 08 | 测试文档 | 测试验证阶段 | 测试记录和测试文档（合并） |
| 09 | 问题修复 | 问题解决阶段 | Bug修复记录（**按问题类型分类**） |
| 10 | 使用说明 | 用户使用阶段 | 用户使用指南（不含部署相关） |
| 11 | 开发规范 | 规范制定阶段 | 开发原则、规范、最佳实践 |
| 12 | 沟通记录 | 沟通交流阶段 | 开发沟通历程 |

### 3. 一级分类职责

- **01-需求文档/**：只放「是什么 & 为什么」：PRD、用户需求分析
- **02-产品文档/**：产品定位、目标用户、AHA 时刻、产品故事
- **03-技术文档/**：整体技术方案、架构图、数据库设计、技术选型、SPEC 文档
- **04-功能说明/**：只放「怎么做 & 具体行为规则 & 流程」，是**实现层**说明
- **05-开发记录/**：开发过程中的阶段性记录、复盘、总结，**合并为完整文档**
- **06-安装部署/**：环境准备、配置、部署步骤、运维脚本说明
- **07-优化记录/**：UI / 功能 / 性能的优化过程与结果
- **08-测试文档/**：测试计划、测试用例、测试报告
- **09-问题修复/**：数据问题、功能问题、UI问题的分析与修复记录（**按类型分类**）
- **10-使用说明/**：面向使用者的使用手册、快速上手指南（**删除过期文档**）
- **11-开发规范/**：像本文这样的规范、最佳实践
- **12-沟通记录/**：需求沟通、会议纪要、决策记录

---

## 🧩 功能说明组织规范

### 核心原则：按页面组织（Page-first）

功能说明文档必须按**产品 → 页面 → 区块 → 功能点**的结构组织：

```
04-功能说明/页面功能/
  ├─ 用户端/
  │   ├─ 具身论文页面/
  │   │   ├─ 刷新数据/
  │   │   ├─ 论文标签体系/
  │   │   ├─ 新论文提示/
  │   │   └─ 数据集信息挂窗/
  │   ├─ 具身视频Hub页面/
  │   │   ├─ 视频发布趋势/
  │   │   ├─ 播放量统计/
  │   │   └─ UP主信息/
  │   ├─ 用户中心/
  │   │   └─ 飞书登录/
  │   └─ 导航栏/
  ├─ 管理端/
  │   └─ 管理平台/
  │       ├─ 仪表盘/
  │       ├─ 用户管理/
  │       ├─ 论文管理/
  │       ├─ 视频管理/
  │       └─ 日志监控/
  └─ 功能方案/   # 跨产品的通用方案
```

### 横切维度文档（Purpose-first）

同时维护横切维度的文档，用于按功能类型查找：

- `04-功能说明/API接口/` - 按业务域分类 API（论文API/视频API/管理API/认证API）
- `04-功能说明/命令行工具/` - 按用途分类脚本（数据抓取/数据检查/数据修复/部署/工具）
- `04-功能说明/数据流转/` - 按数据源或业务域描述端到端数据流
- `04-功能说明/数据抓取/` - 论文 / 视频 / 新闻 / 招聘等抓取逻辑
- `04-功能说明/定时任务/` - 各定时任务配置与调度规则
- `04-功能说明/第三方集成/` - ArXiv、B站、Semantic Scholar、飞书等集成说明

**关键点**：页面功能文档（Page-first）和横切文档（Purpose-first）是互补的两种视角。

---

## 🐛 问题修复分类规范

### 分类结构（必须遵守）

问题修复文档必须按问题类型分类：

```
09-问题修复/
  ├─ 数据问题/
  │   ├─ B站数据问题完整解决方案.md
  │   ├─ 论文数据更新问题.md
  │   └─ 视频播放量数据问题.md
  ├─ 功能问题/
  │   ├─ 刷新数据失败问题.md
  │   ├─ 新闻自动更新问题.md
  │   └─ 增量更新逻辑问题.md
  ├─ UI问题/
  │   ├─ 页面刷新和显示问题.md
  │   └─ 模板文件路径问题.md
  ├─ 服务器问题/
  │   ├─ 服务器修复执行步骤.md
  │   ├─ 502错误修复.md
  │   └─ 服务未启动问题.md
  └─ 定时任务问题/
      ├─ 定时任务失败重试机制.md
      └─ 定时任务配置问题.md
```

### 分类规则

1. **数据问题**：数据库、数据更新、数据一致性、数据缺失等问题
2. **功能问题**：功能不工作、功能异常、功能逻辑错误等问题
3. **UI问题**：页面显示、样式、交互、响应式等问题
4. **服务器问题**：服务启动、部署、配置、环境等问题
5. **定时任务问题**：定时任务不执行、执行失败、配置错误等问题

### 合并原则

- 同一类型的问题修复文档，如果内容相关，应合并为一个文档
- 核心问题解决方案应保留为独立文档（如 `B站数据问题完整解决方案.md`）
- 过期的、已解决的、不再适用的文档应删除或归档

---

## 📝 开发记录管理规范

### 核心原则

- **开发记录应合并为一个完整文档**：`05-开发记录/开发记录_YYYYMMDD_v版本号.md`
- **发版记录独立维护**：`05-开发记录/发版记录_CHANGELOG.md`
- **项目复盘独立维护**：`05-开发记录/项目完整复盘报告_YYYYMMDD_v版本号.md`

### 文档结构

```
05-开发记录/
  ├─ 开发记录_20251219_v2.0.md          # 完整的开发记录（合并所有开发记录）
  ├─ 发版记录_CHANGELOG.md               # 发版记录（独立维护）
  ├─ 项目完整复盘报告_20251218_v1.0.md  # 项目复盘（独立维护）
  └─ 归档文档/                           # 历史开发记录归档
      ├─ 12月17日开发记录_20251217_v1.0.md
      └─ 代码清理报告_20251217_v1.0.md
```

### 合并规则

- 同一目的的开发记录应合并
- 过期的开发记录应归档或删除
- 保留有价值的复盘和总结文档

---

## 📄 文档命名规范

### 标准格式

**格式**：`文档目的_YYYYMMDD_v版本号.md`

**示例**：
- `PRD_产品需求文档_20251219_v2.0.md`
- `具身论文页面功能说明_20251219_v2.0.md`
- `B站数据问题完整解决方案_20251219_v1.0.md`

### 更新规则

- **文档更新时，必须更新文档名称中的日期和版本号**
- **版本号规则**：
  - 主版本号：重大更新（功能重构、架构调整）
  - 次版本号：内容更新（新增章节、重要修改）
- **这是AI的强制要求，必须时刻遵守**

### AI操作要求

- **创建新文档时**：必须包含当前日期和版本号（v1.0）
- **更新现有文档时**：必须更新文档名称中的日期和版本号
- **检查文档时**：发现没有日期或版本号的文档，自动添加
- **这是AI的默认操作习惯，无需用户提醒**

---

## 🔄 文档更新规范

### 功能改动时的文档更新清单（必须执行）

**当涉及产品功能改动时（新增、修改、删除功能），必须同步更新：**

1. **PRD文档**（必须）
   - 文件位置：`docs/项目文档/01-需求文档/PRD_产品需求文档_YYYYMMDD_v版本号.md`
   - 更新内容：功能需求描述、功能优先级、用户场景、功能规格说明

2. **SPEC文档**（必须）
   - 文件位置：`docs/项目文档/03-技术文档/SPEC_技术规格文档_YYYYMMDD_v版本号.md`
   - 更新内容：技术实现方案、API接口规范、数据库设计变更

3. **CHANGELOG文档**（必须）
   - 文件位置：`docs/项目文档/05-开发记录/发版记录_CHANGELOG.md`
   - 更新内容：版本号、更新日期、功能变更说明

4. **README文档**（必须）
   - 文件位置：项目根目录 `README.md` 或 `docs/项目文档/README_PROJECT_YYYYMMDD_v版本号.md`
   - 更新内容：项目介绍、功能列表、快速开始

5. **相关功能说明文档**（必须）
   - 文件位置：`docs/项目文档/04-功能说明/页面功能/具体页面/`
   - 更新内容：功能详细说明、使用指南

---

## 💻 代码管理规范

### 代码推送规范

**数据库文件禁止推送**：
- 所有数据库文件（`*.db`）和备份文件（`backups/`）**禁止**推送到GitHub
- 避免本地数据库覆盖服务器的最新数据
- 保护服务器数据安全

**推送前检查清单**：
```bash
# 1. 检查待推送文件
git status

# 2. 检查是否有数据库文件
git status | grep -E "\.db$|backups/"

# 3. 验证 .gitignore 生效
git check-ignore papers.db
```

### Git提交规范

**Commit Message格式**：
```
<type>: <subject>

<body>

<footer>
```

**Type类型**：
- `feat`: 新功能
- `fix`: 修复Bug
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具相关

---

## 🎨 代码质量规范

### 底层原则

1. **数据去重是底层原则**
   - 每次获取数据时都要遵循去重机制
   - 数据库层面：主键约束（ID唯一）
   - 应用层面：标题相似度检查（阈值0.85）

2. **性能优先**
   - 查询速度 < 100ms（90%的请求）
   - 避免不必要的延迟
   - 优化数据库查询（使用索引）

3. **错误处理**
   - 所有API调用都要有异常处理
   - 提供有意义的错误信息
   - 记录错误日志

### 代码组织规范

**命名规范**：
- Python文件：`snake_case.py`
- 函数名：`snake_case()`
- 类名：`PascalCase`
- 常量：`UPPER_CASE`
- 变量：`snake_case`

---

## 🤖 AI助手行为准则

### 默认行为

1. **永远建议从GitHub拉取代码**
   - 任何修复建议都必须包含 `git pull origin main`
   - 禁止建议直接在服务器上编辑代码

2. **永远使用标准脚本**
   - 推荐使用 `scripts/server_fix_standard_flow.sh`
   - 禁止建议手动执行修复步骤

3. **永远先诊断后修复**
   - 遇到问题先执行诊断脚本
   - 根据诊断结果制定修复方案

4. **永远记录操作**
   - 记录所有建议的操作
   - 记录预期结果

5. **永远验证修复**
   - 修复后必须验证
   - 提供验证命令

6. **文档更新时同步更新文档名称**
   - 创建新文档时自动添加日期和版本号
   - 更新文档时自动更新日期和版本号
   - 发现命名不规范时自动改正

7. **功能说明按页面组织**
   - 创建功能说明时按「产品 → 页面 → 区块 → 功能点」结构组织
   - 同时维护横切维度的文档

8. **问题修复按类型分类**
   - 创建问题修复文档时按问题类型分类
   - 同一类型的问题修复文档应合并

9. **开发记录合并管理**
   - 同一目的的开发记录应合并
   - 过期的开发记录应归档或删除

---

## 📚 相关文档

- [PRD文档](../01-需求文档/PRD_产品需求文档_20251219_v2.0.md)
- [SPEC文档](../03-技术文档/SPEC_技术规格文档_20251219_v2.0.md)
- [发版记录](../05-开发记录/发版记录_CHANGELOG.md)
- [账号手册](../账号手册_20251219_v1.0.md)

---

**最后更新**：2025-12-19  
**维护者**：AI开发助手  
**版本**：v2.0

