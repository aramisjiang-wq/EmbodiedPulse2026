# 服务器代码更新指南

## 问题

服务器上可能没有最新的脚本文件，导致无法执行某些操作。

## 解决方案

### 方法1：在服务器上检查并更新代码

SSH连接到服务器后，运行：

```bash
cd /srv/EmbodiedPulse2026

# 1. 检查Git状态
git status

# 2. 检查关键脚本是否存在
ls -la scripts/fetch_single_video.py
ls -la scripts/update_video_play_counts.py

# 3. 如果脚本不存在，拉取最新代码
git fetch origin
git pull origin main

# 4. 检查脚本是否已存在
ls -la scripts/fetch_single_video.py
```

### 方法2：使用检查脚本

我已经创建了 `scripts/check_and_update_server.sh`，在服务器上运行：

```bash
cd /srv/EmbodiedPulse2026
bash scripts/check_and_update_server.sh
```

### 方法3：手动检查并拉取

```bash
cd /srv/EmbodiedPulse2026

# 检查当前分支
git branch

# 查看未提交的更改
git status

# 拉取最新代码
git fetch origin
git pull origin main

# 检查脚本文件
ls -la scripts/fetch_single_video.py
ls -la scripts/update_video_play_counts.py
```

## 如果脚本不存在

如果拉取代码后脚本仍然不存在，可能需要：

1. **检查脚本是否在Git仓库中**
   ```bash
   git ls-files | grep fetch_single_video
   ```

2. **检查是否有未提交的更改**
   ```bash
   git status
   ```

3. **从本地推送到服务器**
   ```bash
   # 在本地执行
   git add scripts/fetch_single_video.py
   git commit -m "Add fetch_single_video.py script"
   git push origin main
   
   # 然后在服务器上拉取
   git pull origin main
   ```

## 关键脚本文件

确保以下文件存在于服务器上：

- ✅ `scripts/fetch_single_video.py` - 抓取单个视频
- ✅ `scripts/update_video_play_counts.py` - 更新视频播放量
- ✅ `fetch_bilibili_data.py` - 抓取B站数据
- ✅ `bilibili_models.py` - 数据库模型
- ✅ `bilibili_client.py` - B站API客户端

## 快速检查命令

在服务器上运行：

```bash
cd /srv/EmbodiedPulse2026

# 检查所有关键文件
for file in scripts/fetch_single_video.py scripts/update_video_play_counts.py fetch_bilibili_data.py bilibili_models.py bilibili_client.py; do
    if [ -f "$file" ]; then
        echo "✅ $file 存在"
    else
        echo "❌ $file 不存在"
    fi
done
```

