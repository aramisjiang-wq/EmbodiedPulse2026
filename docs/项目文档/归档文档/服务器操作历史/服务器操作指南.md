# 服务器操作指南 - 检查并更新视频播放量

## ⚠️ 重要提示

**这些命令必须在服务器上运行，不能在本地的Mac上运行！**

`/srv/EmbodiedPulse2026` 是服务器上的路径，本地Mac上没有这个目录。

## 方法1：SSH连接到服务器后运行

### 步骤1：SSH连接到服务器

```bash
# 替换为您的实际服务器地址和用户名
ssh your-user@essay.gradmotion.com
# 或
ssh root@your-server-ip
```

### 步骤2：进入应用目录

```bash
cd /srv/EmbodiedPulse2026
```

### 步骤3：检查视频播放量

```bash
source venv/bin/activate
python3 << 'EOF'
from bilibili_models import get_bilibili_session, BilibiliVideo

session = get_bilibili_session()
video = session.query(BilibiliVideo).filter_by(bvid='BV1L8qEBKEFW').first()

if video:
    print(f"✅ 找到视频:")
    print(f"BV号: {video.bvid}")
    print(f"标题: {video.title}")
    print(f"播放量: {video.play:,}")
    print(f"播放量(格式化): {video.play_formatted}")
    print(f"更新时间: {video.updated_at}")
    
    if video.play == 5530:
        print("\n⚠️  播放量是5530，需要更新！")
    elif video.play == 162712:
        print("\n✅ 播放量已更新为162,712")
else:
    print("❌ 未找到视频")

session.close()
EOF
```

### 步骤4：如果播放量是5530，更新它

```bash
# 更新逐际动力的所有视频播放量
python3 scripts/update_video_play_counts.py --uids 1172054289 --force

# 或者只更新单个视频
python3 scripts/fetch_single_video.py BV1L8qEBKEFW --uid 1172054289
```

### 步骤5：重启服务（如果需要）

```bash
systemctl restart embodiedpulse
```

## 方法2：使用远程脚本（从本地执行）

### 上传脚本到服务器

```bash
# 从本地上传脚本到服务器
scp scripts/check_video_on_server.sh your-user@essay.gradmotion.com:/srv/EmbodiedPulse2026/scripts/
scp scripts/update_video_on_server.sh your-user@essay.gradmotion.com:/srv/EmbodiedPulse2026/scripts/
```

### 在服务器上运行

```bash
# SSH连接到服务器
ssh your-user@essay.gradmotion.com

# 运行检查脚本
cd /srv/EmbodiedPulse2026
bash scripts/check_video_on_server.sh

# 如果需要更新，运行更新脚本
bash scripts/update_video_on_server.sh
```

## 方法3：一行命令（SSH远程执行）

```bash
# 检查视频播放量
ssh your-user@essay.gradmotion.com "cd /srv/EmbodiedPulse2026 && source venv/bin/activate && python3 -c \"
from bilibili_models import get_bilibili_session, BilibiliVideo
session = get_bilibili_session()
video = session.query(BilibiliVideo).filter_by(bvid='BV1L8qEBKEFW').first()
if video:
    print(f'播放量: {video.play:,}')
    print(f'更新时间: {video.updated_at}')
else:
    print('未找到视频')
session.close()
\""

# 更新视频播放量
ssh your-user@essay.gradmotion.com "cd /srv/EmbodiedPulse2026 && source venv/bin/activate && python3 scripts/update_video_play_counts.py --uids 1172054289 --force"
```

## 常见问题

### Q: 为什么本地运行报错 "no such file or directory: /srv/EmbodiedPulse2026"？

**A:** 因为 `/srv/EmbodiedPulse2026` 是服务器上的路径，本地Mac上没有这个目录。必须SSH连接到服务器后才能运行。

### Q: 为什么报错 "ModuleNotFoundError: No module named 'sqlalchemy'"？

**A:** 本地虚拟环境可能缺少依赖。但更重要的是，这些操作应该在**服务器上**执行，而不是本地。

### Q: 如何确认服务器地址和用户名？

**A:** 查看您的SSH配置或联系服务器管理员。通常：
- 服务器地址：`essay.gradmotion.com` 或服务器IP
- 用户名：`root` 或您配置的SSH用户

## 下一步

1. **SSH连接到服务器**
2. **运行检查命令**，确认服务器上的播放量
3. **如果是5530，运行更新命令**
4. **重启服务**（如果需要）
5. **刷新前端页面**查看最新数据

