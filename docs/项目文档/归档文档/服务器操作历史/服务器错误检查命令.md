# 服务器B站页面错误检查命令

## 方法1: 直接在服务器上执行（复制粘贴以下命令）

```bash
cd /srv/EmbodiedPulse2026

echo "=========================================="
echo "服务器B站页面错误检查"
echo "=========================================="
echo ""

echo "【1. 检查服务状态】"
echo "----------------------------------------"
systemctl status embodiedpulse --no-pager -l | head -20
echo ""

echo "【2. 检查systemd服务日志（最近100行）】"
echo "----------------------------------------"
journalctl -u embodiedpulse -n 100 --no-pager | tail -100
echo ""

echo "【3. 检查最近的错误和异常】"
echo "----------------------------------------"
journalctl -u embodiedpulse --since "1 hour ago" --no-pager | grep -i "error\|exception\|traceback" | tail -50
echo ""

echo "【4. 检查B站相关错误】"
echo "----------------------------------------"
journalctl -u embodiedpulse --since "24 hours ago" --no-pager | grep -i "bilibili" | tail -30
echo ""

echo "【5. 测试API端点】"
echo "----------------------------------------"
source venv/bin/activate
python3 << 'PYEOF'
import sys
sys.path.insert(0, '/srv/EmbodiedPulse2026')

try:
    from app import app
    with app.test_client() as client:
        print("测试 /api/bilibili/all 端点...")
        response = client.get('/api/bilibili/all?force=1')
        print(f"状态码: {response.status_code}")
        
        if response.status_code == 200:
            data = response.get_json()
            if data and data.get('success'):
                print(f"✅ API返回成功")
                print(f"   数据条数: {len(data.get('data', []))}")
            else:
                print(f"❌ API返回失败")
                print(f"   错误: {data.get('error', '未知错误') if data else '无数据'}")
                if data:
                    print(f"   完整响应: {data}")
        else:
            print(f"❌ HTTP错误: {response.status_code}")
            try:
                error_text = response.data.decode('utf-8')
                print(f"   响应内容: {error_text[:500]}")
            except:
                print(f"   响应数据: {response.data[:500]}")
                
except Exception as e:
    print(f"❌ 测试失败: {e}")
    import traceback
    traceback.print_exc()
PYEOF

echo ""
echo "【6. 检查数据库连接】"
echo "----------------------------------------"
python3 << 'PYEOF'
import sys
import os
sys.path.insert(0, '/srv/EmbodiedPulse2026')

try:
    from bilibili_models import BILIBILI_DATABASE_URL, get_bilibili_session, BilibiliUp, BilibiliVideo
    
    print(f"数据库URL: {BILIBILI_DATABASE_URL}")
    
    try:
        session = get_bilibili_session()
        up_count = session.query(BilibiliUp).count()
        video_count = session.query(BilibiliVideo).count()
        print(f"✅ 数据库连接成功")
        print(f"   UP主数量: {up_count}")
        print(f"   视频数量: {video_count}")
        session.close()
    except Exception as e:
        print(f"❌ 数据库连接失败: {e}")
        import traceback
        traceback.print_exc()
        
except Exception as e:
    print(f"❌ 导入失败: {e}")
    import traceback
    traceback.print_exc()
PYEOF

echo ""
echo "【7. 检查完整的错误堆栈（最近200行）】"
echo "----------------------------------------"
journalctl -u embodiedpulse -n 200 --no-pager | grep -B 5 -A 20 "Traceback\|Exception\|Error" | tail -100
echo ""

echo "=========================================="
echo "检查完成"
echo "=========================================="
```

## 方法2: 快速检查（只查看错误）

```bash
# 查看最近100行日志
journalctl -u embodiedpulse -n 100 --no-pager

# 查看B站相关错误
journalctl -u embodiedpulse --since "1 hour ago" --no-pager | grep -i bilibili

# 查看所有错误和异常
journalctl -u embodiedpulse --since "1 hour ago" --no-pager | grep -i "error\|exception\|traceback"
```

## 方法3: 部署检查脚本到服务器

在本地执行：

```bash
# 提交脚本到Git
git add scripts/check_server_bilibili_errors.sh
git commit -m "feat: 添加服务器B站错误检查脚本"
git push

# 然后在服务器上拉取
ssh root@your-server 'cd /srv/EmbodiedPulse2026 && git pull && chmod +x scripts/check_server_bilibili_errors.sh'
```

