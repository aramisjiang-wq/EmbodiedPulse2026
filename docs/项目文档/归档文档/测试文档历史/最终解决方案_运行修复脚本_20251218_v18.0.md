# 最终解决方案：运行修复脚本

**问题确认**：
- 数据库中"逐际动力"的 `videos_count=0, views_count=0` ✅
- 需要从视频表重新计算并更新这些字段 ✅

---

## 立即执行修复

在服务器上执行：

```bash
cd /srv/EmbodiedPulse2026

# 运行修复脚本，从视频表重新计算并更新videos_count和views_count
venv/bin/python3 scripts/fix_bilibili_stats.py

# 验证修复结果
venv/bin/python3 scripts/check_bilibili_db_values.py

# 重启应用
sudo systemctl restart embodiedpulse
sleep 5

# 验证API返回
curl 'http://localhost:5001/api/bilibili/all?force=1' 2>/dev/null | python3 -c "
import sys, json
data = json.load(sys.stdin)
if data.get('success') and data.get('data') and len(data['data']) > 0:
    card = data['data'][0]
    user_stat = card.get('user_stat', {})
    print('第一个UP主:', card.get('user_info', {}).get('name'))
    print('user_stat.videos:', user_stat.get('videos'))
    print('user_stat.views:', user_stat.get('views'))
"
```

---

## 修复脚本说明

`scripts/fix_bilibili_stats.py` 会：
1. 查询所有活跃的UP主
2. 从 `bilibili_videos` 表重新计算每个UP主的：
   - `videos_count` = 该UP主的视频数量（is_deleted=False）
   - `views_count` = 该UP主所有视频的播放量总和
   - `views_formatted` = 格式化后的播放量
3. 更新数据库中的这些字段

---

**文档结束**

