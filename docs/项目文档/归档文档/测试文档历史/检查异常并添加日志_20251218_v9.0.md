# 检查异常并添加日志

**问题**: 模拟代码返回正确值，但实际API返回0

---

## 立即检查步骤

### 步骤1：检查是否有异常被捕获

```bash
cd /srv/EmbodiedPulse2026
sudo journalctl -u embodiedpulse -n 500 --no-pager | grep -E "ERROR|Exception|Traceback|处理UP主.*数据失败" | tail -30
```

### 步骤2：添加详细日志

在服务器上修改 `app.py`，在第1311行前添加日志：

```bash
cd /srv/EmbodiedPulse2026

# 在第1311行前添加日志
sed -i '1311i\                        logger.info(f"DEBUG_USER_STAT: {up.name} - videos_count={up.videos_count}, views_count={up.views_count}, views_formatted={up.views_formatted!r}")' app.py

# 在第1315行后添加日志
sed -i '1316a\                        logger.info(f"DEBUG_RESULT: {up.name} - user_stat={card_data[\"user_stat\"]}")' app.py

# 重启应用
sudo systemctl restart embodiedpulse
sleep 5

# 测试API并查看日志
curl 'http://localhost:5001/api/bilibili/all?force=1' > /dev/null 2>&1
sudo journalctl -u embodiedpulse -n 100 --no-pager | grep "DEBUG" | tail -30
```

### 步骤3：如果发现异常

如果日志中有异常，查看具体错误信息并修复。

---

**文档结束**

