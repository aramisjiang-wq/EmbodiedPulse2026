# 直接SQL查询检查字段值

**问题**: SQLAlchemy查询返回0，但直接查询数据库有值

---

## 立即检查

在服务器上执行，直接使用SQL查询检查数据库中的实际值：

```bash
cd /srv/EmbodiedPulse2026

# 直接SQL查询检查字段值
venv/bin/python3 << 'EOF'
import sys
import os
sys.path.insert(0, '/srv/EmbodiedPulse2026')

from dotenv import load_dotenv
load_dotenv()

from sqlalchemy import create_engine, text

# 获取数据库URL
bilibili_db_url = os.getenv('BILIBILI_DATABASE_URL', 'sqlite:///./bilibili.db')
print(f"数据库URL: {bilibili_db_url}")

engine = create_engine(bilibili_db_url)

with engine.connect() as conn:
    # 直接SQL查询
    result = conn.execute(text("""
        SELECT uid, name, videos_count, views_count, views_formatted 
        FROM bilibili_ups 
        WHERE name = '逐际动力' AND is_active = true
    """))
    
    row = result.fetchone()
    if row:
        print(f"\n直接SQL查询结果:")
        print(f"  uid: {row[0]}")
        print(f"  name: {row[1]}")
        print(f"  videos_count: {row[2]} (type: {type(row[2]).__name__})")
        print(f"  views_count: {row[3]} (type: {type(row[3]).__name__})")
        print(f"  views_formatted: {row[4]!r}")
    else:
        print("❌ 未找到记录")
    
    # 检查表结构
    print(f"\n检查表结构:")
    if 'postgresql' in bilibili_db_url:
        result = conn.execute(text("""
            SELECT column_name, data_type 
            FROM information_schema.columns 
            WHERE table_name = 'bilibili_ups' 
            AND column_name IN ('videos_count', 'views_count', 'views_formatted')
            ORDER BY column_name
        """))
    else:
        # SQLite
        result = conn.execute(text("PRAGMA table_info(bilibili_ups)"))
    
    print("字段信息:")
    for r in result:
        print(f"  {r}")
EOF
```

---

**文档结束**

