# 立即修复总播放数为0 - 一键命令

**问题**: API返回0，但数据库有值，代码已修复

---

## 一键修复命令

在服务器上执行：

```bash
cd /srv/EmbodiedPulse2026 && \
sudo systemctl stop embodiedpulse && \
sleep 2 && \
find . -name "*.pyc" -delete && \
find . -name "__pycache__" -type d -exec rm -r {} + 2>/dev/null || true && \
sudo systemctl start embodiedpulse && \
sleep 5 && \
echo "测试API..." && \
curl 'http://localhost:5001/api/bilibili/all?force=1' | python3 -m json.tool | grep -A 4 '"user_stat"' | head -20
```

---

## 如果还是0，检查缓存

```bash
cd /srv/EmbodiedPulse2026
venv/bin/python3 << 'EOF'
# 清除缓存
import sys
sys.path.insert(0, '/srv/EmbodiedPulse2026')
from app import bilibili_cache, bilibili_cache_lock

with bilibili_cache_lock:
    bilibili_cache.clear()
    print("✅ 缓存已清除")

# 测试API逻辑
from bilibili_models import get_bilibili_session, BilibiliUp
from bilibili_client import format_number

session = get_bilibili_session()
up = session.query(BilibiliUp).filter_by(is_active=True).first()

if up:
    videos = format_number(up.videos_count) if up.videos_count else '0'
    views = up.views_formatted or (format_number(up.views_count) if up.views_count else '0')
    print(f"\n应该返回: videos={videos}, views={views}")

session.close()
EOF
```

---

**文档结束**

