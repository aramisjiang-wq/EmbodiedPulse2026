# 具身论文数据抓取流程说明

## 一、数据流程概述

是的，您的理解基本正确！让我详细说明一下完整的数据流程：

```
ArXiv API → 检索词查询 → 抓取论文 → 分类 → 保存到数据库
```

---

## 二、详细流程

### 2.1 配置层：检索词配置（config.yaml）

**文件**: `config.yaml`

**结构**:
```yaml
keywords:
    "Perception-2D":  # 子标签名称（用于检索）
        filters: ["perception", "2d perception", "visual perception", ...]  # 检索词列表
    
    "Perception-3D":
        filters: ["3d perception", "3d vision", "depth perception", ...]
    
    "Operation-Grasp":
        filters: ["grasp", "grasping", "manipulation", ...]
    # ... 更多子标签
```

**说明**:
- 每个子标签（如 `"Perception-2D"`）对应一组检索词（`filters`）
- 检索词用于构建ArXiv API查询语句
- 检索词之间用 `OR` 连接

---

### 2.2 检索层：ArXiv API查询（daily_arxiv.py）

**文件**: `daily_arxiv.py` → `get_daily_papers()`

**流程**:

1. **读取配置**
   ```python
   config = load_config('config.yaml')
   keywords = config['kv']  # 解析后的检索词字典
   # 例如: {"Perception-2D": '"perception"OR"2d perception"OR...'}
   ```

2. **遍历每个子标签**
   ```python
   for topic, keyword in keywords.items():
       # topic = "Perception-2D" (子标签名称)
       # keyword = '"perception"OR"2d perception"OR...' (检索词查询)
   ```

3. **构建ArXiv查询**
   ```python
   # 添加日期过滤
   date_filter = f"submittedDate:[{start_date} TO {end_date}]"
   full_query = f"({keyword}) AND {date_filter}"
   
   # 例如: ('"perception"OR"2d perception"') AND submittedDate:[20251201 TO 20251217]
   ```

4. **执行ArXiv API查询**
   ```python
   search = arxiv.Search(
       query=full_query,
       max_results=100,
       sort_by=arxiv.SortCriterion.SubmittedDate,
       sort_order=arxiv.SortOrder.Descending
   )
   results = list(client.results(search))
   ```

**结果**: 获取匹配检索词的论文列表

---

### 2.3 分类层：标签映射（taxonomy.py + normalize_category）

**文件**: `taxonomy.py` → `normalize_category()`

**流程**:

1. **config.yaml中的子标签** → **taxonomy.py中的标准标签**

   **映射关系**:
   ```
   config.yaml中的子标签          →  taxonomy.py中的标准标签
   "Perception-2D"              →  "Perception/2D Perception"
   "Perception-3D"               →  "Perception/3D Perception"
   "Perception-Detection"        →  "Perception/Object Detection"
   "Operation-Grasp"            →  "Operation/Grasp"
   "Learning-RL"                →  "Learning/RL"
   ...
   ```

2. **normalize_category()函数**
   ```python
   # 在 daily_arxiv.py 中
   normalized_keyword = normalize_category(keyword)  # keyword = "Perception-2D"
   # 返回: "Perception/2D Perception"
   ```

3. **如果无法映射，使用自动分类**
   ```python
   # 在 save_paper_to_db() 中
   if normalized_category == 'Uncategorized':
       # 使用 classify_paper_by_keywords() 自动分类
       matched_tags = classify_paper_by_keywords(temp_paper)
       normalized_category = matched_tags[0] if matched_tags else 'Uncategorized'
   ```

---

### 2.4 保存层：保存到数据库（save_paper_to_db.py）

**文件**: `save_paper_to_db.py` → `save_paper_to_db()`

**流程**:

1. **接收论文数据和分类**
   ```python
   save_paper_to_db(
       paper_data,           # 从ArXiv获取的论文数据
       category,             # 规范化后的分类（如 "Perception/2D Perception"）
       enable_title_dedup=True,
       fetch_semantic_scholar=False
   )
   ```

2. **去重检查**
   - 基于论文ID去重
   - 基于标题相似度去重（阈值0.85）

3. **自动分类（如果需要）**
   - 如果类别为 `Uncategorized`，尝试自动分类
   - 使用 `classify_paper_by_keywords()` 函数

4. **保存到数据库**
   ```python
   paper = Paper(
       id=paper_id,
       title=title,
       category=normalized_category,  # 最终分类
       ...
   )
   session.add(paper)
   session.commit()
   ```

---

## 三、完整流程图

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 配置层 (config.yaml)                                      │
│                                                              │
│ keywords:                                                    │
│   "Perception-2D":                                          │
│     filters: ["perception", "2d perception", ...]           │
│   "Operation-Grasp":                                        │
│     filters: ["grasp", "grasping", ...]                    │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. 检索层 (daily_arxiv.py)                                   │
│                                                              │
│ for topic, keyword in keywords.items():                     │
│   # topic = "Perception-2D"                                  │
│   # keyword = '"perception"OR"2d perception"OR...'         │
│                                                              │
│   query = f"({keyword}) AND {date_filter}"                 │
│   results = arxiv.Search(query=query)                       │
│                                                              │
│   获取匹配检索词的论文列表                                    │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. 分类层 (taxonomy.py)                                      │
│                                                              │
│ normalized_category = normalize_category(topic)             │
│                                                              │
│ "Perception-2D" → "Perception/2D Perception"               │
│ "Operation-Grasp" → "Operation/Grasp"                      │
│                                                              │
│ 如果无法映射 → 使用 classify_paper_by_keywords() 自动分类  │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. 保存层 (save_paper_to_db.py)                             │
│                                                              │
│ save_paper_to_db(paper_data, normalized_category)           │
│                                                              │
│ - 去重检查（ID + 标题相似度）                                │
│ - 自动分类（如果需要）                                       │
│ - 保存到数据库                                               │
└──────────────────┬──────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. 数据库 (papers.db)                                        │
│                                                              │
│ Paper表:                                                     │
│   - id: ArXiv ID                                             │
│   - title: 论文标题                                           │
│   - category: "Perception/2D Perception" (标准标签)         │
│   - abstract: 摘要                                            │
│   - ...                                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 四、关键映射关系

### 4.1 config.yaml → taxonomy.py 标签映射

| config.yaml中的子标签 | taxonomy.py中的标准标签 |
|----------------------|----------------------|
| `"Perception-2D"` | `"Perception/2D Perception"` |
| `"Perception-3D"` | `"Perception/3D Perception"` |
| `"Perception-Detection"` | `"Perception/Object Detection"` |
| `"Perception-Segmentation"` | `"Perception/Instance Segmentation"` |
| `"Perception-VLM"` | `"Perception/Vision-Language Model"` |
| `"Operation-Grasp"` | `"Operation/Grasp"` |
| `"Operation-VLA"` | `"Operation/VLA"` |
| `"Learning-RL"` | `"Learning/RL"` |
| `"Learning-IL"` | `"Learning/IL"` |
| `"Motion-Humanoid"` | `"Motion/Humanoid"` |
| `"Decision-Planning"` | `"Decision/Task Planning"` |
| `"General-Robot"` | `"General-Robot"` |
| `"Benchmark"` | `"Benchmark/Benchmark"` |

### 4.2 检索词 → 子标签 → 标准标签

```
检索词: ["perception", "2d perception", ...]
    ↓
子标签: "Perception-2D" (config.yaml)
    ↓
标准标签: "Perception/2D Perception" (taxonomy.py)
    ↓
数据库: Paper.category = "Perception/2D Perception"
```

---

## 五、总结

**您的理解完全正确！**

1. ✅ **使用检索词抓取数据**：从 `config.yaml` 读取检索词，构建ArXiv API查询
2. ✅ **检索词对应子标签**：每个子标签（如 `"Perception-2D"`）对应一组检索词
3. ✅ **归类到数据库**：通过 `normalize_category()` 将子标签映射到标准标签，然后保存到数据库

**完整流程**:
```
config.yaml (检索词配置)
    ↓
daily_arxiv.py (ArXiv API查询)
    ↓
taxonomy.py (标签映射)
    ↓
save_paper_to_db.py (保存到数据库)
    ↓
papers.db (最终存储)
```

**关键点**:
- 检索词用于ArXiv API查询（匹配论文）
- 子标签用于组织检索词（config.yaml中的键）
- 标准标签用于数据库存储（taxonomy.py中的键）
- 如果无法映射，使用自动分类算法

---

## 六、示例

### 示例1：抓取"Perception-2D"类别的论文

1. **读取配置**
   ```yaml
   "Perception-2D":
       filters: ["perception", "2d perception", "visual perception"]
   ```

2. **构建查询**
   ```python
   query = '"perception"OR"2d perception"OR"visual perception"'
   full_query = f"({query}) AND submittedDate:[20251201 TO 20251217]"
   ```

3. **ArXiv API查询**
   - 返回匹配检索词的论文列表

4. **标签映射**
   ```python
   topic = "Perception-2D"
   normalized_category = normalize_category(topic)
   # 返回: "Perception/2D Perception"
   ```

5. **保存到数据库**
   ```python
   paper.category = "Perception/2D Perception"
   session.add(paper)
   session.commit()
   ```

---

## 七、注意事项

1. **检索词匹配**：ArXiv API使用检索词匹配论文标题和摘要
2. **标签映射**：`normalize_category()` 负责将config.yaml中的子标签映射到标准标签
3. **自动分类**：如果无法映射或分类为Uncategorized，会尝试自动分类
4. **去重机制**：基于论文ID和标题相似度去重，避免重复保存

