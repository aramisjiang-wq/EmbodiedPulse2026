<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£ä¹¦ç™»å½•ç³»ç»Ÿ - å¿«é€Ÿæµ‹è¯•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #333; margin-bottom: 32px; }
        .test-section {
            margin-bottom: 32px;
            padding: 24px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        h3 { color: #667eea; margin-bottom: 16px; }
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 15px;
            cursor: pointer;
            margin-right: 12px;
            margin-bottom: 8px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102,126,234,0.3); }
        .result {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #2e7d32; }
        .error { color: #c62828; }
        .info { color: #1976d2; }
        .link { color: #667eea; text-decoration: none; margin-right: 16px; }
        .link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ é£ä¹¦ç™»å½•ç³»ç»Ÿ - å¿«é€Ÿæµ‹è¯•</h1>
        
        <!-- æµ‹è¯•1: ç®¡ç†å‘˜ç™»å½• -->
        <div class="test-section">
            <h3>1. ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</h3>
            <button class="btn" onclick="testAdminLogin()">ç™»å½• (limx/limx123456)</button>
            <button class="btn" onclick="clearToken()">æ¸…é™¤Token</button>
            <button class="btn" onclick="showToken()">æŸ¥çœ‹Token</button>
            <div id="login-result" class="result"></div>
        </div>
        
        <!-- æµ‹è¯•2: APIè°ƒç”¨ -->
        <div class="test-section">
            <h3>2. APIè°ƒç”¨æµ‹è¯•</h3>
            <button class="btn" onclick="testOverviewAPI()">æµ‹è¯•ç»Ÿè®¡API</button>
            <button class="btn" onclick="testUsersAPI()">æµ‹è¯•ç”¨æˆ·åˆ—è¡¨API</button>
            <div id="api-result" class="result"></div>
        </div>
        
        <!-- æµ‹è¯•3: é¡µé¢è·³è½¬ -->
        <div class="test-section">
            <h3>3. é¡µé¢è·³è½¬æµ‹è¯•</h3>
            <a href="/admin/login" class="link" target="_blank">ç®¡ç†å‘˜ç™»å½•é¡µé¢</a>
            <a href="/admin/dashboard" class="link" target="_blank">ç®¡ç†ä»ªè¡¨ç›˜</a>
            <a href="/admin/users" class="link" target="_blank">ç”¨æˆ·ç®¡ç†</a>
            <a href="/admin/logs" class="link" target="_blank">æ—¥å¿—ç›‘æ§</a>
            <br><br>
            <a href="/login" class="link" target="_blank">é£ä¹¦ç™»å½•</a>
            <a href="/profile" class="link" target="_blank">ä¸ªäººä¸­å¿ƒ</a>
        </div>
        
        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="test-section">
            <h3>4. å½“å‰çŠ¶æ€</h3>
            <div id="status-result" class="result">
                TokençŠ¶æ€: <span id="token-status">æœªæ£€æµ‹</span>
            </div>
        </div>
    </div>
    
    <script>
        // æµ‹è¯•ç®¡ç†å‘˜ç™»å½•
        async function testAdminLogin() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.textContent = 'æ­£åœ¨ç™»å½•...';
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        username: 'limx',
                        password: 'limx123456'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('auth_token', data.token);
                    resultDiv.innerHTML = `<span class="success">âœ… ç™»å½•æˆåŠŸï¼</span>\n\nToken: ${data.token.substring(0, 50)}...\n\nç®¡ç†å‘˜ä¿¡æ¯:\n${JSON.stringify(data.admin, null, 2)}`;
                    updateStatus();
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ç™»å½•å¤±è´¥ï¼š${data.message}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯ï¼š${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•ç»Ÿè®¡API
        async function testOverviewAPI() {
            const resultDiv = document.getElementById('api-result');
            const token = localStorage.getItem('auth_token');
            
            if (!token) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }
            
            resultDiv.textContent = 'æ­£åœ¨è·å–æ•°æ®...';
            
            try {
                const response = await fetch('/api/admin/stats/overview', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    resultDiv.innerHTML = '<span class="error">âŒ Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</span>';
                    return;
                }
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">âœ… APIè°ƒç”¨æˆåŠŸï¼</span>\n\n${JSON.stringify(data.stats, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ APIè¿”å›é”™è¯¯ï¼š${data.message}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯ï¼š${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•ç”¨æˆ·åˆ—è¡¨API
        async function testUsersAPI() {
            const resultDiv = document.getElementById('api-result');
            const token = localStorage.getItem('auth_token');
            
            if (!token) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }
            
            resultDiv.textContent = 'æ­£åœ¨è·å–æ•°æ®...';
            
            try {
                const response = await fetch('/api/admin/users?page=1&per_page=10', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    resultDiv.innerHTML = '<span class="error">âŒ Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</span>';
                    return;
                }
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">âœ… APIè°ƒç”¨æˆåŠŸï¼</span>\n\nç”¨æˆ·æ€»æ•°: ${data.total}\nå½“å‰é¡µ: ${data.current_page}\n\n${JSON.stringify(data.users, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ APIè¿”å›é”™è¯¯ï¼š${data.message}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯ï¼š${error.message}</span>`;
            }
        }
        
        // æ¸…é™¤Token
        function clearToken() {
            localStorage.removeItem('auth_token');
            document.getElementById('login-result').innerHTML = '<span class="info">â„¹ï¸  Tokenå·²æ¸…é™¤</span>';
            updateStatus();
        }
        
        // æ˜¾ç¤ºToken
        function showToken() {
            const token = localStorage.getItem('auth_token');
            const resultDiv = document.getElementById('login-result');
            
            if (token) {
                resultDiv.innerHTML = `<span class="info">å½“å‰Token:</span>\n\n${token}`;
            } else {
                resultDiv.innerHTML = '<span class="error">âŒ æ²¡æœ‰Token</span>';
            }
        }
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus() {
            const token = localStorage.getItem('auth_token');
            const statusSpan = document.getElementById('token-status');
            
            if (token) {
                statusSpan.innerHTML = '<span class="success">âœ… å·²ç™»å½•</span>';
            } else {
                statusSpan.innerHTML = '<span class="error">âŒ æœªç™»å½•</span>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ›´æ–°çŠ¶æ€
        updateStatus();
    </script>
</body>
</html>

