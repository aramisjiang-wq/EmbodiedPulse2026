# æœåŠ¡å™¨å®Œæ•´éƒ¨ç½²æŒ‡å—

## ðŸŽ¯ é¡¹ç›®ä¿¡æ¯

- **é¡¹ç›®ç±»åž‹**ï¼šPython Flask Webåº”ç”¨
- **éƒ¨ç½²æ–¹å¼**ï¼šDocker + Docker Compose
- **é¡¹ç›®è·¯å¾„**ï¼š`/opt/EmbodiedPulse`
- **GitHubä»“åº“**ï¼š`https://github.com/aramisjiang-wq/EmbodiedPulse2026.git`
- **æœåŠ¡ç«¯å£**ï¼š5001

## ðŸš€ å®Œæ•´éƒ¨ç½²æ­¥éª¤ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¿…è¦å·¥å…·

```bash
ssh root@115.190.77.57
# å¯†ç : ash@2025

# æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€å·¥å…·
apt update
apt install -y git curl

# å®‰è£…Docker
if ! command -v docker &> /dev/null; then
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    systemctl start docker
    systemctl enable docker
    rm get-docker.sh
    echo "âœ… Dockerå·²å®‰è£…"
else
    echo "âœ… Dockerå·²å­˜åœ¨"
fi

# å®‰è£…Docker Compose
if ! command -v docker-compose &> /dev/null; then
    curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
    echo "âœ… Docker Composeå·²å®‰è£…"
else
    echo "âœ… Docker Composeå·²å­˜åœ¨"
    # ä¿®å¤æƒé™ï¼ˆå¦‚æžœä¹‹å‰æœ‰é—®é¢˜ï¼‰
    chmod +x /usr/local/bin/docker-compose
fi

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### ç¬¬äºŒæ­¥ï¼šå…‹éš†é¡¹ç›®ä»£ç 

```bash
# è¿›å…¥/optç›®å½•
cd /opt

# å¦‚æžœç›®å½•å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
rm -rf EmbodiedPulse

# å…‹éš†é¡¹ç›®
git clone https://github.com/aramisjiang-wq/EmbodiedPulse2026.git EmbodiedPulse

# è¿›å…¥é¡¹ç›®ç›®å½•
cd EmbodiedPulse

# éªŒè¯å…³é”®æ–‡ä»¶
ls -la app.py docker-compose.yml Dockerfile requirements.txt templates/index.html
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨DockeræœåŠ¡

```bash
# ç¡®ä¿åœ¨é¡¹ç›®ç›®å½•
cd /opt/EmbodiedPulse

# åœæ­¢å¯èƒ½å­˜åœ¨çš„æ—§å®¹å™¨
docker-compose down -v 2>/dev/null || true
docker ps -a | grep -E "embodied|pulse" | awk '{print $1}' | xargs docker rm -f 2>/dev/null || true

# æž„å»ºé•œåƒï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿å¹²å‡€æž„å»ºï¼‰
docker-compose build --no-cache

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆè‡³å°‘60ç§’ï¼‰
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 60
```

### ç¬¬å››æ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨ï¼š
# - embodied-pulse-postgres (çŠ¶æ€: Up)
# - embodied-pulse-web (çŠ¶æ€: Up)

# 2. æ£€æŸ¥HTTPçŠ¶æ€ç 
curl -I http://localhost:5001

# åº”è¯¥çœ‹åˆ°: HTTP/1.1 200 OK

# 3. æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker-compose logs --tail=30 web

# åº”è¯¥çœ‹åˆ°æœåŠ¡æ­£å¸¸å¯åŠ¨çš„æ—¥å¿—

# 4. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 5001
# æˆ–
lsof -i:5001

# åº”è¯¥çœ‹åˆ°Dockerå®¹å™¨åœ¨ç›‘å¬5001ç«¯å£
```

## ðŸ” æ£€æŸ¥ç»“æžœè¯´æ˜Ž

### âœ… æ­£å¸¸æƒ…å†µ

1. **å®¹å™¨çŠ¶æ€**ï¼š
   ```
   NAME                      STATUS
   embodied-pulse-postgres   Up X minutes
   embodied-pulse-web        Up X minutes
   ```

2. **HTTPå“åº”**ï¼š
   ```
   HTTP/1.1 200 OK
   ```

3. **ç«¯å£ç›‘å¬**ï¼š
   ```
   tcp6  0  0  :::5001  :::*  LISTEN  12345/docker-proxy
   ```

4. **æœåŠ¡æ—¥å¿—**ï¼š
   ```
   web_1  | [INFO] Running on http://0.0.0.0:5001
   web_1  | [INFO] 127.0.0.1 - - [12/Dec/2025 XX:XX:XX] "GET / HTTP/1.1" 200 -
   ```

### âŒ å¼‚å¸¸æƒ…å†µå¤„ç†

#### é—®é¢˜1ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs web

# æŸ¥çœ‹PostgreSQLæ—¥å¿—
docker-compose logs postgres

# æ£€æŸ¥é•œåƒæ˜¯å¦æž„å»ºæˆåŠŸ
docker images | grep embodied-pulse
```

#### é—®é¢˜2ï¼šHTTP 502é”™è¯¯

```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps

# å¦‚æžœå®¹å™¨æœªè¿è¡Œï¼Œé‡å¯
docker-compose restart web

# å¦‚æžœè¿˜æ˜¯ä¸è¡Œï¼Œå®Œå…¨é‡å»º
docker-compose down -v
docker-compose build --no-cache
docker-compose up -d
```

#### é—®é¢˜3ï¼šç«¯å£æœªç›‘å¬

```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps

# æ£€æŸ¥å®¹å™¨ç«¯å£æ˜ å°„
docker-compose ps | grep 5001

# æ£€æŸ¥é˜²ç«å¢™
ufw status
# æˆ–
firewall-cmd --list-ports
```

## ðŸ› ï¸ ä¸€é”®éƒ¨ç½²è„šæœ¬

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å®Œæ•´è„šæœ¬ï¼š

```bash
#!/bin/bash
set -e

echo "=========================================="
echo "Embodied Pulse å®Œæ•´éƒ¨ç½²"
echo "=========================================="

# 1. å®‰è£…å·¥å…·
echo "1. å®‰è£…å¿…è¦å·¥å…·..."
apt update
apt install -y git curl

# å®‰è£…Docker
if ! command -v docker &> /dev/null; then
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    systemctl start docker
    systemctl enable docker
    rm get-docker.sh
fi

# å®‰è£…Docker Compose
if ! command -v docker-compose &> /dev/null; then
    curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
fi

# 2. å…‹éš†é¡¹ç›®
echo "2. å…‹éš†é¡¹ç›®..."
cd /opt
rm -rf EmbodiedPulse
git clone https://github.com/aramisjiang-wq/EmbodiedPulse2026.git EmbodiedPulse
cd EmbodiedPulse

# 3. å¯åŠ¨æœåŠ¡
echo "3. å¯åŠ¨æœåŠ¡..."
docker-compose down -v 2>/dev/null || true
docker-compose build --no-cache
docker-compose up -d

# 4. ç­‰å¾…å¯åŠ¨
echo "4. ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆ60ç§’ï¼‰..."
sleep 60

# 5. éªŒè¯
echo "5. éªŒè¯éƒ¨ç½²..."
echo "å®¹å™¨çŠ¶æ€:"
docker-compose ps

echo ""
echo "HTTPæµ‹è¯•:"
curl -I http://localhost:5001 | head -3

echo ""
echo "ç«¯å£ç›‘å¬:"
netstat -tulpn | grep 5001 || lsof -i:5001

echo ""
echo "=========================================="
echo "éƒ¨ç½²å®Œæˆï¼"
echo "è®¿é—®: http://115.190.77.57:5001"
echo "=========================================="
```

## ðŸ“ ä¿å­˜ä¸ºè„šæœ¬æ–‡ä»¶

åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼š

```bash
ssh root@115.190.77.57

# åˆ›å»ºè„šæœ¬
cat > /tmp/deploy.sh << 'EOF'
#!/bin/bash
set -e
# ... (ä¸Šé¢çš„å®Œæ•´è„šæœ¬å†…å®¹)
EOF

chmod +x /tmp/deploy.sh
bash /tmp/deploy.sh
```

## ðŸ”„ æ—¥å¸¸æ›´æ–°æµç¨‹

ä»£ç æ›´æ–°åŽï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /opt/EmbodiedPulse
git pull origin main
docker-compose down
docker-compose up -d --build
sleep 30
docker-compose ps
curl -I http://localhost:5001
```

## ðŸ†˜ æ•…éšœæŽ’æŸ¥

### æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
```bash
docker ps -a
```

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
```bash
docker stats --no-stream
```

### è¿›å…¥å®¹å™¨è°ƒè¯•
```bash
docker-compose exec web bash
# åœ¨å®¹å™¨å†…
python3 app.py
```

### æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
```bash
journalctl -u docker -n 50
dmesg | tail -20
```

---

**é‡è¦æç¤º**ï¼šè¿™æ˜¯Python Flaské¡¹ç›®ï¼Œä½¿ç”¨Dockeréƒ¨ç½²ï¼Œä¸éœ€è¦å®‰è£…npmã€pm2ç­‰Node.jså·¥å…·ã€‚

